<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.10.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INSTINCT: Single Point Positioning using Kalman Filtering</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/color','[tex]/colortbl']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','color','colortbl']
  }
};
window.MathJax = {
    tex: {
        tags: 'ams'
    }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <!--Doxygen Awesome Theme related settings:-->
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeTabs.init()
  </script>
  <!--End of Doxygen Awesome settings-->
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="INSTINCT_Logo_Text.png"  /></td>
              <td id="projectalign">
                <div id="projectname"><span
                    id="projectnumber">&#160;0.2.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('SppKF.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Single Point Positioning using Kalman Filtering</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="SppKF-KfAlgorithm"></a>
Algorithm - Extended Kalman Filter</h1>
<ul>
<li>Prediction <a class="anchor" id="eq-SppKF-KfAlgorithm-prediction"></a> <p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \hat{\boldsymbol{x}}_{n \mid n-1} &amp;=\boldsymbol{\Phi}_{n-1 \mid n-1} \cdot \hat{\boldsymbol{x}}_{n-1 \mid n-1} \\
  \boldsymbol{P}_{n \mid n-1} &amp;=\boldsymbol{\Phi}_{n-1 \mid n-1} \boldsymbol{P}_{n-1 \mid n-1} \boldsymbol{\Phi}_{n-1 \mid n-1}^{T}+\boldsymbol{Q}
\end{aligned}
\end{equation}
</p>
</li>
<li>Kalman Gain <a class="anchor" id="eq-SppKF-KfAlgorithm-gain"></a> <p class="formulaDsp">
\begin{equation}
\boldsymbol{K}_{n}=\boldsymbol{P}_{n \mid n-1} \boldsymbol{H}_{n}^{T}\left(\boldsymbol{H}_{n} \boldsymbol{P}_{n \mid n-1} \boldsymbol{H}_{n}^{T}+\boldsymbol{R}_{n}\right)^{-1}
\end{equation}
</p>
</li>
<li>Update <a class="anchor" id="eq-SppKF-KfAlgorithm-update"></a> <p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \hat{\boldsymbol{x}}_{n \mid n}&amp;=\hat{\boldsymbol{x}}_{n \mid n-1}+\boldsymbol{K}_{n}\left(\Delta \boldsymbol{y}_{n}-\boldsymbol{H}_{n} \left(\hat{\boldsymbol{x}}_{n \mid n-1} - \hat{\boldsymbol{x}}_{n-1 \mid n-1}\right)\right) \\
  \boldsymbol{P}_{n \mid n}&amp;=\left(\boldsymbol{I}-\boldsymbol{K}_{n} \boldsymbol{H}_{n}\right) \boldsymbol{P}_{n \mid n-1}
\end{aligned}
\end{equation}
</p>
</li>
</ul>
<h1><a class="anchor" id="SppKF-unknowns"></a>
Unknowns</h1>
<p>Pseudorange and Doppler observations are processed together.</p>
<p><a class="anchor" id="eq-SppKF-unknowns"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{x}^e =
\begin{bmatrix}
    \text{Receiver Position [m]} \\
    \text{Receiver Velocity [m]} \\ \hdashline
    \text{Clock error [m]} \\
    \text{Clock drift [m]} \\\hdashline
    \text{Inter-system clock bias (System 2 to 1) [m]} \\
    \text{Inter-system clock drift (System 2 to 1)  [m]} \\
    \vdots \\
    \text{Inter-system clock bias (System o to 1) [m]} \\
    \text{Inter-system clock drift (System o to 1)  [m]} \\\hdashline
    \text{Inter-frequency bias (Frequency 2 to 1)  [m]} \\
    \vdots \\
    \text{Inter-frequency bias (Frequency j to 1) [m]} \\
\end{bmatrix}
\end{equation}
</p>
<h1><a class="anchor" id="SppKF-processModel"></a>
Process Model</h1>
<h2><a class="anchor" id="SppKF-processModel-systemModel"></a>
System Model</h2>
<p><a class="anchor" id="eq-SppKF-processModel-systemModel"></a> </p><p class="formulaDsp">
\begin{equation}
\overbrace{
  \begin{bmatrix}
    { \mathbf{v}_r } \\
    { \mathbf{a}_r } \\\hdashline
    { d\dot{t}_r } \\
    { d\ddot{t}_r } \\\hdashline
    { d\dot{t}_{ISB}^{S_2 \rightarrow S_1} } \\
    { d\ddot{t}_{ISB}^{S_2 \rightarrow S_1} } \\
    { \vdots } \\
    { d\dot{t}_{ISB}^{S_o \rightarrow S_1} } \\
    { d\ddot{t}_{ISB}^{S_o \rightarrow S_1} } \\\hdashline
    { d\dot{t}_{IFB}^{F_2 \rightarrow F_1} } \\
    { \vdots } \\
    { d\dot{t}_{IFB}^{F_j \rightarrow F_1} } \\
  \end{bmatrix}
}^{\mathbf{\dot{x}}^e}
=
\overbrace{\left[\begin{array}{cc:cc:ccccc:ccc}
  \mathbf{0}_3     &amp; \mathbf{I}_3     &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \dots  &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \dots  &amp; \mathbf{0}_{3,1} \\
  \mathbf{0}_3     &amp; \mathbf{0}_3     &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \dots  &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \dots  &amp; \mathbf{0}_{3,1} \\\hdashline
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         1        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0         \\
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0         \\\hdashline
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         1        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0         \\
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0         \\
       \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp; \ddots &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp; \ddots &amp;      \vdots      \\
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         1        &amp;        0         &amp; \dots  &amp;        0         \\
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0         \\\hdashline
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0          \\
       \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp; \ddots &amp;      \vdots      &amp;      \vdots      &amp;      \vdots      &amp; \ddots &amp;      \vdots       \\
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;         0        &amp;         0        &amp;         0        &amp;         0        &amp; \dots  &amp;         0        &amp;         0        &amp;        0         &amp; \dots  &amp;        0          \\
\end{array}\right]}^{\mathbf{F}}
\cdot
\overbrace{
\begin{bmatrix}
  { \mathbf{r}_r } \\
  { \mathbf{v}_r } \\\hdashline
  { dt_r} \\
  { d\dot{t}_r} \\\hdashline
  { dt_{ISB}^{S_2 \rightarrow S_1} } \\
  { d\dot{t}_{ISB}^{S_2 \rightarrow S_1} } \\
  { \vdots } \\
  { dt_{ISB}^{S_o \rightarrow S_1} } \\
  { d\dot{t}_{ISB}^{S_o \rightarrow S_1} } \\\hdashline
  { dt_{IFB}^{F_2 \rightarrow F_1} } \\
  { \vdots } \\
  { dt_{IFB}^{F_j \rightarrow F_1} } \\
\end{bmatrix}
}^{\mathbf{x}^e}
+
\mathbf{G} \cdot \boldsymbol{w}
\end{equation}
</p>
<p>(<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 9.4.2.2, eq. 9.148, p. 415)</p>
<h2><a class="anchor" id="SppKF-processModel-stateTransitionMatrix"></a>
State transition matrix</h2>
<p>Higher order terms are zero, so the exact solution is</p>
<p><a class="anchor" id="eq-SppKF-processModel-stateTransitionMatrix"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{\Phi} = \text{exp}(\mathbf{F} \tau_s) = \mathbf{I} + \mathbf{F}\tau_s
\end{equation}
</p>
<p>(<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 9.4.2.2, eq. 9.150, p. 416)</p>
<h2><a class="anchor" id="SppKF-processModel-processNoise"></a>
Process noise covariance matrix</h2>
<p><b> Clock modeling </b></p><ul>
<li>Phase drift \( \sigma_{c\phi} \) (random walk) and Frequency drift \( \sigma_{cf} \) (integrated random walk) <a class="anchor" id="eq-SppKF-processModel-processNoise-clock"></a> <p class="formulaDsp">
\begin{equation}
S_{c f}^a = \frac{\sigma^2\left(\delta \dot{\rho}_c^a\left(t+\tau_s\right)-\delta \dot{\rho}_c^a(t)\right)}{\tau_s} \quad S_{c \phi}^a = \frac{\sigma^2\left(\delta \rho_c^a\left(t+tau_s\right)-\delta \rho_c^a(t)-\delta \dot{\rho}_c^a(t) \tau_s\right)}{\tau_s}
\end{equation}
</p>
</li>
<li>Typical values for a TCXO are \( S_{cf} \approx 0.04 \text{ m}^2 \text{s}^{-3} \) and \( S_{c\phi} \approx 0.01 \text{ m}^2 \text{s}^{-1} \)</li>
</ul>
<p><b> Velocity change due to user motion (Variances) </b> <br  />
  \(
  \mathbf{S}_a^n
  =
  \begin{bmatrix}
    S_{aH} &amp; 0 &amp; 0 \\
    0 &amp; S_{aH} &amp; 0 \\
    0 &amp; 0 &amp; S_{aV} \\
  \end{bmatrix}
  \)</p>
<p><a class="anchor" id="eq-SppKF-processModel-processNoise-userMotion"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
&amp; S_{a H}=\frac{\sigma^2\left(v_{e b, N}^n\left(t+\tau_s\right)-v_{e b, N}^n(t)\right)}{\tau_s}=\frac{\sigma^2\left(v_{e b, E}^n\left(t+\tau_s\right)-v_{e b, E}^n(t)\right)}{\tau_s} \\
&amp; S_{a V}=\frac{\sigma^2\left(v_{e b, D}^n\left(t+\tau_s\right)-v_{e b, D}^n(t)\right)}{\tau_s}
\end{aligned}
\end{equation}
</p>
<ul>
<li>Suitable values for \( S_{aH} \) are around<ul>
<li>\( 1 \text{ m}^2 \text{s}^{–3} \) for a pedestrian or ship,</li>
<li>\( 10 \text{ m}^2 \text{s}^{–3} \) for a car,</li>
<li>\( 100 \text{ m}^2 \text{s}^{–3} \) for a military aircraft.</li>
</ul>
</li>
<li>The vertical acceleration PSD \( S_{aV} \) is usually smaller</li>
</ul>
<p>(<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 9.4.2.2, p. 416-418)</p>
<h3><a class="anchor" id="SppKF-processModel-processNoise-vanLoan"></a>
Van Loan method</h3>
<p><b> Noise input matrix </b></p>
<p><a class="anchor" id="eq-SppKF-processModel-processNoise-vanLoan-noiseInput"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{G} = \text{diag}
\left\{\begin{array}{cc:cc:ccccc:ccc}
    \,{ \mathbf{0}_3 } &amp;
    { \mathbf{C}_n^e } &amp;
    { 1 } &amp;
    { 1 } &amp;
    { 1 } &amp;
    { 1 } &amp;
    { \dots } &amp;
    { 1 } &amp;
    { 1 } &amp;
    { 1 } &amp;
    { \dots } &amp;
    { 1 }\,
\end{array}\right\}^T
\end{equation}
</p>
<p><b> Noise scale matrix </b></p>
<p><a class="anchor" id="eq-SppKF-processModel-processNoise-vanLoan-noiseScale"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{W} = \text{diag}
\left\{\begin{array}{cc:cc:ccccc:ccc}
    \,{ \mathbf{0}_3 } &amp;
    {\mathbf{S}_a^n} &amp;
    {\sigma_{c\phi}^2} &amp;
    {\sigma_{cf}^2} &amp;
    {{\sigma_{ISB,\phi}^{S_2 \rightarrow S_1}}^2} &amp;
    {{\sigma_{ISB,f}^{S_2 \rightarrow S_1}}^2} &amp;
    { \dots } &amp;
    {{\sigma_{ISB,\phi}^{S_o \rightarrow S_1}}^2} &amp;
    {{\sigma_{ISB,f}^{S_o \rightarrow S_1}}^2} &amp;
    {{\sigma_{IFB}^{F_2 \rightarrow F_1}}^2} &amp;
    { \dots } &amp;
    {{\sigma_{IFB}^{F_j \rightarrow F_1}}^2}\,
\end{array}\right\}^T
\end{equation}
</p>
<p><b> Van Loan algorithm </b></p>
<ol type="1">
<li>Form a \( 2n \times 2n \) matrix called \( \mathbf{A} \) ( \( n \) is the dimension of \( \mathbf{x} \) and \( \mathbf{W} \) is the power spectral density of the noise \( W(t) \)) <a class="anchor" id="ep-SppKF-processNoise-vanLoan-A"></a> <p class="formulaDsp">
\begin{equation}
  \mathbf{A} = \begin{bmatrix} -\mathbf{F} &amp; \mathbf{G} \mathbf{W} \mathbf{G}^T \\
                                \mathbf{0} &amp;            \mathbf{F}^T          \end{bmatrix} \Delta t
\end{equation}
</p>
</li>
<li>Calculate the exponential of \( \mathbf{A} \) <a class="anchor" id="eq-SppKF-processNoise-vanLoan-expA"></a> <p class="formulaDsp">
\begin{equation}
\mathbf{B} = \text{expm}(\mathbf{A})
= \left[ \begin{array}{c:c}
    \dots      &amp; \mathbf{\Phi}^{-1} \mathbf{Q} \\[2mm]
    \hdashline
    \mathbf{0} &amp; \mathbf{\Phi}^T
  \end{array} \right]
= \left[ \begin{array}{c:c}
    \mathbf{B}_{11} &amp; \mathbf{B}_{12} \\[2mm]
    \hdashline
    \mathbf{B}_{21} &amp; \mathbf{B}_{22}
  \end{array} \right]
\end{equation}
</p>
</li>
<li>Calculate the state transition matrix \( \mathbf{\Phi} \) as <a class="anchor" id="eq-SppKF-processNoise-vanLoan-Phi"></a> <p class="formulaDsp">
\begin{equation}
  \mathbf{\Phi} = \mathbf{B}_{22}^T
\end{equation}
</p>
</li>
<li>Calculate the process noise covariance matrix \( \mathbf{Q} \) as <a class="anchor" id="eq-SppKF-processNoise-vanLoan-Q"></a> <p class="formulaDsp">
\begin{equation}
  \mathbf{Q} = \mathbf{\Phi} \mathbf{B}_{12}
\end{equation}
</p>
</li>
</ol>
<p>Uses GUI input values for \( S_{aH} \), \( S_{cf} \) and \( S_{c\phi} \).</p>
<h3><a class="anchor" id="SppKF-processModel-processNoise-groves"></a>
Groves</h3>
<p><a class="anchor" id="eq-SppKF-processModel-processNoise-groves"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{Q} =
\left[\begin{array}{cc:cc}
  \frac{1}{3} S_a^\gamma \tau_s^3 &amp; \frac{1}{2} S_a^\gamma \tau_s^2 &amp; 0_{3,1} &amp; 0_{3,1} \\
  \frac{1}{2} S_a^\gamma \tau_s^2 &amp; S_a^\gamma \tau_s &amp; 0_{3,1} &amp; 0_{3,1} \\
  \hdashline
  0_{1,3} &amp; 0_{1,3} &amp; S_{c \phi}^a \tau_s+\frac{1}{3} S_{c f}^a \tau_s^3 &amp; \frac{1}{2} S_{c f}^a \tau_s^2 \\
  0_{1,3} &amp; 0_{1,3} &amp; \frac{1}{2} S_{c f}^a \tau_s^2 &amp; S_{c f}^a \tau_s
  \end{array}\right]
\end{equation}
</p>
<p>Uses calculated values for \( S_{aH} \), \( S_{cf} \) and \( S_{c\phi} \).</p>
<p>(<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 9.4.2.2, eq. 9.152, p. 417-418)</p>
<p>The inter-system errors and drifts are assumed constant. Note: Groves does not estimate an inter-system drift (<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, Appendix G.8, p. G-23 - G-24), but we do for all models.</p>
<h1><a class="anchor" id="SppKF-measurmentModel"></a>
Measurement Model</h1>
<h2><a class="anchor" id="SppKF-measurmentModel-innovation"></a>
Measurement innovation</h2>
<p>See <a class="el" href="SppBasics.html#SppBasics-measurementModel-innovation">Measurement innovation</a></p>
<h2><a class="anchor" id="SppKF-measurmentModel-sensitivityMatrix"></a>
Measurement sensitivity matrix</h2>
<p>See <a class="el" href="SppBasics.html#SppBasics-measurementModel-sensitivityMatrix">Design matrix / Measurement sensitivity matrix</a></p>
<p>In detail for Kalman Filtering <a class="anchor" id="eq-SppKF-measurementModel-sensitivityMatrix-2"></a> </p><p class="formulaDsp">
\begin{equation}
  \overbrace
  {\begin{bmatrix}
  { {p}_{r}^{1,S1,F1}} \\[0.5em]
  { {p}_{r}^{1,S1,F2}} \\[0.5em]
  { {p}_{r}^{2,S2}} \\[0.5em]
  \dots \\[0.4em] \hdashline
  { {\dot{p}}_{r}^{1,S1}} \\[0.5em]
  { {\dot{p}}_{r}^{2,S2}} \\[0.5em]
  \dots \\[0.4em]
  \end{bmatrix}}^{\mathbf{z}}
  =\overbrace{\left[\begin{array}{ccc:ccc:cc:cc:c}
  \frac{- {x^s} + {x_r}}{{\rho_r^s}} &amp; \frac{- {y^s} + {y_r}}{{\rho_r^s}} &amp; \frac{- {z^s} + {z_r}}{{\rho_r^s}} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\[0.3em]
  \frac{- {x^s} + {x_r}}{{\rho_r^s}} &amp; \frac{- {y^s} + {y_r}}{{\rho_r^s}} &amp; \frac{- {z^s} + {z_r}}{{\rho_r^s}} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\[0.3em]
  \frac{- {x^s} + {x_r}}{{\rho_r^s}} &amp; \frac{- {y^s} + {y_r}}{{\rho_r^s}} &amp; \frac{- {z^s} + {z_r}}{{\rho_r^s}} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\[0.3em]
  \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots\\[0.3em] \hdashline
  - \frac{{v^{s,x}} - {v_{r,x}}}{{\rho_r^s}} &amp; - \frac{{v^{s,y}} - {v_{r,y}}}{{\rho_r^s}} &amp; - \frac{{v^{s,z}} - {v_{r,z}}}{{\rho_r^s}} &amp; - \frac{{x^s} - {x_r}}{{\rho_r^s}} &amp; - \frac{{y^s} - {y_r}}{{\rho_r^s}} &amp; - \frac{{z^s} - {z_r}}{{\rho_r^s}} &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\[0.3em]
  - \frac{{v^{s,x}} - {v_{r,x}}}{{\rho_r^s}} &amp; - \frac{{v^{s,y}} - {v_{r,y}}}{{\rho_r^s}} &amp; - \frac{{v^{s,z}} - {v_{r,z}}}{{\rho_r^s}} &amp; - \frac{{x^s} - {x_r}}{{\rho_r^s}} &amp; - \frac{{y^s} - {y_r}}{{\rho_r^s}} &amp; - \frac{{z^s} - {z_r}}{{\rho_r^s}} &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0\\[0.3em]
  \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots
  \end{array}\right]}^{\mathbf{H}} \cdot
  \overbrace{\begin{bmatrix}
      {x_r} \\
      {y_r} \\
      {z_r} \\ \hdashline
      {v_{r,x}} \\
      {v_{r,y}} \\
      {v_{r,z}} \\ \hdashline
      { dt_r} \\
      { d\dot{t}_r} \\ \hdashline
      { dt_{ISB}^{S_2 \rightarrow S_1} } \\
      { d\dot{t}_{ISB}^{S_2 \rightarrow S_1} } \\\hdashline
      { dt_{IFB}^{F_2 \rightarrow F_1} } \\
  \end{bmatrix}}^{\mathbf{x}}
\end{equation}
</p>
<p> Which can be written with \( {\mathbf{u}_{r,v}^s} = \frac{{\mathbf{v}^s} - {\mathbf{v}_r}}{ \rho_r^s} \) as</p>
<p><a class="anchor" id="eq-SppKF-measurementModel-sensitivityMatrix"></a> </p><p class="formulaDsp">
\begin{equation}
  \mathbf{H} = \left[\begin{array}{ccc:ccc:cc:cc:c}
  - {\text{u}_{r,x}^s} &amp; - {\text{u}_{r,y}^s} &amp; - {\text{u}_{r,z}^s} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\[0.3em]
  - {\text{u}_{r,x}^s} &amp; - {\text{u}_{r,y}^s} &amp; - {\text{u}_{r,z}^s} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\[0.3em]
  - {\text{u}_{r,x}^s} &amp; - {\text{u}_{r,y}^s} &amp; - {\text{u}_{r,z}^s} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\[0.3em]
  \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots\\ \hdashline
  - {\text{u}_{r,v_x}^s} &amp; - {\text{u}_{r,v_y}^s} &amp; - {\text{u}_{r,v_z}^s} &amp; - {\text{u}_{r,x}^s} &amp; - {\text{u}_{r,y}^s} &amp; - {\text{u}_{r,z}^s} &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\[0.3em]
  - {\text{u}_{r,v_x}^s} &amp; - {\text{u}_{r,v_y}^s} &amp; - {\text{u}_{r,v_z}^s} &amp; - {\text{u}_{r,x}^s} &amp; - {\text{u}_{r,y}^s} &amp; - {\text{u}_{r,z}^s} &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0\\[0.3em]
  \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots
  \end{array}\right]
\end{equation}
</p>
<p>(<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 9.4.2.2, eq. 9.163, p. 420)</p>
<h2><a class="anchor" id="SppKF-measurmentModel-measurementNoise"></a>
Measurement noise covariance matrix</h2>
<p>See <a class="el" href="classNAV_1_1GnssMeasurementErrorModel.html">NAV::GnssMeasurementErrorModel</a></p>
<h1><a class="anchor" id="SppKF-init"></a>
Initialization</h1>
<ul>
<li>State \( x \): from Single Point Positioning solution using weighted Least-squares estimation</li>
<li>Covariance matrix of state \( P \):<ul>
<li>if more observations than unknowns: SPP solution using LSE</li>
<li>otherwise: GUI input</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="SppKF-InterChange"></a>
Inter system time difference reference system change</h1>
<h2><a class="anchor" id="SppKF-InterChange-Case1"></a>
Case 1: New Sat System with higher priority found (GPS &gt; GAL &gt; GLO &gt; ...)</h2>
<p>Old state:</p><ul>
<li>Observed GAL \( S_2 \), GLO \( S_3 \) and BDS \( S_4 \)</li>
<li>Reference system: GAL \( S_2 \) New state:</li>
<li>Additionally observed GPS \( S_1 \)</li>
<li>Reference system: GAL \( S_2 \) -&gt; GPS \( S_1 \)</li>
</ul>
<p>First we need to wait one epoch, in order to estimate the new inter system differences \( { dt_{ISB}^{S_1 \rightarrow S_2}} \) and \( { d\dot{t}_{ISB}^{S_1 \rightarrow S_2}} \) Then we can transform the state with a matrix \( \mathbf{D} \) with \( \mathbf{x}_{\text{new}} = \mathbf{D} \cdot \mathbf{x}_{\text{old}} \)</p>
<p><a class="anchor" id="eq-SppKF-inter-change-case1"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{bmatrix}
    { \mathbf{r}_{r} } \\
    { \mathbf{v}_{r} } \\
    { dt_r} \\
    { d\dot{t}_r} \\ \hdashline
    { dt_{ISB}^{S_3 \rightarrow S_1}} = { dt^{S_3}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_3 \rightarrow S_1}} = { d\dot{t}^{S_3}} - { d\dot{t}^{S_1}} \\
    { dt_{ISB}^{S_4 \rightarrow S_1}} = { dt^{S_4}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_4 \rightarrow S_1}} = { d\dot{t}^{S_4}} - { d\dot{t}^{S_1}} \\
    { dt_{ISB}^{S_2 \rightarrow S_1}} = { dt^{S_2}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_2 \rightarrow S_1}} = { d\dot{t}^{S_2}} - { d\dot{t}^{S_1}} \\ \hdashline
    { dt_{IFB}^{F_2 \rightarrow F_1}}
\end{bmatrix}_{\text{new}}
=
\overbrace{
  \left[\begin{array}{cccc:cccccc:c}
    \mathbf{I}_3     &amp; \mathbf{0}_3     &amp;   0   &amp;   0   &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp;  0 \\
    \mathbf{0}_3     &amp; \mathbf{I}_3     &amp;   0   &amp;   0   &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp;  0 \\
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   1   &amp;   0   &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; -1 &amp;  0 &amp;  0 \\
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   1   &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp;  0 &amp; -1 &amp;  0 \\[0.1em] \hdashline
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 1 &amp; 0 &amp; 0 &amp;  0 &amp; -1 &amp;  0 &amp;  0 \\[0.3em]
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 1 &amp; 0 &amp;  0 &amp;  0 &amp; -1 &amp;  0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 0 &amp; 1 &amp;  0 &amp; -1 &amp;  0 &amp;  0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 0 &amp; 0 &amp;  1 &amp;  0 &amp; -1 &amp;  0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; -1 &amp;  0 &amp;  0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp;  0 &amp; -1 &amp;  0 \\[0.3em] \hdashline
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 \\[0.3em]
  \end{array}\right]
}^{\mathbf{D}}
\cdot
\begin{bmatrix}
    { \mathbf{r}_{r} } \\
    { \mathbf{v}_{r} } \\
    { dt_r} \\
    { d\dot{t}_r} \\ \hdashline
    { dt_{ISB}^{S_3 \rightarrow S_2}} = { dt^{S_3}} - { dt^{S_2}} \\
    { d\dot{t}_{ISB}^{S_3 \rightarrow S_2}} = { d\dot{t}^{S_3}} - { d\dot{t}^{S_2}} \\
    { dt_{ISB}^{S_4 \rightarrow S_2}} = { dt^{S_4}} - { dt^{S_2}} \\
    { d\dot{t}_{ISB}^{S_4 \rightarrow S_2}} = { d\dot{t}^{S_4}} - { d\dot{t}^{S_2}} \\
    { dt_{ISB}^{S_1 \rightarrow S_2}} = { dt^{S_1}} - { dt^{S_2}} \\
    { d\dot{t}_{ISB}^{S_1 \rightarrow S_2}} = { d\dot{t}^{S_1}} - { d\dot{t}^{S_2}} \\ \hdashline
    { dt_{IFB}^{F_2 \rightarrow F_1}}
\end{bmatrix}_{\text{old}}
\end{equation}
</p>
<h2><a class="anchor" id="SppKF-InterChange-Case2"></a>
Case 2: No observation for reference system within an epoch</h2>
<p>Old state:</p><ul>
<li>Observed GPS \( S_1 \), GAL \( S_2 \), GLO \( S_3 \) and BDS \( S_4 \)</li>
<li>Reference system: GPS \( S_1 \) New state:</li>
<li>No observations for GPS \( S_1 \)</li>
<li>Reference system: GPS \( S_1 \) -&gt; GAL \( S_2 \)</li>
</ul>
<p>We can transform the state with a matrix \( \mathbf{D} \) with \( \mathbf{x}_{\text{new}} = \mathbf{D} \cdot \mathbf{x}_{\text{old}} \)</p>
<p><a class="anchor" id="eq-SppKF-inter-change-case2"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{bmatrix}
    { \mathbf{r}_{r} } \\
    { \mathbf{v}_{r} } \\
    { dt_r} \\
    { d\dot{t}_r} \\ \hdashline
    \enclose{updiagonalstrike}{{ dt_{ISB}^{S_2 \rightarrow S_2}} = 0} \\
    \enclose{updiagonalstrike}{{ d\dot{t}_{ISB}^{S_2 \rightarrow S_2}} = 0} \\
    { dt_{ISB}^{S_3 \rightarrow S_2}} = { dt^{S_3}} - { dt^{S_2}} \\
    { d\dot{t}_{ISB}^{S_3 \rightarrow S_2}} = { d\dot{t}^{S_3}} - { d\dot{t}^{S_2}} \\
    { dt_{ISB}^{S_4 \rightarrow S_2}} = { dt^{S_4}} - { dt^{S_2}} \\
    { d\dot{t}_{ISB}^{S_4 \rightarrow S_2}} = { d\dot{t}^{S_4}} - { d\dot{t}^{S_2}} \\\hdashline
    { dt_{IFB}^{F_2 \rightarrow F_1}}
\end{bmatrix}_{\text{new}}
=
\overbrace{
  \left[\begin{array}{cccc:cccccc:c}
    \mathbf{I}_3     &amp; \mathbf{0}_3     &amp;   0   &amp;   0   &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; 0 \\
    \mathbf{0}_3     &amp; \mathbf{I}_3     &amp;   0   &amp;   0   &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; \mathbf{0}_{3,1} &amp; 0 \\
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   1   &amp;   0   &amp;  0 &amp;  0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 \\
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   1   &amp;  0 &amp;  0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 \\[0.1em] \hdashline
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp;  0 &amp;  0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 \\[0.3em]
  \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp;  0 &amp;  0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; -1 &amp;  0 &amp; 1 &amp;  0 &amp; 0 &amp; 0 &amp; 0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp;  0 &amp; -1 &amp; 0 &amp;  1 &amp; 0 &amp; 0 &amp; 0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp; -1 &amp;  0 &amp; 0 &amp;  0 &amp; 1 &amp; 0 &amp; 0 \\[0.3em]
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp;  0 &amp; -1 &amp; 0 &amp;  0 &amp; 0 &amp; 1 &amp; 0 \\[0.3em] \hdashline
    \mathbf{0}_{1,3} &amp; \mathbf{0}_{1,3} &amp;   0   &amp;   0   &amp;  0 &amp;  0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 1 \\[0.3em]
  \end{array}\right]
}^{\mathbf{D}}
\cdot
\begin{bmatrix}
    { \mathbf{r}_{r} } \\
    { \mathbf{v}_{r} } \\
    { dt_r} \\
    { d\dot{t}_r} \\ \hdashline
    { dt_{ISB}^{S_2 \rightarrow S_1}} = { dt^{S_2}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_2 \rightarrow S_1}} = { d\dot{t}^{S_2}} - { d\dot{t}^{S_1}} \\
    { dt_{ISB}^{S_3 \rightarrow S_1}} = { dt^{S_3}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_3 \rightarrow S_1}} = { d\dot{t}^{S_3}} - { d\dot{t}^{S_1}} \\
    { dt_{ISB}^{S_4 \rightarrow S_1}} = { dt^{S_4}} - { dt^{S_1}} \\
    { d\dot{t}_{ISB}^{S_4 \rightarrow S_1}} = { d\dot{t}^{S_4}} - { d\dot{t}^{S_1}} \\\hdashline
    { dt_{IFB}^{F_2 \rightarrow F_1}}
\end{bmatrix}_{\text{old}}
\end{equation}
</p>
<h2><a class="anchor" id="SppKF-InterChange-ErrorProp"></a>
Error propagation</h2>
<p>After a transformation, the covariance matrix has also to be adapted by error propagation <a class="anchor" id="eq-SppKF-inter-change-error-prop"></a> </p><p class="formulaDsp">
\begin{equation}
\mathbf{P}_{\text{new}} = \mathbf{D} \cdot \mathbf{P}_{\text{old}} \cdot \mathbf{D}^T
\end{equation}
</p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="algorithms_landing_page.html">Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
