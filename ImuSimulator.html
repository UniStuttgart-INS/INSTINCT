<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.10.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INSTINCT: IMU Simulator</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/color','[tex]/colortbl']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','color','colortbl']
  }
};
window.MathJax = {
    tex: {
        tags: 'ams'
    }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <!--Doxygen Awesome Theme related settings:-->
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeTabs.init()
  </script>
  <!--End of Doxygen Awesome settings-->
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="INSTINCT_Logo_Text.png"  /></td>
              <td id="projectalign">
                <div id="projectname"><span
                    id="projectnumber">&#160;0.2.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('ImuSimulator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IMU Simulator</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ImuSimulator-Acceleration-Measurements"></a>
Acceleration Measurements</h1>
<p>The navigation equation for a local-navigation frame is (see <a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.7.1, eq. 3.69, p. 47f) <a class="anchor" id="eq-ImuSimulator-VelocityNav-equation-pre"></a> </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{v}}^n = \boldsymbol{f}^n - \underbrace{(2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n}_{\text{coriolis acceleration}} +\ \mathbf{g}_l^n
\end{equation}
</p>
<p> where</p><ul>
<li>\( \boldsymbol{v}^n = \begin{pmatrix} v_N &amp; v_E &amp; v_D \end{pmatrix}^T \) is the velocity with respect to the Earth in local-navigation frame coordinates,</li>
<li>\( \boldsymbol{f}^n = \begin{pmatrix} f_N &amp; f_E &amp; f_D \end{pmatrix}^T \) is the specific force vector as measured by a triad of accelerometers and resolved into local-navigation frame coordinates</li>
<li>\( \boldsymbol{\omega}_{ie}^n \) is the turn rate of the Earth expressed in local-navigation frame coordinates</li>
<li>\( \boldsymbol{\omega}_{en}^n \) is the turn rate of the local frame with respect to the Earth-fixed frame, called the transport rate, expressed in local-navigation frame coordinates</li>
<li>\( \mathbf{g}_l^n \) is the local gravity vector which is a combination of (see <a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.71, eq. 3.75, p. 48)<ul>
<li>\( \mathbf{g}^n \) the local gravitation vector (caused by effects of mass attraction)</li>
<li>\( \boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{x}^e ] \) the centrifugal acceleration caused by the Earth's rotation</li>
</ul>
</li>
</ul>
<p>Therefore equation <a class="el" href="#eq-ImuSimulator-VelocityNav-equation-pre">eq-ImuSimulator-VelocityNav-equation-pre</a> becomes <a class="anchor" id="eq-ImuSimulator-VelocityNav-equation"></a> </p><p class="formulaDsp">
\begin{equation}
  \underbrace{\boldsymbol{\dot{v}}^n}_{\text{trajectory}}
      = \overbrace{\boldsymbol{f}^n}^{\text{measured}}
        -\ \underbrace{(2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n}_{\text{coriolis acceleration}}
        +\ \overbrace{\mathbf{g}^n}^{\text{gravitation}}
        -\ \mathbf{C}_e^n \cdot \underbrace{\left(\boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{x}^e ] \right)}_{\text{centrifugal acceleration}}
\end{equation}
</p>
<p>which can be reordered to calculate the measured accelerations with <a class="anchor" id="eq-ImuSimulator-acceleration-measured"></a> </p><p class="formulaDsp">
\begin{equation}
  \underbrace{\boldsymbol{f}^n}_{\text{measured}}
      = \overbrace{\boldsymbol{\dot{v}}^n}^{\text{trajectory}}
        + \underbrace{(2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n}_{\text{coriolis acceleration}}
        -\ \overbrace{\mathbf{g}^n}^{\text{gravitation}}
        +\ \mathbf{C}_e^n \cdot \underbrace{\left(\boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{x}^e ] \right)}_{\text{centrifugal acceleration}}
\end{equation}
</p>
<p>The acceleration from the trajectory is derived as</p>
<p><a class="anchor" id="eq-ImuSimulator-acceleration-navigation"></a> </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{v}}^n = \frac{\partial}{\partial t} \left( \boldsymbol{\dot{x}}^n \right) = \frac{\partial}{\partial t} \left( \boldsymbol{C}_e^n \cdot \boldsymbol{\dot{x}}^e \right) = \boldsymbol{\dot{C}}_e^n \cdot \boldsymbol{\dot{x}}^e + \boldsymbol{C}_e^n \cdot \boldsymbol{\ddot{x}}^e
\end{equation}
</p>
<p> with <a class="anchor" id="eq-ImuSimulator-acceleration-C_ne_dot"></a> </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{C}}_e^n = (\boldsymbol{\dot{C}}_n^e)^T = (\boldsymbol{C}_n^e \cdot \boldsymbol{\Omega}_{en}^n)^T
\end{equation}
</p>
<h1><a class="anchor" id="ImuSimulator-AngularRate-Measurements"></a>
Angular Rate Measurements</h1>
<p>Gyroscopes measure the turn rate of the platform frame with respect to an inertial frame expressed in platform coordinates <a class="anchor" id="eq-ImuSimulator-GyroMeas"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\omega}_{ip}^p &amp;= \boldsymbol{\omega}_{in}^p + \boldsymbol{\omega}_{np}^p \\
                             &amp;= \mathbf{C}_n^p \cdot [ \boldsymbol{\omega}_{in}^n + \boldsymbol{\omega}_{np}^n ] \\
                             &amp;= \mathbf{C}_n^p \cdot [ ( \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n ) + ( \boldsymbol{\omega}_{nb}^n + \overbrace{\boldsymbol{\omega}_{bp}^n}^{= 0} ) ] \\
                             &amp;= \mathbf{C}_n^p \cdot [ \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n + \boldsymbol{\omega}_{nb}^n ] \\
                             &amp;= \mathbf{C}_n^p \cdot [ \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n + \mathbf{C}_b^n \boldsymbol{\omega}_{nb}^b ]
\end{aligned}
\end{equation}
</p>
<p>The turn rate of the body frame with respect to the local-navigation frame expressed in body coordinates depends on the time derivation of the gimbal angles \( \phi \) (roll), \( \theta \) (pitch), \( \psi \) (yaw): <a class="anchor" id="eq-ImuSimulator-omega_nb_b"></a> </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\omega}_{nb}^b
      = \begin{bmatrix} \dot{R} \\ 0 \\ 0 \end{bmatrix}
        + \mathbf{C_3} \begin{bmatrix} 0 \\ \dot{P} \\ 0 \end{bmatrix}
        + \mathbf{C_3} \mathbf{C_2} \begin{bmatrix} 0 \\ 0 \\ \dot{Y} \end{bmatrix}
\end{equation}
</p>
<p> where</p><ul>
<li>\( \mathbf{C_3} = \begin{bmatrix} 1 &amp;     0    &amp;    0    \\
                                     0 &amp;  \cos{R} &amp; \sin{R} \\
                                     0 &amp; -\sin{R} &amp; \cos{R} \end{bmatrix} \) is the rotation \( R \) about the x-axis (see <a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.6.3.2, eq. 3.46, p. 41)</li>
<li>\( \mathbf{C_2} = \begin{bmatrix} \cos{P} &amp; 0 &amp; -\sin{P} \\
                                        0    &amp; 1 &amp;     0    \\
                                     \sin{P} &amp; 0 &amp;  \cos{P} \end{bmatrix} \) is the rotation \( P \) about the y-axis (see <a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.6.3.2, eq. 3.45, p. 41)</li>
</ul>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.6.3.3, eq. 3.52, p. 42</li>
<li><a class="el" href="citelist.html#CITEREF_Gleason2009">[14]</a> Gleason, ch. 6.2.3.1, eq. 6.7, p. 153 (top left term in eq. 6.8 should be \( \cos{\theta} \) instead of \( 1 \))</li>
</ul>
<p>The time derivative of the gimbal angles are calculated via spline derivatives.</p>
<h1><a class="anchor" id="ImuSimulator-Trajectory"></a>
Trajectory calculation</h1>
<p>All trajectories are calculated with a cubic spline. The spline points are calculated by the position formulas below with a certain spacing and then the velocity and acceleration is derived from it.</p>
<h2><a class="anchor" id="ImuSimulator-Trajectory-Fixed"></a>
Fixed</h2>
<p>The fixed trajectory describes a geostationary position on Earth.</p>
<p><b>Position</b> <br  />
 <a class="anchor" id="eq-ImuSimulator-Trajectory-Fixed-position"></a> </p><p class="formulaDsp">
\begin{equation}
  \mathbf{x}^n = \begin{pmatrix} \phi &amp; \lambda &amp; h \end{pmatrix}^T = \text{const}
\end{equation}
</p>
<p><b>Velocity</b> <br  />
 <a class="anchor" id="eq-ImuSimulator-Trajectory-Fixed-velocity"></a> </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{v}^n = \mathbf{\dot{x}}^n = 0
\end{equation}
</p>
<p><b>Acceleration</b> <br  />
 <a class="anchor" id="eq-ImuSimulator-Trajectory-Fixed-acceleration"></a> </p><p class="formulaDsp">
\begin{equation}
  \mathbf{a}^n = \boldsymbol{\dot{v}}^n = 0
\end{equation}
</p>
<h2><a class="anchor" id="ImuSimulator-Trajectory-Linear"></a>
Linear</h2>
<p>The linear trajectory describes a vehicle moving with constant velocity in local-navigation coordinates.</p>
<p><b>Position</b> <br  />
</p>
<p>The time derivative of the curvilinear position (lat, lon, alt) is given by (<a class="el" href="citelist.html#CITEREF_Groves2013">[17]</a> Groves, ch. 2.4.2, eq. 2.111, p. 61 or <a class="el" href="citelist.html#CITEREF_Titterton2004">[45]</a> Titterton, ch. 3.7, eq. 3.81,3.85,3.86, p. 48ff)</p>
<p><a class="anchor" id="eq-ImuSimulator-Trajectory-Linear-curvilinearPositionDerivative"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \dot{\phi}    &amp;= \frac{v_N}{R_N + h} \\
  \dot{\lambda} &amp;= \frac{v_E}{(R_E + h) \cos{\phi}} \\
  \dot{h}       &amp;= -v_D
\end{aligned}
\end{equation}
</p>
<p>As the velocity in local-navigation coordinates is constant and neglecting the change in non velocity terms, the position can be expressed as</p>
<p><a class="anchor" id="eq-ImuSimulator-Trajectory-Linear-position"></a> </p><p class="formulaDsp">
\begin{equation}
  \renewcommand*{\arraystretch}{2.0}
  \mathbf{x}^n =
  \begin{pmatrix} \phi \\ \lambda \\ h \end{pmatrix}
  \approx \begin{pmatrix} \phi_0 \\ \lambda_0 \\ h_0 \end{pmatrix}
  + \begin{pmatrix} \dfrac{v_N}{R_N + h} \\ \dfrac{v_E}{(R_E + h) \cos{\phi}} \\  -v_D \end{pmatrix}
  \cdot t
\end{equation}
</p>
<p><b>Velocity</b> <br  />
 <a class="anchor" id="eq-ImuSimulator-Trajectory-Linear-velocity"></a> </p><p class="formulaDsp">
\begin{equation}
\boldsymbol{v}^n = \mathbf{\dot{x}}^n = const
\end{equation}
</p>
<p><b>Acceleration</b> <br  />
 <a class="anchor" id="eq-ImuSimulator-Trajectory-Linear-acceleration"></a> </p><p class="formulaDsp">
\begin{equation}
  \mathbf{a}^n = \boldsymbol{\dot{v}}^n = 0
\end{equation}
</p>
<h2><a class="anchor" id="ImuSimulator-Trajectory-Circular"></a>
Circular</h2>
<p>The circular or helical trajectory describes a vehicle moving with constant horizontal speed on a circular shaped path. <a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-horizontal-speed"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \left|\boldsymbol{v}_{\text{h}}^n\right| &amp;= \text{const}
\end{aligned}
\end{equation}
</p>
<p> The vertical velocity is</p><ul>
<li>for the circular trajectory: \( v_D = 0 \)</li>
<li>for the helical trajectory: \( v_D = \text{const} \)</li>
</ul>
<p><b>Position</b> <br  />
 In the local-navigation frame in a tangential plane to the Earth surface a circular path can be expressed as</p>
<p><a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-local-position-phi"></a> </p><p class="formulaDsp">
\begin{equation}
  \mathbf{x}^n = \begin{pmatrix} x_N \\ x_E \end{pmatrix}
               = \mathbf{x}_M^n
                 + \begin{pmatrix} r \cdot \sin{\left( \varphi \right)} \\
                                   r \cdot \cos{\left( \varphi \right)}
                   \end{pmatrix}
\end{equation}
</p>
<p> where \( x_M \) is the center of the circle.</p>
<p>The vertical position is \( x_D = x_{M,D} - v_{UP} \cdot t \).</p>
<p>The variable \( \varphi \) can be expressed due to the constant speed <a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-phi-tilde"></a> </p><p class="formulaDsp">
\begin{equation}
  \left|\boldsymbol{v}_{\text{h}}^n\right| = \frac{s}{t}
                                = \left( \frac{\tilde{\varphi}}{2\pi} \cdot U \right) \frac{1}{t}
                                = \left( \frac{\tilde{\varphi}}{2\pi} \cdot 2\pi r \right) \frac{1}{t}
                                = \frac{\tilde{\varphi} \cdot r}{t}
\end{equation}
</p>
<p>Also a starting angle \( \varphi_0 \) and direction term \( \text{dir} \) (-1 for CW and +1 for CCW) are added. <a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-phi"></a> </p><p class="formulaDsp">
\begin{equation}
  \varphi = \frac{\left|\boldsymbol{v}_{\text{h}}^n\right| \cdot t}{r} \cdot \text{dir} + \varphi_0
\end{equation}
</p>
<p>As perfekt circular trajectories are hard for Navigation algorithms to estimate, due to the lack of dynamic elements, a harmonic modulation is added to the position, which leads to</p>
<p><a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-local-position"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{x}^n = \begin{pmatrix} x_N \\ x_E \\ x_D\end{pmatrix}
  = \mathbf{x}_M^n
    + \begin{pmatrix} r \cdot \sin{\left( \varphi \right)} \cdot \left( 1 + a_h \cdot \sin{\left( \varphi \cdot \omega_h \right)} \right) \\
                      r \cdot \cos{\left( \varphi \right)} \cdot \left( 1 + a_h \cdot \sin{\left( \varphi \cdot \omega_h \right)} \right) \\
                      - v_{UP} \cdot t
      \end{pmatrix}
\end{aligned}
\end{equation}
</p>
<p> where \( a_h \) is an amplitude factor which scales the harmonic oscillation in relation to the radius and \( \omega_h \) is the harmonic oscillation frequency in units [cycles/revolution]. Note that only unsigned integer values are allowed for \( \omega_h \).</p>
<p>The local position can then be added to the start position after rotating it into the Earth frame</p>
<p><a class="anchor" id="eq-ImuSimulator-Trajectory-Circular-position"></a> </p><p class="formulaDsp">
\begin{equation}
  \renewcommand*{\arraystretch}{2.0}
  \mathbf{x}^e = \mathbf{x}_M^e + \mathbf{C}_n^e(\mathbf{x}_M) \cdot \mathbf{x}^n
\end{equation}
</p>
<p><b>Velocity</b> <br  />
</p>
<p>The velocity is the first derivative of the position spline.</p>
<p><b>Acceleration</b> <br  />
</p>
<p>The acceleration is the second derivative of the position spline.</p>
<h1><a class="anchor" id="ImuSimulator-Flight-Angles"></a>
Flight angles</h1>
<h2><a class="anchor" id="ImuSimulator-Flight-Angles-Roll"></a>
Roll angle</h2>
<p>When not flying on constant height, which is the case for our circular trajectory, there is a certain roll angle. The following image should explain this. <a class="anchor" id="ImuSimulator-roll-image"></a> </p><p class="formulaDsp">
\begin{tikzpicture}
  \def\ellipseB{10.0};
  \def\ellipseA{14.0};
  \coordinate (origin) at (0.0, 0.0);
  \draw[thick, black] (0,0) [partial ellipse=45:120:\ellipseA cm and \ellipseB cm];
  \node[left] at (-5.0, \ellipseB-0.5) {Earth surface};

  \draw[black,thick] (8.0,\ellipseB) -- (5.0,\ellipseB);
  \draw[black,thick] (-5.0,\ellipseB) -- (-8.0,\ellipseB);
  \draw[blue,ultra thick] (5.0,\ellipseB) -- (-5.0,\ellipseB) node[left,yshift=10pt] {Flight plane};

  \coordinate (xE) at (5.0,\ellipseB);
  \coordinate (xM) at (0,\ellipseB);

  \def\tangentLength{100};
  \path let \p1=(xE) in coordinate (t1) at (\x1 + \tangentLength pt, \y1 - \tangentLength * \ellipseB/\ellipseA * \ellipseB/\ellipseA * \x1/\y1);
  \path let \p1=(xE) in coordinate (t2) at (\x1 - \tangentLength pt, \y1 + \tangentLength * \ellipseB/\ellipseA * \ellipseB/\ellipseA * \x1/\y1);
  \draw[brown,thick] (t1) -- (t2);

  \def\tangentLength{10};
  \path let \p1=(xE) in coordinate (nE) at (\x1 + \tangentLength pt, \y1 + \tangentLength * \ellipseA/\ellipseB * \ellipseA/\ellipseB * \y1/\x1);
  \draw[-&gt;,brown,thick] (xE) -- (nE) node[above] {$\vec{\mathbf{n}}^e$};

  \pgfmathanglebetweenpoints{\pgfpointanchor{xE}{center}}{\pgfpointanchor{t1}{center}}
  \edef\angleRoll{\pgfmathresult}
  \def\angleRadius{2.5};
  \centerarc[black,thick,-&gt;](xE)(-(360-\angleRoll):0:\angleRadius);
  \node[left,xshift=-5pt,yshift=-7pt] at ($(xE)+(\angleRadius,0)$) {$R$};

  \def\rightAngleRadius{0.5};
  \centerarc[black,thick](xE)(90-(360-\angleRoll):180-(360-\angleRoll):\rightAngleRadius);
  \node[left,xshift=1pt,yshift=7pt] at (xE) {$\boldsymbol{\cdot}$};

  \coordinate (nM) at ($(xM)+(0,1.5)$);
  \draw[-&gt;,brown,thick] (xM) -- (nM) node[left] {$\vec{\mathbf{n}}^e_M$};
  \centerarc[black,thick](xM)(90:180:\rightAngleRadius);
  \node[left,xshift=-1pt,yshift=7pt] at (xM) {$\boldsymbol{\cdot}$};

  \node[draw,cross=5pt,red,thick] (xMC) at (xM) {};
  \node[draw,cross=5pt,red,thick] (xEC) at (xE) {};

  \path [draw,-&gt;,thick] ($($(origin)!.8!(xEC)$)$) -- (xEC) node [pos=0.38,left] {$\vec{\mathbf{x}}^e$};
  \path [draw, thick] ($($(origin)!.8!(xEC)$)$) --pic[rotate=-45]{ext} ($($(origin)!.8!(xEC)$)$);

  \path [draw,-&gt;,thick] ($($(origin)!.8!(xMC)$)$) -- (xMC) node [pos=0.5,right] {$\vec{\mathbf{x}}_M^e$};
  \path [draw, thick] ($($(origin)!.8!(xMC)$)$) --pic{ext} ($($(origin)!.8!(xMC)$)$);
\end{tikzpicture}
</p>
<p>The simulated position is at the position \(\vec{x}^e\) and its velocity vector is facing out of the plane. When facing into the plane, the roll angle runs into the other direction resulting in a minus in the formula.</p>
<p>The roll angle is the angle between the tangential planes to the Earth surface in the current position and the center of the flight path. <a class="anchor" id="eq-ImuSimulator-roll-with-norm"></a> </p><p class="formulaDsp">
\begin{equation}
  R = \text{dir} \cdot \arccos{\left(\frac{\vec{\mathbf{n}}_M^e \cdot \vec{\mathbf{n}}^e}{\left|\vec{\mathbf{n}}_M^e\right| \cdot \left|\vec{\mathbf{n}}^e\right|}\right)}
\end{equation}
</p>
<p> where \( \text{dir} \) is a sign (+1 for CW and -1 for CCW) determining the direction of the circle.</p>
<p>The normal of the tangential planes is however not the position vectors \(\vec{\mathbf{x}}^e\) and \(\vec{\mathbf{x}}^e_M\), because Earth is an ellipsoid, but can be calculated with the geodetic latitude and longitude as (see <a href="https://en.wikipedia.org/wiki/N-vector">Wikipedia n-vector</a> ) <a class="anchor" id="eq-ImuSimulator-n-vector"></a> </p><p class="formulaDsp">
\begin{equation}
  \vec{\mathbf{n}}^e = \begin{pmatrix} \cos{\phi} \cdot \cos{\lambda} \\ \cos{\phi} \cdot \sin{\lambda} \\ \sin{\phi} \end{pmatrix}
\end{equation}
</p>
<p>Especially it can be seen, that this vector has length one <a class="anchor" id="eq-ImuSimulator-n-vector-norm"></a> </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \left|\vec{\mathbf{n}}^e\right| &amp;= \sqrt{ \cos^2{\phi} \cdot \cos^2{\lambda} + \cos^2{\phi} \cdot \sin^2{\lambda} + \sin^2{\phi} } \\
                                  &amp;= \sqrt{ \cos^2{\phi} \cdot \underbrace{( \cos^2{\lambda} + \sin^2{\lambda})}_{=1} + \sin^2{\phi} } \\
                                  &amp;= \sqrt{ \cos^2{\phi} + \sin^2{\phi} } \\
                                  &amp;= 1
\end{aligned}
\end{equation}
</p>
<p>The roll angle therefore becomes <a class="anchor" id="eq-ImuSimulator-roll"></a> </p><p class="formulaDsp">
\begin{equation}
  R = \text{dir} \cdot \arccos{\left( \vec{\mathbf{n}}_M^e \cdot \vec{\mathbf{n}}^e \right)}
\end{equation}
</p>
<h2><a class="anchor" id="ImuSimulator-Flight-Angles-Pitch"></a>
Pitch angle</h2>
<p>The pitch angle is calculated with the local navigation frame velocity after formula <a class="el" href="INS_2Functions_8hpp.html#eq-INS-Mechanization-Pitch">eq-INS-Mechanization-Pitch</a> <a class="anchor" id="eq-ImuSimulator-pitch"></a> </p><p class="formulaDsp">
\begin{equation}
  P = \tan^{-1}\left(\frac{-v_D}{\sqrt{v_N^2 + v_E^2}}\right)
\end{equation}
</p>
<h2><a class="anchor" id="ImuSimulator-Flight-Angles-Yaw"></a>
Yaw angle</h2>
<p>The yaw angle is calculated with the local navigation frame velocity after formula <a class="el" href="INS_2Functions_8hpp.html#eq-INS-Mechanization-Yaw">eq-INS-Mechanization-Yaw</a> <a class="anchor" id="eq-ImuSimulator-yaw"></a> </p><p class="formulaDsp">
\begin{equation}
  Y = \tan^{-1}\left(\frac{v_E}{v_N}\right)
\end{equation}
</p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="algorithms_landing_page.html">Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
