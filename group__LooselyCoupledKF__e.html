<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>INSTINCT: INS/GNSS Loosely-coupled Kalman Filter (Earth-fixed frame)</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="eigen_navtree_hacks.js"></script>
</head>
<body>
        <div id="top">
            <!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr style="height: 56px;">
                            <td id="projectlogo"><img alt="Logo" src="INSTINCT_Logo_Text.png" /></td>
                            <td id="projectalign" style="padding-left: 0.5em;">
                                <div id="projectname">
                                    <!-- INSTINCT -->
                                    <span id="projectnumber">&#160;1.1.0</span>
                                </div>
                            </td>
                            <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__LooselyCoupledKF__e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">INS/GNSS Loosely-coupled Kalman Filter (Earth-fixed frame)<div class="ingroups"><a class="el" href="group__DataProcessor__chapter.html">DataProcessor</a> &raquo; <a class="el" href="group__DataProcessor__KalmanFilter__chapter.html">KalmanFilter</a></div></div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations"></a>
Earth Frame Error State Equations</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-ShortForm"></a>
Short form</h2>
<p><a class="anchor" id="eq-LCKF_e-stateMatrix-short"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-stateMatrix-short}
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},nodes={rectangle,text width=1.8em,align=center},row sep=0.3em, column sep=0.4em] {
      \boldsymbol{\delta \dot{\psi}}_{eb}^e \\
      \boldsymbol{\delta \dot{v}}_{eb}^e \\
      \boldsymbol{\delta \dot{r}}_{eb}^e \\
      \boldsymbol{\delta \dot{f}}_{ib}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta}\mathbf{\dot{x}}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-1}{m-2-1}
      \fhighlight[cyan!20]{m-3-1}{m-3-1}
      \fhighlight[red!20]{m-4-1}{m-4-1}
      \fhighlight[orange!20]{m-5-1}{m-5-1}
    \end{pgfonlayer}
  \end{tikzpicture}
  =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=2.5em,align=center},row sep=0.3em, column sep=0.4em]
    {
      \mathbf{F}_{\dotup{\psi},\psi}^e     &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{C}_b^e \\
      \mathbf{F}_{\delta \dotup{v},\psi}^e &amp; \mathbf{F}_{\delta \dotup{v},\delta v}^e &amp; \mathbf{F}_{\delta \dotup{v},\delta r}^e &amp; \mathbf{C}_b^e &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{I}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\mathbf{F}$} (m-1-5.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[orange!20]{m-1-5}{m-1-5}
      \fhighlight[purple!20]{m-2-1}{m-2-1}
      \fhighlight[blue!20]{m-2-2}{m-2-2}
      \fhighlight[violet!20]{m-2-3}{m-2-3}
      \fhighlight[red!20]{m-2-4}{m-2-4}
      \fhighlight[cyan!20]{m-3-2}{m-3-2}
    \end{pgfonlayer}
  \end{tikzpicture}
  \cdot
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=1.8em,align=center},row sep=0.3em, column sep=0.4em] {
      \boldsymbol{\delta\psi}_{eb}^e \\
      \boldsymbol{\delta v}_{eb}^e \\
      \boldsymbol{\delta r}_{eb}^e \\
      \boldsymbol{\delta f}_{ib}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta}\mathbf{x}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-1}{m-2-1}
      \fhighlight[cyan!20]{m-3-1}{m-3-1}
      \fhighlight[red!20]{m-4-1}{m-4-1}
      \fhighlight[orange!20]{m-5-1}{m-5-1}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_243.svg" width="1752" height="215"/>
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-DetailedForm"></a>
Detailed form</h2>
<p><a class="anchor" id="eq-LCKF_e-stateMatrix"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-stateMatrix}
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=2.4em,align=center,minimum height=2.3em,anchor=center},row sep=0.3em, column sep=0.4em,] {
      \delta \dotup{\psi}_{eb,1}^e  \\ \delta \dotup{\psi}_{eb,2}^e  \\ \delta \dotup{\psi}_{eb,3}^e  \\
      \delta \dotup{v}_{eb,x}^e     \\ \delta \dotup{v}_{eb,y}^e     \\ \delta \dotup{v}_{eb,z}^e     \\
      \delta \dotup{r}_{eb,x}^e     \\ \delta \dotup{r}_{eb,y}^e     \\ \delta \dotup{r}_{eb,z}^e     \\
      \delta \dotup{f}_{x}^{b}      \\ \delta \dotup{f}_{y}^{b}      \\ \delta \dotup{f}_{z}^{b}      \\
      \delta \dotup{\omega}_{x}^{b} \\ \delta \dotup{\omega}_{y}^{b} \\ \delta \dotup{\omega}_{z}^{b} \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta}\mathbf{\dot{x}}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-3-1}
      \fhighlight[blue!20]{m-4-1}{m-6-1}
      \fhighlight[cyan!20]{m-7-1}{m-9-1}
      \fhighlight[red!20]{m-10-1}{m-12-1}
      \fhighlight[orange!20]{m-13-1}{m-15-1}
    \end{pgfonlayer}
  \end{tikzpicture}
  =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},nodes in empty cells,
                row sep=0.3em, column sep=0.4em,
                nodes={rectangle,minimum height=2.3em,anchor=center},
                column 6/.style = {nodes={minimum width=1.0cm}},] {
           0       &amp;  \omega_{ie} &amp;       0     &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
      -\omega_{ie} &amp;       0      &amp;       0     &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp; \mathbf{C}_b^e &amp; \\
           0       &amp;       0      &amp;       0     &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
           0       &amp;  f_{ib,z}^e  &amp; -f_{ib,y}^e &amp;       0        &amp; 2 \omega_{ie} &amp;  0  &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
     -f_{ib,z}^e   &amp;       0      &amp;  f_{ib,x}^e &amp; -2 \omega_{ie} &amp;       0       &amp;  0  &amp;  &amp; - \left( \dfrac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \dfrac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|} + \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \right) &amp;  &amp;  &amp; \mathbf{C}_b^e &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
      f_{ib,y}^e   &amp; -f_{ib,x}^e  &amp;       0     &amp;       0        &amp;       0       &amp;  0  &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{I}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
    };

    \foreach \r in {1,3,4,6,7,9} {
      \foreach \c in {1,3,4,6,7,9,10,12,13,15} {
        \coordinate (m-\r-\c-nw) at (100,-100);
        \coordinate (m-\r-\c-se) at (-100,100);

        \foreach \row in {1,...,9} {
          \path let \p1=(m-\row-\c.west), \p2=(m-\r-\c-nw) in coordinate (m-\r-\c-nw) at ({min(\x1,\x2)},\y2);
          \path let \p1=(m-\row-\c.east), \p2=(m-\r-\c-se) in coordinate (m-\r-\c-se) at ({max(\x1,\x2)},\y2);
        }
        \foreach \col in {1,...,15} {
          \path let \p1=(m-\r-\col.north), \p2=(m-\r-\c-nw) in coordinate (m-\r-\c-nw) at (\x2,{max(\y1,\y2)});
          \path let \p1=(m-\r-\col.south), \p2=(m-\r-\c-se) in coordinate (m-\r-\c-se) at (\x2,{min(\y1,\y2)});
        }
      }
    }

    \path let \p1=(m-1-1-nw), \p2=(m-1-15-se) in coordinate (m-1-15-ne) at (\x2,\y1);
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1-nw) -- node[above=2pt] {$\mathbf{F}$} (m-1-15-ne);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1-nw}{m-3-3-se}
      \fhighlight[orange!20]{m-1-13-nw}{m-3-15-se}
      \fhighlight[purple!20]{m-4-1-nw}{m-6-3-se}
      \fhighlight[blue!20]{m-4-4-nw}{m-6-6-se}
      \fhighlight[violet!20]{m-4-7-nw}{m-6-9-se}
      \fhighlight[red!20]{m-4-10-nw}{m-6-12-se}
      \fhighlight[cyan!20]{m-7-4-nw}{m-9-6-se}
    \end{pgfonlayer}
  \end{tikzpicture}
  \cdot
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},row sep=0.3em, column sep=0.4em,
                nodes={rectangle,text width=2.4em,align=center,minimum height=2.3em,anchor=center},] {
      \delta \psi_{eb,1}^e  \\ \delta \psi_{eb,2}^e  \\ \delta \psi_{eb,3}^e  \\
      \delta v_{eb,x}^e     \\ \delta v_{eb,y}^e     \\ \delta v_{eb,z}^e     \\
      \delta r_{eb,x}^e     \\ \delta r_{eb,y}^e     \\ \delta r_{eb,z}^e     \\
      \delta f_{x}^{b}      \\ \delta f_{y}^{b}      \\ \delta f_{z}^{b}      \\
      \delta \omega_{x}^{b} \\ \delta \omega_{y}^{b} \\ \delta \omega_{z}^{b} \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta}\mathbf{x}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-3-1}
      \fhighlight[blue!20]{m-4-1}{m-6-1}
      \fhighlight[cyan!20]{m-7-1}{m-9-1}
      \fhighlight[red!20]{m-10-1}{m-12-1}
      \fhighlight[orange!20]{m-13-1}{m-15-1}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_244.svg" width="1990" height="728"/>
</p>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.2.3, eq. 14.48, p. 583</li>
</ul>
<h1><a class="anchor" id="LooselyCoupledKF_e-Noise"></a>
Augmented State with Noise</h1>
<p>The continuous linear dynamic system can be expressed as <a class="anchor" id="eq-LCKF_e-dynamicModel"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-dynamicModel}
  \boldsymbol{\delta} \mathbf{\dot{x}} = \mathbf{F} \cdot \boldsymbol{\delta} \mathbf{x} + \mathbf{G} \cdot \mathbf{w}
\end{equation}" src="form_245.svg" width="1549" height="19"/>
</p>
<p>Process noise is introduced into the <img class="formulaInl" alt="$ \mathbf{F} $" src="form_246.svg" width="12" height="14"/> and <img class="formulaInl" alt="$ \mathbf{G} $" src="form_247.svg" width="16" height="14"/> matrices in the accelerometer and gyroscope bias terms. Therefore the error equations can be extended as follows</p>
<p><a class="anchor" id="eq-LCKF_e-dynamicModel-short"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-dynamicModel-short}
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},nodes={rectangle,text width=1.8em,align=center},row sep=0.3em, column sep=0.4em] {
      \boldsymbol{\delta \dot{\psi}}_{eb}^e \\
      \boldsymbol{\delta \dot{v}}_{eb}^e \\
      \boldsymbol{\delta \dot{r}}_{eb}^e \\
      \boldsymbol{\delta \dot{f}}_{ib}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta} \mathbf{\dot{x}}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-1}{m-2-1}
      \fhighlight[cyan!20]{m-3-1}{m-3-1}
      \fhighlight[red!20]{m-4-1}{m-4-1}
      \fhighlight[orange!20]{m-5-1}{m-5-1}
    \end{pgfonlayer}
  \end{tikzpicture}
  =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=2.5em,align=center},row sep=0.3em, column sep=0.4em]
    {
      \mathbf{F}_{\dotup{\psi},\psi}^e     &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;       \mathbf{C}_b^e       \\
      \mathbf{F}_{\delta \dotup{v},\psi}^e &amp; \mathbf{F}_{\delta \dotup{v},\delta v}^e &amp; \mathbf{F}_{\delta \dotup{v},\delta r}^e &amp;    \mathbf{C}_b^e    &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{I}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; -\boldsymbol{\beta}_f &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;  -\boldsymbol{\beta}_\omega \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\mathbf{F}$} (m-1-5.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[orange!20]{m-1-5}{m-1-5}
      \fhighlight[purple!20]{m-2-1}{m-2-1}
      \fhighlight[blue!20]{m-2-2}{m-2-2}
      \fhighlight[violet!20]{m-2-3}{m-2-3}
      \fhighlight[red!20]{m-2-4}{m-2-4}
      \fhighlight[cyan!20]{m-3-2}{m-3-2}
      \fhighlight[magenta!20]{m-4-4}{m-4-4}
      \fhighlight[olive!20]{m-5-5}{m-5-5}
    \end{pgfonlayer}
  \end{tikzpicture}
  \cdot
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=1.8em,align=center},row sep=0.3em, column sep=0.4em] {
      \boldsymbol{\delta \psi}_{eb}^e \\
      \boldsymbol{\delta v}_{eb}^e \\
      \boldsymbol{\delta r}_{eb}^e \\
      \boldsymbol{\delta f}_{ib}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\boldsymbol{\delta} \mathbf{x}$} (m-1-1.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-1}{m-2-1}
      \fhighlight[cyan!20]{m-3-1}{m-3-1}
      \fhighlight[red!20]{m-4-1}{m-4-1}
      \fhighlight[orange!20]{m-5-1}{m-5-1}
    \end{pgfonlayer}
  \end{tikzpicture}
  +
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=2em,align=center},row sep=0.3em, column sep=0.4em]
    {
       \mathbf{C}_b^e &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{C}_b^e &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
    };
    \draw[decorate,transform canvas={yshift=.5em},thick] (m-1-1.north west) -- node[above=2pt] {$\mathbf{G}$} (m-1-4.north east);

    \begin{pgfonlayer}{background}
      \fhighlight[darkgray!20]{m-1-1}{m-1-1}
      \fhighlight[brown!20]{m-2-2}{m-2-2}
      \fhighlight[pink!20]{m-4-3}{m-4-3}
      \fhighlight[lightgray!20]{m-5-4}{m-5-4}
    \end{pgfonlayer}
  \end{tikzpicture}
  \cdot
  \mathbf{w}
\end{equation}" src="form_248.svg" width="1902" height="215"/>
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-RW"></a>
Random Walk</h2>
<p>The random noise on the accelerometer and gyro measurements can be estimated as a Random Walk in the angle and velocity errors.</p>
<p><a class="anchor" id="eq-LCKF_e-random-walk"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk}
  \dotup{x} = 0 + W(t)
\end{equation}" src="form_249.svg" width="1524" height="19"/>
</p>
<p>In general, the noise can have an arbitrary characteristic. In a Kalman filter, however, it must be normally distributed and is therefore limited to a Wiener Process. The terms in the noise input matrix <img class="formulaInl" alt="$ \mathbf{G} $" src="form_247.svg" width="16" height="14"/> are not scaled and therefore need to be compensated with a noise scale matrix <img class="formulaInl" alt="$ \mathbf{W} $" src="form_100.svg" width="21" height="14"/> depending on the amplitude of the noise process. The amplitude is defined by the standard deviation <img class="formulaInl" alt="$\sigma$" src="form_250.svg" width="11" height="11"/>. This parameter can be chosen by the user for the accel and gyro measurements:</p>
<p><a class="anchor" id="eq-LCKF_e-random-walk-S-noise"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-S-noise}
  \highlight[darkgray!20]{S_{ra,j}} = \sigma_{ra,j}, \qquad
  \highlight[brown!20]{S_{rg,j}} = \sigma_{rg,j}, \qquad\qquad j \in x,y,z
\end{equation}" src="form_251.svg" width="1675" height="28"/>
</p>
<p> where</p><ul>
<li><img class="formulaInl" alt="$ \sigma_{ra} $" src="form_69.svg" width="25" height="12"/> is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li><img class="formulaInl" alt="$ \sigma_{rg} $" src="form_252.svg" width="25" height="14"/> is the standard deviation of the noise on the gyro angular-rate measurements</li>
</ul>
<p>The bias states are also modeled as a random process. In case of random walk, their amplitudes are defined analogously to the above and <img class="formulaInl" alt="$\beta = 0$" src="form_253.svg" width="44" height="18"/>.</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-GM1"></a>
Gauss-Markov 1. Order</h2>
<p>Another option to model the bias states is given by the Gauss-Markov 1. Order process:</p>
<p><a class="anchor" id="eq-LCKF_e-gauss-markov-1"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-gauss-markov-1}
  \dotup{x} = -\beta x + W(t)
\end{equation}" src="form_254.svg" width="1537" height="19"/>
</p>
<p>This introduces a deterministic part into the equation, namely the correlation coefficient <img class="formulaInl" alt="$\beta$" src="form_255.svg" width="11" height="18"/>. This parameter defines, how much a current state is correlated with past states. The elements of the <img class="formulaInl" alt="$ \mathbf{F} $" src="form_246.svg" width="12" height="14"/> matrix are then <a class="anchor" id="eq-LCKF_e-random-walk-beta"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-beta}
  \highlight[magenta!20]{\boldsymbol{\beta}_f} = \begin{pmatrix} \beta_{f} &amp;      0     &amp;      0     \\
                                                                    0       &amp; \beta_{f} &amp;      0     \\
                                                                    0       &amp;      0     &amp; \beta_{f} \end{pmatrix}, \qquad
  \highlight[olive!20]{\boldsymbol{\beta}_\omega} = \begin{pmatrix} \beta_{\omega} &amp;        0        &amp;        0        \\
                                                                           0        &amp; \beta_{\omega} &amp;        0        \\
                                                                           0        &amp;        0        &amp; \beta_{\omega} \end{pmatrix}
\end{equation}" src="form_256.svg" width="1675" height="63"/>
</p>
<p> where</p><ul>
<li><img class="formulaInl" alt="$ \beta_{f} $" src="form_257.svg" width="18" height="19"/> is the Gauss-Markov constant for the accelerometer ùõΩ = 1 / ùúè (ùúè correlation length)</li>
<li><img class="formulaInl" alt="$ \beta_{\omega} $" src="form_258.svg" width="19" height="18"/> is the Gauss-Markov constant for the gyroscope ùõΩ = 1 / ùúè (ùúè correlation length)</li>
</ul>
<p>Like before, the scaling is done inside the noise scale matrix. Now, the bias noise's amplitude is given by <a class="anchor" id="eq-LCKF_e-random-walk-S-bias_Brown"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-S-bias_Brown}
  \highlight[pink!20]{S_{bad,j}} = \sqrt{\frac{2\sigma_{bad,j}^2}{\tau_{bad}}} , \qquad
  \highlight[lightgray!20]{S_{bgd,j}} = \sqrt{\frac{2\sigma_{bgd,j}^2}{\tau_{bgd}}}, \qquad\qquad j \in x,y,z
\end{equation}" src="form_259.svg" width="1719" height="54"/>
</p>
<p> with a given standard deviation of <img class="formulaInl" alt="$\sigma_{bad}$" src="form_260.svg" width="32" height="12"/> for the accelerometer's bias noise and <img class="formulaInl" alt="$\sigma_{bgd}$" src="form_261.svg" width="32" height="14"/> for the gyro's bias noise. The correlation lengths <img class="formulaInl" alt="$ \tau_{bad} $" src="form_262.svg" width="30" height="12"/> and <img class="formulaInl" alt="$ \tau_{bgd} $" src="form_263.svg" width="28" height="14"/> define how much a current state is correlated to values in the past. This process is generally limited to normal distributions. A detailed example of this type of system can be found in Brown &amp; Hwang <a class="el" href="citelist.html#CITEREF_Brown2011">[8]</a> (example 9.6).</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-Scale-matrix"></a>
Noise scale matrix W</h2>
<p><a class="anchor" id="eq-LCKF_e-random-walk-noise-scale-matrix-W"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-noise-scale-matrix-W}
  \mathbf{W} =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},
                nodes={rectangle,text width=2em,align=center},row sep=0.3em, column sep=0.4em]
    {
      \mathbf{S}_{rg} &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{S}_{ra} &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{S}_{bad} &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{S}_{bgd} \\
    };

    \begin{pgfonlayer}{background}
      \fhighlight[darkgray!20]{m-1-1}{m-1-1}
      \fhighlight[brown!20]{m-2-2}{m-2-2}
      \fhighlight[pink!20]{m-3-3}{m-3-3}
      \fhighlight[lightgray!20]{m-4-4}{m-4-4}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_264.svg" width="1622" height="138"/>
</p>
<p><img class="formulaInl" alt="$ \mathbf{S}_{rg}, \mathbf{S}_{ra}, \mathbf{S}_{bad}, \mathbf{S}_{bgd} $" src="form_265.svg" width="140" height="18"/> are diagonal matrices where entries are filled with the PSDs from <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-random-walk-S-noise"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-random-walk-S-noise}" src="form_266.svg" width="44" height="19"/> </a> and <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-random-walk-S-bias"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-random-walk-S-bias}" src="form_267.svg" width="44" height="19"/> </a> or <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-random-walk-S-bias_Brown"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-random-walk-S-bias_Brown}" src="form_268.svg" width="44" height="19"/> </a>.</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Groves-process-noise-definition"></a>
Groves' process noise definition</h2>
<p>In Groves <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a>, process noise is defined without the need of integration. Instead, noise amplitudes are given directly integrated over one time step <img class="formulaInl" alt="$\tau_i$" src="form_269.svg" width="12" height="12"/>. Therefore, the <b>PSDs of the accelerometer and gyro noise</b> are: <a class="anchor" id="eq-LCKF_e-random-walk-S-noise-Groves"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-S-noise-Groves}
  \highlight[darkgray!20]{S_{ra,j}} = \sigma_{ra,j}^2 \tau_i, \qquad
  \highlight[brown!20]{S_{rg,j}} = \sigma_{rg,j}^2 \tau_i, \qquad\qquad j \in x,y,z
\end{equation}" src="form_270.svg" width="1689" height="28"/>
</p>
<p> where</p><ul>
<li><img class="formulaInl" alt="$ \sigma_{ra} $" src="form_69.svg" width="25" height="12"/> is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li><img class="formulaInl" alt="$ \sigma_{rg} $" src="form_252.svg" width="25" height="14"/> is the standard deviation of the noise on the gyro angular-rate measurements</li>
<li><img class="formulaInl" alt="$ \tau_i $" src="form_271.svg" width="12" height="12"/> is the interval between the input of successive accelerometer and gyro outputs to the inertial navigation equations</li>
</ul>
<p>The bias states are modeled by Groves with the noise PSD's: <a class="anchor" id="eq-LCKF_e-random-walk-S-bias"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-random-walk-S-bias}
  \highlight[pink!20]{S_{bad,j}} = \frac{\sigma_{bad,j}^2}{\tau_{bad}} , \qquad
  \highlight[lightgray!20]{S_{bgd,j}} = \frac{\sigma_{bgd,j}^2}{\tau_{bgd}}, \qquad\qquad j \in x,y,z
\end{equation}" src="form_272.svg" width="1692" height="47"/>
</p>
<p> where</p><ul>
<li><img class="formulaInl" alt="$ \sigma_{bad} $" src="form_273.svg" width="32" height="12"/> and <img class="formulaInl" alt="$ \sigma_{bgd} $" src="form_274.svg" width="32" height="14"/> are the standard deviations of the accelerometer and gyro dynamic biases</li>
<li><img class="formulaInl" alt="$ \tau_{bad} $" src="form_262.svg" width="30" height="12"/> and <img class="formulaInl" alt="$ \tau_{bgd} $" src="form_263.svg" width="28" height="14"/> are the correlation times of the dynamic accelerometer and gyro biases</li>
</ul>
<p>see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.2.6, eq. 14.84, p. 592</p>
<p>Although correlation lengths <img class="formulaInl" alt="$\tau_{bad} $" src="form_275.svg" width="30" height="12"/> and <img class="formulaInl" alt="$ \tau_{bgd} $" src="form_263.svg" width="28" height="14"/> are considered, this process is rather a random walk than a Gauss-Markov 1. order process, because of the missing deterministic part in <img class="formulaInl" alt="$\mathbf{F}$" src="form_276.svg" width="12" height="14"/>.</p>
<p>In INSTINCT, Groves' method <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-random-walk-S-bias"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-random-walk-S-bias}" src="form_267.svg" width="44" height="19"/> </a> is not altered from its reference <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> to avoid confusion.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-KF-Matrices"></a>
Kalman-Filter Matrices</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-Phi-Q"></a>
State transition matrix ùöΩ &amp; Process noise covariance matrix Q</h2>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Phi"></a>
State transition matrix ùöΩ</h3>
<h4><a class="anchor" id="autotoc_md6"></a>
Exponential Matrix</h4>
<p>The state transition matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_e-Phi-exp"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Phi-exp}
  \boldsymbol{\Phi} = \exp{(\mathbf{F} \tau_s)}
\end{equation}" src="form_277.svg" width="1526" height="19"/>
</p>
<p>see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 3.2.3, eq. 3.33, p. 97</p>
<h4><a class="anchor" id="autotoc_md7"></a>
Taylor series</h4>
<p>The exponential matrix cannot be calculated directly and numerical methods are computationally intensive. Therefore the transition matrix can be computed as a power-series expansion</p>
<p><a class="anchor" id="eq-LCKF_e-Phi-Taylor"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Phi-Taylor}
  \boldsymbol{\Phi} = \sum_{r=0}^{\infty} \frac{\mathbf{F}^r \tau_s^r}{r!} = \mathbf{I} + \mathbf{F} \tau_s + \frac{1}{2} \mathbf{F}^2 \tau^2 + \frac{1}{6} \mathbf{F}^3 \tau_s^3 + \dots
\end{equation}" src="form_278.svg" width="1659" height="51"/>
</p>
<p>see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 3.2.3, eq. 3.34, p. 98</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Q"></a>
Process noise covariance matrix Q</h3>
<p>The process noise covariance matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_e-Q-exact"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Q-exact}
  \mathbf{Q}_{k-1} = \int_{t_k - \tau_s}^{t_k} \exp{(\mathbf{F}_{k-1} (t_k-t'))} \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \exp{(\mathbf{F}_{k-1}^T (t_k-t'))} dt'
\end{equation}" src="form_279.svg" width="1750" height="47"/>
</p>
<p>In Groves <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a>, this matrix is approximated as (see ch. 3.2.3, eq. 3.43/3.45, p. 99):</p>
<p><a class="anchor" id="eq-LCKF_e-Q-approx"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Q-approx}
  \mathbf{Q}_{k-1} \approx \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \tau_s
\end{equation}" src="form_280.svg" width="1577" height="21"/>
</p>
<p>This method resembles a Taylor expansion up to 1. order. Since Groves <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> models the IMU measurements and their biases as random walk processes (see section <a class="el" href="group__LooselyCoupledKF__e.html#LooselyCoupledKF_e-Groves-process-noise-definition">Groves' process noise definition</a>), only the van-Loan-method can be configured to model biases as Gauss-Markov 1. order processes.</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Phi-Q-Van-Loan"></a>
Van Loan method</h3>
<p>The state transition matrix and the system/process noise covariance matrix can be calculated with the van Loan method <a class="el" href="citelist.html#CITEREF_Loan1978">[38]</a> . In short</p>
<ol type="1">
<li>Form a <img class="formulaInl" alt="$ 2n \times 2n $" src="form_96.svg" width="60" height="14"/> matrix called <img class="formulaInl" alt="$ \mathbf{A} $" src="form_97.svg" width="16" height="14"/> ( <img class="formulaInl" alt="$ n $" src="form_98.svg" width="11" height="11"/> is the dimension of <img class="formulaInl" alt="$ \mathbf{x} $" src="form_99.svg" width="11" height="11"/> and <img class="formulaInl" alt="$ \mathbf{W} $" src="form_100.svg" width="21" height="14"/> is the power spectral density of the noise <img class="formulaInl" alt="$ W(t) $" src="form_101.svg" width="39" height="19"/>) <a class="anchor" id="eq-LCKF_e-Loan-A"></a> <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Loan-A}
  \mathbf{A} = \begin{bmatrix} -\mathbf{F} &amp; \mathbf{G} \mathbf{W} \mathbf{G}^T \\
                                \mathbf{0} &amp;            \mathbf{F}^T          \end{bmatrix} \Delta t
\end{equation}" src="form_281.svg" width="1566" height="42"/>
</p>
</li>
<li>Calculate the exponential of <img class="formulaInl" alt="$ \mathbf{A} $" src="form_97.svg" width="16" height="14"/> <a class="anchor" id="eq-LCKF_e-Loan-B"></a> <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Loan-B}
  \mathbf{B} = \text{expm}(\mathbf{A}) = \left[ \begin{array}{c;{2pt/2pt}c}
                                            \dots          &amp; \mathbf{\Phi}^{-1} \mathbf{Q} \\[2mm]
                                            \hdashline[2pt/2pt] &amp;                                  \\[-2mm]
                                            \mathbf{0}          &amp; \mathbf{\Phi}^T                     \end{array} \right]
                                       = \begin{bmatrix} \mathbf{B}_{11} &amp; \mathbf{B}_{12} \\
                                                         \mathbf{B}_{21} &amp; \mathbf{B}_{22} \end{bmatrix}
\end{equation}" src="form_282.svg" width="1661" height="67"/>
</p>
</li>
<li>Calculate the state transition matrix <img class="formulaInl" alt="$ \mathbf{\Phi} $" src="form_104.svg" width="14" height="14"/> as <a class="anchor" id="eq-LCKF_e-Loan-Phi"></a> <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Loan-Phi}
  \mathbf{\Phi} = \mathbf{B}_{22}^T
\end{equation}" src="form_283.svg" width="1505" height="21"/>
</p>
</li>
<li>Calculate the process noise covariance matrix <img class="formulaInl" alt="$ \mathbf{Q} $" src="form_106.svg" width="14" height="16"/> as <a class="anchor" id="eq-LCKF_e-Loan-Q"></a> <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Loan-Q}
  \mathbf{Q} = \mathbf{\Phi} \mathbf{B}_{12}
\end{equation}" src="form_284.svg" width="1512" height="19"/>
</p>
</li>
</ol>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-P"></a>
Error covariance matrix P</h2>
<p>The error covariance matrix is initialized as a diagonal matrix with the variance of the initial state as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_e-P"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-P}
  \mathbf{P}_0 =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},row sep=0.3em, column sep=0.4em,
                nodes={rectangle,text width=2.5em,align=center,minimum height=2.3em,anchor=center},] {
      \boldsymbol{\sigma}_{\boldsymbol{\delta \psi}}^2 &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp;                        \mathbf{0}_3                       \\
                                                       &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta v^e}}^2 &amp;                                                 &amp;                    \iddots                      &amp;                                                           \\
                           \vdots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta r^e}}^2 &amp;                                                 &amp;                          \vdots                           \\
                                                       &amp;                    \iddots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta f^b}}^2 &amp;                                                           \\
                        \mathbf{0}_3                   &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta \omega^b_{ib}}}^2 \\
    };

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-2}{m-2-2}
      \fhighlight[cyan!20]{m-3-3}{m-3-3}
      \fhighlight[red!20]{m-4-4}{m-4-4}
      \fhighlight[orange!20]{m-5-5}{m-5-5}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_285.svg" width="1670" height="233"/>
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-deltaz"></a>
Measurement innovation ùõøz</h2>
<p><a class="anchor" id="eq-LCKF_e-deltaz"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-deltaz}
  \boldsymbol{\delta} \mathbf{z}^e = \begin{pmatrix} \tilde{\mathbf{r}}_{b,G}^e - \hat{\mathbf{r}}_{b}^e - \mathbf{C}_b^e \mathbf{l}_{ba}^b \\
                                      \tilde{\mathbf{v}}^e_{G} - \hat{\mathbf{v}}^e - \mathbf{C}_b^e (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) + \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e \mathbf{l}_{ba}^b \end{pmatrix}
\end{equation}" src="form_286.svg" width="1647" height="44"/>
</p>
<p>where</p><ul>
<li><img class="formulaInl" alt="$ G $" src="form_287.svg" width="14" height="14"/> denotes GNSS indicated measurements</li>
<li><img class="formulaInl" alt="$ \mathbf{l}_{ba}^b $" src="form_288.svg" width="19" height="21"/> is the lever arm from the INS to the GNSS antenna in [m]</li>
</ul>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.3.1, eq. 14.102, p. 598</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-H"></a>
Measurement sensitivity Matrix H</h2>
<p><a class="anchor" id="eq-LCKF_e-H-general"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-H-general}
  \mathbf{H}_k = \left. \frac{\partial \mathbf{h} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
               = \left. \frac{\partial \mathbf{z} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
\end{equation}" src="form_289.svg" width="1624" height="49"/>
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 3.4.1, eq. 3.90, p. 119</li>
</ul>
<p><a class="anchor" id="eq-LCKF_e-H"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-H}
  \mathbf{H}^e =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},row sep=0.3em, column sep=0.4em,
                nodes={rectangle,text width=2.5em,align=center,minimum height=2.3em,anchor=center},] {
      \mathbf{H}_{r,\delta \psi}^e &amp;  \mathbf{0}_3 &amp; -\mathbf{I}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3                          \\
      \mathbf{H}_{v,\delta \psi}^e &amp; -\mathbf{I}_3 &amp;  \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{H}_{v,\omega_{ib}^b}^e \\
    };

    \begin{pgfonlayer}{background}
      \fhighlight[green!20]{m-1-1}{m-1-1}
      \fhighlight[green!20]{m-2-1}{m-2-1}
      \fhighlight[blue!20]{m-2-2}{m-2-2}
      \fhighlight[cyan!20]{m-1-3}{m-1-3}
      \fhighlight[orange!20]{m-2-5}{m-2-5}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_290.svg" width="1671" height="96"/>
</p>
<p>where <a class="anchor" id="eq-LCKF_e-H-sub"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-H-sub}
\begin{aligned}
  \highlight[green!20]{\mathbf{H}_{r,\delta \psi}^e}    &amp;\approx \left[ (\mathbf{C}_b^e \mathbf{l}_{ba}^b) \times \right] \\
  \highlight[green!20]{\mathbf{H}_{v,\delta \psi}^e}    &amp;\approx \left[ \left\{ \mathbf{C}_b^e (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) - \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e \mathbf{l}_{ba}^b \right\} \times \right] \\
  \highlight[orange!20]{\mathbf{H}_{v,\omega_{ib}^b}^e} &amp;\approx \mathbf{C}_b^e \left[ \mathbf{l}_{ba}^b \times \right] \\
\end{aligned}
\end{equation}" src="form_291.svg" width="1636" height="110"/>
</p>
<p>See</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.3.1, eq. 14.111/14.112, p. 600</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-R"></a>
Measurement noise covariance matrix R</h2>
<p>The measurement noise covariance matrix is a diagonal matrix with the variances of the measurements as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_e-R"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-R}
  \mathbf{R} = E \left( (\mathbf{z} - \mathbf{H} \mathbf{x})(\mathbf{z} - \mathbf{H} \mathbf{x})^T \right) =
  \begin{tikzpicture}[baseline=-\the\dimexpr\fontdimen22\textfont2\relax,decoration=brace]
    \matrix (m)[matrix of math nodes,left delimiter={(},right delimiter={)},row sep=0.3em, column sep=0.1em,
                nodes={rectangle,text width=2.2em,align=center,minimum height=2.3em,anchor=center},] {
      \boldsymbol{\sigma}^2_{\mathbf{z}_{\boldsymbol{\delta r}^e}} &amp;                         \mathbf{0}_3                         \\
                              \mathbf{0}_3                         &amp; \boldsymbol{\sigma}^2_{\mathbf{z}_{\boldsymbol{\delta v}^e}} \\
    };

    \begin{pgfonlayer}{background}
      \fhighlight[cyan!20]{m-1-1}{m-1-1}
      \fhighlight[blue!20]{m-2-2}{m-2-2}
    \end{pgfonlayer}
  \end{tikzpicture}
\end{equation}" src="form_292.svg" width="1670" height="96"/>
</p>
<p>This variances can be set static or ideally come from the GNSS receiver.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-Corrections"></a>
Corrections</h1>
<p>This section describes how the errors are applied to the total state.</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Corrections-State"></a>
Position, Velocity, Attitude</h2>
<p>The position and velocity errors get applied by simply subtracting them from the previous total state (see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.1.1, eq. 14.8, 14.9, p. 564)</p>
<p><a class="anchor" id="eq-LCKF_e-correction-position-velocity"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-correction-position-velocity}
\begin{aligned}
  \boldsymbol{r}^{e,+} &amp;= \boldsymbol{r}^{e,-} - \boldsymbol{\delta r}^{e} \\
  \boldsymbol{v}^{e,+} &amp;= \boldsymbol{v}^{e,-} - \boldsymbol{\delta v}^{e}
\end{aligned}
\end{equation}" src="form_293.svg" width="1542" height="44"/>
</p>
<p>The attitude correction can be derived from equation <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-estimate-errors"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-estimate-errors}" src="form_294.svg" width="44" height="19"/> </a> (see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.1.1, eq. 14.7, p. 564) <a class="anchor" id="eq-LCKF_e-correction-attitude"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-correction-attitude}
  \mathbf{C}_b^{e,+} = (\mathbf{I}_3 - [\boldsymbol{\delta \psi} \times]) \mathbf{C}_b^{e,-}
\end{equation}" src="form_295.svg" width="1570" height="25"/>
</p>
<p>After applying the errors to the total state, the errors have to be reset to zero (closed-loop).</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Corrections-Bias"></a>
Biases</h2>
<p>To correct the accelerometer and gyroscope measurements, we need to accumulate the error states. This has to be done, because contrary to the normal state, the expected value of the biases is not zero.</p>
<p><a class="anchor" id="eq-LCKF_e-correction-accel-gyro-accumulate"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-correction-accel-gyro-accumulate}
\begin{aligned}
  \boldsymbol{\Delta f}^{b,+}           &amp;= \boldsymbol{\Delta f}^{b,-}           + \boldsymbol{\delta f}^b \\
  \boldsymbol{\Delta \omega}_{ib}^{b,+} &amp;= \boldsymbol{\Delta \omega}_{ib}^{b,-} + \boldsymbol{\delta \omega}_{ib}^b
\end{aligned}
\end{equation}" src="form_296.svg" width="1563" height="53"/>
</p>
<p>Afterwards this accumulated value can be applied to the measurements by subtracting it</p>
<p><a class="anchor" id="eq-LCKF_e-correction-accel-gyro"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-correction-accel-gyro}
\begin{aligned}
  \boldsymbol{f}^{p,+}           &amp;= \boldsymbol{f}^{p,-}           - \mathbf{C}_b^p \boldsymbol{\Delta f}^{b,+} \\
  \boldsymbol{\omega}_{ib}^{p,+} &amp;= \boldsymbol{\omega}_{ib}^{p,-} - \mathbf{C}_b^p \boldsymbol{\Delta \omega}_{ib}^{b,+}
\end{aligned}
\end{equation}" src="form_297.svg" width="1568" height="53"/>
</p>
<p>Afterwards the bias in the error state gets reset to zero, as it is accounted for in the accumulated value.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-Appendix"></a>
Appendix</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation"></a>
Derivation</h2>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Position"></a>
Position Equations</h3>
<p>The time derivative of the position is simply a function of the Earth-referenced velocity in Earth frame axes</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Position-timeDerivative"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Position-timeDerivative}
  \mathbf{\dot{r}}_{eb}^e = \mathbf{v}_{eb}^e
\end{equation}" src="form_298.svg" width="1507" height="19"/>
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 5.3.4, eq. 5.37, p. 175</li>
<li><a class="el" href="citelist.html#CITEREF_Jekeli2001">[17]</a> Jekeli, ch. 4.3.3, eq. 4.84, p. 126</li>
</ul>
<p>The time derivative of the position error thus is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Position-differential"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Position-differential}
  \boldsymbol{\delta}\mathbf{\dot{r}}_{eb}^e = \highlight[cyan!20]{\mathbf{I}_3} \cdot \mathbf{v}_{eb}^e
\end{equation}" src="form_299.svg" width="1531" height="26"/>
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.2.3, eq. 14.47, p. 583</li>
</ul>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Attitude"></a>
Attitude Equations</h3>
<p>The estimated attitude <img class="formulaInl" alt="$ \mathbf{\hat{C}}_b^e $" src="form_300.svg" width="21" height="23"/> can be written in terms of true direction cosine matrix <img class="formulaInl" alt="$ \mathbf{C}_b^e $" src="form_301.svg" width="21" height="18"/> <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-estimate-true"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-estimate-true}
  \mathbf{\hat{C}}_b^e = \mathbf{B} \mathbf{C}_b^e
\end{equation}" src="form_302.svg" width="1512" height="23"/>
</p>
<p> where <img class="formulaInl" alt="$ \mathbf{B} $" src="form_303.svg" width="14" height="14"/> is the transformation from true reference axes to estimated reference axes and it can be approximated for small angle misalignments as <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-transformation"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-transformation}
  \mathbf{B} = [\mathbf{I} - \mathbf{\Psi}], \quad \text{with}~ \mathbf{\Psi} = \begin{pmatrix} \delta\alpha \\ \delta\beta \\ \delta\gamma \end{pmatrix} \times
\end{equation}" src="form_304.svg" width="1603" height="63"/>
</p>
<p> with <img class="formulaInl" alt="$ \mathbf{\Psi} $" src="form_305.svg" width="16" height="14"/> being a skew symmetric matrix and <img class="formulaInl" alt="$ \delta\alpha, \delta\beta, \delta\gamma $" src="form_306.svg" width="74" height="19"/> being the attitude errors.</p>
<p>Substituting <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-transformation"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-transformation}" src="form_307.svg" width="44" height="19"/> </a> into <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-estimate-true"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-estimate-true}" src="form_308.svg" width="44" height="19"/> </a> gives <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-estimate-errors"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-estimate-errors}
  \mathbf{\hat{C}}_b^e \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e
\end{equation}" src="form_309.svg" width="1533" height="23"/>
</p>
<p>and solving for <img class="formulaInl" alt="$ \mathbf{\Psi} $" src="form_305.svg" width="16" height="14"/> <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-skew-mat}
  \mathbf{\Psi} = \mathbf{I} - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
\end{equation}" src="form_310.svg" width="1533" height="23"/>
</p>
<p>Differentiating this equation yields: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot}
  \mathbf{\dot{\Psi}} = -\mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} {\mathbf{C}_b^e}^T - \mathbf{\hat{C}}_b^e {\mathbf{\dot{C}}_b^e}\raise1.25ex\hbox{$\scriptstyle T$}
\end{equation}" src="form_311.svg" width="1563" height="26"/>
</p>
<p>Using the following equations for the transformation</p><ul>
<li>Angular rate splitting <img class="formulaInl" alt="$ \boldsymbol{\omega}_{\beta\alpha}^\gamma = \boldsymbol{\omega}_{\beta\delta}^\gamma + \boldsymbol{\omega}_{\delta\alpha}^\gamma $" src="form_312.svg" width="135" height="23"/> &emsp;<a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 2.3.1, eq. 2.48, p. 45</li>
<li>Skew-symmetric matrix transformation <img class="formulaInl" alt="$ \mathbf{\Omega}_{\beta\alpha}^\delta = \mathbf{C}_\gamma^\delta \mathbf{\Omega}_{\beta\alpha}^\gamma \mathbf{C}_\delta^\gamma $" src="form_313.svg" width="135" height="25"/> &emsp;<a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 2.3.1, eq. 2.51, p. 45</li>
</ul>
<p>the time derivative of the DCM matrix is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Attitude-DCM-dot"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-DCM-dot}
\begin{aligned}
  \mathbf{\dot{C}}_b^e &amp;= \mathbf{C}_b^e \boldsymbol{\Omega}_{eb}^b \\
                       &amp;= \mathbf{C}_b^e \boldsymbol{\Omega}_{ib}^b - \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e
\end{aligned}
\end{equation}" src="form_314.svg" width="1554" height="51"/>
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 5.3.1, eq. 5.24, p. 173</li>
<li><a class="el" href="citelist.html#CITEREF_Jekeli2001">[17]</a> Jekeli, ch. 4.3.3, eq. 4.83, p. 126</li>
<li><a class="el" href="citelist.html#CITEREF_Titterton2004">[37]</a> Titterton, ch. 3.5.2, eq. 3.22, p. 29</li>
</ul>
<p>where</p><ul>
<li><img class="formulaInl" alt="$ \mathbf{\Omega}_{ib}^b $" src="form_315.svg" width="26" height="21"/> is the skew-symmetric matrix of the absolute body rate,</li>
<li><img class="formulaInl" alt="$ \mathbf{\Omega}_{ie}^e $" src="form_316.svg" width="26" height="18"/> is the skew-symmetric matrix of the Earth rotation in Earth frame coordinates</li>
</ul>
<p>Similarly, the time time differential of the estimated matrix <img class="formulaInl" alt="$ \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} $" src="form_317.svg" width="21" height="26"/> can be calculated: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated}
  \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} = \mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e
\end{equation}" src="form_318.svg" width="1554" height="26"/>
</p>
<p>Substituting <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-DCM-dot"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-DCM-dot}" src="form_319.svg" width="44" height="19"/> </a> and <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated}" src="form_320.svg" width="44" height="19"/> </a> into <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-skew-mat-dot"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot}" src="form_321.svg" width="44" height="19"/> </a> <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= -(\mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e) {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e (\mathbf{C}_b^e \mathbf{\Omega}_{ib}^b - \mathbf{\Omega}_{ie}^e \mathbf{C}_b^e)^T \\
                      &amp;= - \mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{C}}_b^e \mathbf{\Omega}_{ib}^b {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e \\
                      &amp;= - \mathbf{\hat{C}}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e
\end{aligned}
\end{equation}" src="form_322.svg" width="1692" height="91"/>
</p>
<p>Substituting <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-estimate-errors"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-estimate-errors}" src="form_294.svg" width="44" height="19"/> </a> into <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1}" src="form_323.svg" width="44" height="19"/> </a> gives: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc2"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc2}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e {\mathbf{C}_b^e}^T
                         - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e \\
                      &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi}
                         - \mathbf{\Omega}_{ie}^e + \mathbf{\Psi} \mathbf{\Omega}_{ie}^e \\
                         &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                            + \left[ \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\Omega}_{ie}^e \right]
                            - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi} + \mathbf{\Psi} \mathbf{\Omega}_{ie}^e
\end{aligned}
\end{equation}" src="form_324.svg" width="1759" height="109"/>
</p>
<p>Now we make the following substitutions</p><ul>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e = \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\Omega}_{ie}^e $" src="form_325.svg" width="135" height="23"/></li>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b = \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b $" src="form_326.svg" width="133" height="23"/></li>
</ul>
<p>and neglect error product terms. This leads to <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-final"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-skew-mat-dot-final}
  \mathbf{\dot{\Psi}} \approx \mathbf{\Psi} \mathbf{\Omega}_{ie}^e - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi}
                              + \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e
                              - \mathbf{C}_b^e \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b {\mathbf{C}_b^e}^T
\end{equation}" src="form_327.svg" width="1629" height="23"/>
</p>
<p>Finally by performing an element by element comparison with <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-element-comp"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-element-comp}
  \boldsymbol{\psi} \times = \mathbf{\Psi} \qquad\quad
  \boldsymbol{\omega}_{ie}^e \times = \mathbf{\Omega}_{ie}^e \qquad\quad
  \boldsymbol{\delta \omega}_{ie}^e \times = \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e \qquad\quad
  \boldsymbol{\delta \omega}_{ib}^b \times = \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b
\end{equation}" src="form_328.svg" width="1738" height="23"/>
</p>
<p>the equation can be expressed in vector form as: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-differential"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Attitude-differential}
\begin{aligned}
  \boldsymbol{\dot{\psi}} &amp;\approx \highlight[green!20]{-\boldsymbol{\omega}_{ie}^e \times} \boldsymbol{\psi}
                                   + \overbrace{\boldsymbol{\delta \omega}_{ie}^e}^{= 0}
                                   \highlight[orange!20]{- \mathbf{C}_b^e} \boldsymbol{\delta \omega}_{ib}^b \\
                          &amp;= \highlight[green!20]{\begin{pmatrix} 0 &amp; \omega_{ie} &amp; 0 \\ -\omega_{ie} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{pmatrix}} \cdot \boldsymbol{\psi}
                             \highlight[orange!20]{- \mathbf{C}_b^e} \boldsymbol{\delta \omega}_{ib}^b \\
\end{aligned}
\end{equation}" src="form_329.svg" width="1617" height="130"/>
</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Velocity"></a>
Velocity Equations</h3>
<p>The time derivative of the velocity in Earth frame coordinates is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative}
  \boldsymbol{\dot{v}}^e
      = \overbrace{\boldsymbol{f}^e}^{\hidewidth\text{measured}\hidewidth}
        -\ \underbrace{2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e}_{\hidewidth\text{coriolis acceleration}\hidewidth}
        +\ \overbrace{\mathbf{g}^e}^{\hidewidth\text{gravity}\hidewidth}
\end{equation}" src="form_330.svg" width="1586" height="67"/>
</p>
<p> see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 5.3.3, eq. 5.35, p. 175</li>
<li><a class="el" href="citelist.html#CITEREF_Jekeli2001">[17]</a> Jekeli, ch. 4.3.3, eq. 4.82, p. 126</li>
<li><a class="el" href="citelist.html#CITEREF_Titterton2004">[37]</a> Titterton, ch. 3.5.2, eq. 3.21, p. 29</li>
</ul>
<p>where</p><ul>
<li><img class="formulaInl" alt="$ \boldsymbol{v}^e $" src="form_189.svg" width="18" height="14"/> is the velocity with respect to the Earth in Earth frame coordinates,</li>
<li><img class="formulaInl" alt="$ \boldsymbol{f}^e $" src="form_331.svg" width="19" height="19"/> is the specific force vector as measured by a triad of accelerometers and resolved into Earth frame coordinates</li>
<li><img class="formulaInl" alt="$ \boldsymbol{\omega}_{ie}^e $" src="form_332.svg" width="25" height="18"/> is the turn rate of the Earth expressed in Earth frame coordinates</li>
<li><img class="formulaInl" alt="$ \mathbf{g}^e $" src="form_333.svg" width="18" height="18"/> is the local gravity vector which is a combination of (see <a class="el" href="citelist.html#CITEREF_Titterton2004">[37]</a> Titterton, ch. 3.5.1, eq. 3.14, p. 27)<ul>
<li><img class="formulaInl" alt="$ \boldsymbol{\gamma}_{ib}^e $" src="form_334.svg" width="23" height="18"/> the gravitation vector (caused by effects of mass attraction)</li>
<li><img class="formulaInl" alt="$ -\boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{r}^e ] $" src="form_335.svg" width="131" height="19"/> the centrifugal acceleration caused by the Earth's rotation</li>
</ul>
</li>
</ul>
<p>The estimated velocity follows the same propagation <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate}
  \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle e$}}
      = \boldsymbol{\hat{f}}^e
      - 2 \boldsymbol{\hat{\omega}}_{ie}^e \times \boldsymbol{\hat{v}}_e^e
      + \mathbf{\hat{g}}^e
\end{equation}" src="form_336.svg" width="1570" height="25"/>
</p>
<p>Differencing equation <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Velocity-timeDerivative"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative}" src="form_337.svg" width="44" height="19"/> </a> and <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate}" src="form_338.svg" width="44" height="19"/> </a> we get <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-differential}
\begin{aligned}
  \boldsymbol{\delta} \boldsymbol{\dot{v}}^e &amp;= \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle e$}} - \boldsymbol{\dot{v}}^e \\
                                &amp;= \mathbf{\hat{C}}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\hat{\omega}}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                       + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \mathbf{\hat{g}}^e
                                       - \mathbf{g}^e
\end{aligned}
\end{equation}" src="form_339.svg" width="1684" height="56"/>
</p>
<ul>
<li>Substituting equation <a class="el" href="group__LooselyCoupledKF__e.html#eq-LCKF_e-Derivation-Attitude-estimate-errors"><img class="formulaInl" alt="\eqref{eq:eq-LCKF_e-Derivation-Attitude-estimate-errors}" src="form_294.svg" width="44" height="19"/> </a>: <img class="formulaInl" alt="$ \mathbf{\hat{C}}_b^e \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e $" src="form_340.svg" width="121" height="23"/></li>
<li>and writing<ul>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta} \boldsymbol{f}^b = \boldsymbol{\hat{f}}^b - \boldsymbol{f}^b $" src="form_341.svg" width="110" height="25"/></li>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta} \boldsymbol{v}^e = \boldsymbol{\hat{v}}^e - \boldsymbol{v}^e $" src="form_342.svg" width="109" height="16"/></li>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta} \boldsymbol{\omega}_{ie}^e = \boldsymbol{\hat{\omega}}_{ie}^e - \boldsymbol{\omega}_{ie}^e = 0 $" src="form_343.svg" width="163" height="19"/></li>
<li><img class="formulaInl" alt="$ \boldsymbol{\delta} \mathbf{g}^e = \mathbf{\hat{g}}^e - \mathbf{g}^e $" src="form_344.svg" width="107" height="19"/></li>
</ul>
</li>
</ul>
<p>we get <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation}
\begin{aligned}
  \boldsymbol{\delta \dot{v}}^e &amp;= [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                       + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= \mathbf{C}_b^e \boldsymbol{\hat{f}}^b - \mathbf{\Psi} \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                   + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= - \boldsymbol{\psi} \times \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                   + \highlight[red!20]{\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= (\mathbf{C}_b^e \boldsymbol{\delta f}^b + \mathbf{C}_b^e \boldsymbol{f}^b) \times \boldsymbol{\psi}
                                   + \highlight[red!20]{\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
\end{aligned}
\end{equation}" src="form_345.svg" width="1708" height="133"/>
</p>
<p> Now neglecting error product terms ( <img class="formulaInl" alt="$ \boldsymbol{\delta f}^b \times \boldsymbol{\psi} \approx 0 $" src="form_346.svg" width="96" height="23"/>) <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation-neglect"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation-neglect}
\renewcommand*{\arraystretch}{1.9}
  \boldsymbol{\delta \dot{v}}^e \approx \highlight[purple!20]{\boldsymbol{f}^e \times} \boldsymbol{\psi}
                                   + \highlight[red!20]{\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   \highlight[blue!20]{- 2 \boldsymbol{\omega}_{ie}^e \times} \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e
\end{equation}" src="form_347.svg" width="1642" height="30"/>
</p>
<p>The gravity error can be expressed as (see <a class="el" href="citelist.html#CITEREF_Groves2013">[14]</a> Groves, ch. 14.2.3, eq. 14.45, p. 583) <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-gravityError"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-gravityError}
\begin{aligned}
  \boldsymbol{\delta} \mathbf{g}^e = \overbrace{\boldsymbol{\hat{\gamma}}_{ib}^e - \boldsymbol{\gamma}_{ib}^e}^{\hidewidth\text{gravitation error}\hidewidth}
                                      - \underbrace{\boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \boldsymbol{\delta} \mathbf{r}_{eb}^e}_{\hidewidth\text{centrifugal acceleration error}\hidewidth}
                                   \approx - \frac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \frac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|} \boldsymbol{\delta} \mathbf{r}_{eb}^e
                                           - \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \boldsymbol{\delta} \mathbf{r}_{eb}^e
\end{aligned}
\end{equation}" src="form_348.svg" width="1708" height="70"/>
</p>
<p> where</p><ul>
<li>the assumption <img class="formulaInl" alt="$ h &lt;&lt; r_{eS}^e $" src="form_349.svg" width="70" height="18"/> is made</li>
</ul>
<p>This leads to the final form <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-final"></a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{eq:eq-LCKF_e-Derivation-Velocity-timeDerivative-final}
\renewcommand*{\arraystretch}{1.9}
  \boldsymbol{\delta \dot{v}}^e \approx \highlight[purple!20]{\boldsymbol{f}^e \times} \boldsymbol{\psi}
                                   + \highlight[red!20]{\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   + \highlight[blue!20]{\begin{pmatrix} 0 &amp; 2 \omega_{ie} &amp; \\ -2 \omega_{ie} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{pmatrix}} \boldsymbol{\delta v}^e
                                   \highlight[violet!20]{- \left(  \dfrac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \dfrac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|}
                                                                 + \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \right)} \boldsymbol{\delta} \mathbf{r}_{eb}^e
\end{equation}" src="form_350.svg" width="1790" height="133"/>
</p>
 </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <!-- id is needed for treeview function! -->
    <ul>
        <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer"
                    src="doxygen.svg" width="104" height="31" alt="doxygen" /></a> 1.9.8 </li>
    </ul>
</div>
</body>
</html>
