<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INSTINCT: INS/GNSS Loosely-coupled Kalman Filter (local-navigation frame)</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/color','[tex]/colortbl']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','color','colortbl']
  }
};
window.MathJax = {
    tex: {
        tags: 'ams'
    }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <!--Doxygen Awesome Theme related settings:-->
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeTabs.init()
  </script>
  <!--End of Doxygen Awesome settings-->
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="INSTINCT_Logo_Text.png"  /></td>
              <td id="projectalign">
                <div id="projectname"><span
                    id="projectnumber">&#160;0.3.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('LooselyCoupledKF_n.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">INS/GNSS Loosely-coupled Kalman Filter (local-navigation frame)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame"></a>
Local-Level Frame Error State Equations</h1>
<h2><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-ShortForm"></a>
Short form</h2>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix-short"></a>                        </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}} \\
      \boldsymbol{\delta \dot{v}}^{n} \\
      \boldsymbol{\delta \dot{p}}_b \\
      \boldsymbol{\delta \dot{f}}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
  \end{bmatrix}
  =
  \begin{bmatrix}
      \mathbf{F}_{\delta \dot{\psi},\delta \psi}^n &amp; \mathbf{F}_{\delta \dot{\psi},\delta v}^n &amp; \mathbf{F}_{\delta \dot{\psi},\delta r}^n &amp; \mathbf{0}_3   &amp; \mathbf{C}_b^n \\
      \mathbf{F}_{\delta \dot{v},\delta \psi}^n    &amp; \mathbf{F}_{\delta \dot{v},\delta v}^n    &amp; \mathbf{F}_{\delta \dot{v},\delta r}^n    &amp; \mathbf{C}_b^n &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                                   &amp; \mathbf{F}_{\delta \dot{r},\delta v}^n    &amp; \mathbf{F}_{\delta \dot{r},\delta r}^n    &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                                   &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                                   &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta \psi} \\
      \boldsymbol{\delta v}^{n} \\
      \boldsymbol{\delta p}_b \\
      \boldsymbol{\delta f}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \\
  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-DetailedForm"></a>
Detailed form</h2>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix"></a>                                  </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \dot{R}              \\ \delta \dot{P}              \\ \delta \dot{Y}              \\ \hdashline
      \delta \dot{v}_{N}          \\ \delta \dot{v}_{E}          \\ \delta \dot{v}_{D}          \\ \hdashline
      \delta \dot{\phi}           \\ \delta \dot{\lambda}        \\ \delta \dot{h}              \\ \hdashline
      \delta \dot{f}_{x}^{b}      \\ \delta \dot{f}_{y}^{b}      \\ \delta \dot{f}_{z}^{b}      \\ \hdashline
      \delta \dot{\omega}_{x}^{b} \\ \delta \dot{\omega}_{y}^{b} \\ \delta \dot{\omega}_{z}^{b} \\
  \end{bmatrix}
  =
  \left[ \begin{array}{ccc:ccc:ccc:ccc:ccc}
               0         &amp;  \omega_{in,3}^{n} &amp; -\omega_{in,2}^{n} &amp;                             0                            &amp;                    -\frac{1}{R_E + h}                     &amp;                       0                      &amp;                                    \omega_{ie}\sin{\phi}                                    &amp;      0       &amp;                             \frac{v_E}{(R_E + h)^2}                            &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
      -\omega_{in,3}^{n} &amp;          0         &amp;  \omega_{in,1}^{n} &amp;                    \frac{1}{R_N + h}                     &amp;                             0                             &amp;                       0                      &amp;                                             0                                               &amp;      0       &amp;                            -\frac{v_N}{(R_N + h)^2}                            &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp; \mathbf{C}_b^n &amp; \\
       \omega_{in,2}^{n} &amp; -\omega_{in,1}^{n} &amp;          0         &amp;                             0                            &amp;                 \frac{\tan{\phi}}{R_E + h}                &amp;                       0                      &amp;                  \omega_{ie}\cos{\phi} + \frac{v_E}{(R_E + h)\cos^2{\phi}}                  &amp;      0       &amp;                       -\frac{v_E \tan{\phi}}{(R_E + h)^2}                      &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
               0         &amp;         f_D        &amp;        -f_E        &amp;                    \frac{v_D}{R_N + h}                   &amp; -2\frac{v_E \tan{\phi}}{R_E + h} - 2\omega_{ie}\sin{\phi} &amp;              \frac{v_N}{R_N + h}             &amp;                -\frac{v_E^2}{(R_E+h)\cos^2{\phi}}-2v_E\omega_{ie}\cos{\phi}                 &amp;      0       &amp;          \frac{v_E^2\tan{\phi}}{(R_E+h)^2} - \frac{v_Nv_D}{(R_N+h)^2}          &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
             -f_D        &amp;          0         &amp;         f_N        &amp;  \frac{v_E \tan{\phi}}{R_E + h} + 2\omega_{ie}\sin{\phi} &amp;            \frac{v_N \tan{\phi} + v_D}{R_E + h}           &amp; \frac{v_E}{R_E + h} + 2\omega_{ie}\cos{\phi} &amp; \frac{v_N v_E}{(R_E+h)\cos^2{\phi}} + 2v_N\omega_{ie}\cos{\phi} - 2v_D\omega_{ie}\sin{\phi} &amp;      0       &amp;                 -\frac{v_Nv_E\tan{\phi} + v_Ev_D}{(R_E + h)^2}                 &amp;  &amp; \mathbf{C}_b^n &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
              f_E        &amp;        -f_N        &amp;          0         &amp;                  -\frac{2v_N}{R_N + h}                   &amp;       -\frac{2v_E}{R_E + h} - 2\omega_{ie}\cos{\phi}      &amp;                       0                      &amp;                                  2v_E\omega_{ie}\sin{\phi}                                  &amp;      0       &amp; \frac{v_E^2}{(R_E + h)^2} + \frac{v_N^2}{(R_N + h)^2} - \frac{2 g_0}{r_{eS}^e} &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                         &amp;                    &amp;                    &amp;                      \frac{1}{R_N+h}                     &amp;                             0                             &amp;                       0                      &amp;                                             0                                               &amp;      0       &amp;                            -\frac{v_N}{(R_N + h)^2}                            &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                         &amp;    \mathbf{0}_3    &amp;                    &amp;                             0                            &amp;                \frac{1}{(R_E+h)\cos{\phi}}                &amp;                       0                      &amp;                           \frac{v_E\tan{\phi}}{(R_E+h)\cos{\phi}}                           &amp;      0       &amp;                       -\frac{v_E}{(R_E + h)^2\cos{\phi}}                       &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                         &amp;                    &amp;                    &amp;                             0                            &amp;                             0                             &amp;                      -1                      &amp;                                             0                                               &amp;      0       &amp;                                        0                                       &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                         &amp;                    &amp;                    &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                             &amp;              &amp;                                                                                &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                         &amp;    \mathbf{0}_3    &amp;                    &amp;                                                          &amp;                       \mathbf{0}_3                        &amp;                                              &amp;                                                                                             &amp; \mathbf{0}_3 &amp;                                                                                &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                         &amp;                    &amp;                    &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                             &amp;              &amp;                                                                                &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                         &amp;                    &amp;                    &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                             &amp;              &amp;                                                                                &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                         &amp;    \mathbf{0}_3    &amp;                    &amp;                                                          &amp;                       \mathbf{0}_3                        &amp;                                              &amp;                                                                                             &amp; \mathbf{0}_3 &amp;                                                                                &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                         &amp;                    &amp;                    &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                             &amp;              &amp;                                                                                &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
  \end{array}\right]
  \cdot
  \begin{bmatrix}
      \delta R              \\ \delta P              \\ \delta Y              \\ \hdashline
      \delta v_{N}          \\ \delta v_{E}          \\ \delta v_{D}          \\ \hdashline
      \delta \phi           \\ \delta \lambda        \\ \delta h              \\ \hdashline
      \delta f_{x}^{b}      \\ \delta f_{y}^{b}      \\ \delta f_{z}^{b}      \\ \hdashline
      \delta \omega_{x}^{b} \\ \delta \omega_{y}^{b} \\ \delta \omega_{z}^{b} \\
  \end{bmatrix}
\end{equation}
</p>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.4, eq. 14.63, p. 587ff</li>
</ul>
<p>The following sources can be taken as reference, but have at least one deviation from the form presented here</p><ul>
<li><a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.3, eq. 12.28, p. 345<ul>
<li>Different <em>sign</em> in equations \( \mathbf{F}_{\delta \dot{\psi},\delta v}^n \), \( \mathbf{F}_{\delta \dot{\psi},\delta r}^n \), \( \mathbf{F}_{\delta \dot{\psi},\delta \omega}^n \), \( \mathbf{F}_{\delta \dot{v},\delta \psi}^n \)</li>
</ul>
</li>
<li><a class="el" href="citelist.html#CITEREF_noureldin2013">[35]</a> Noureldin, ch. 6.1.5, eq. 6.76, p. 219<ul>
<li>ENU-System</li>
<li>Yaw defined counterclockwise</li>
<li>Different <em>sign</em> for the DCM term</li>
</ul>
</li>
</ul>
<p>However in section <a class="el" href="#LooselyCoupledKF_n-Appendix-ErrorStateEquations-LocalLevelFrame-Comparison">Error Equations comparison</a> it is shown, that they can be transformed into each other.</p>
<h1><a class="anchor" id="LooselyCoupledKF_n-Noise"></a>
Augmented State with Noise</h1>
<p>The continuous linear dynamic system can be expressed as <a class="anchor" id="eq-LCKF_n-dynamicModel"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{\dot{x}} = \mathbf{F} \cdot \boldsymbol{\delta} \mathbf{x} + \mathbf{G} \cdot \mathbf{w}
\end{equation}
</p>
<p>Process noise is introduced into the \( \mathbf{F} \) and \( \mathbf{G} \) matrices in the accelerometer and gyroscope bias terms. Therefore the error equations can be extended as follows</p>
<p><a class="anchor" id="eq-LCKF_n-dynamicModel-short"></a>                                  </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}} \\
      \boldsymbol{\delta \dot{v}}^{n} \\
      \boldsymbol{\delta \dot{p}}_b \\
      \boldsymbol{\delta \dot{f}}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
  \end{bmatrix}
  =
  \begin{bmatrix}
      \mathbf{F}_{\delta \dot{\psi},\delta \psi}^n &amp; \mathbf{F}_{\delta \dot{\psi},\delta v}^n &amp; \mathbf{F}_{\delta \dot{\psi},\delta r}^n &amp;    \mathbf{0}_3      &amp;       \mathbf{C}_b^n      \\
      \mathbf{F}_{\delta \dot{v},\delta \psi}^n    &amp; \mathbf{F}_{\delta \dot{v},\delta v}^n    &amp; \mathbf{F}_{\delta \dot{v},\delta r}^n    &amp;    \mathbf{C}_b^n    &amp;       \mathbf{0}_3        \\
      \mathbf{0}_3                                   &amp; \mathbf{F}_{\delta \dot{r},\delta v}^n    &amp; \mathbf{F}_{\delta \dot{r},\delta r}^n    &amp;    \mathbf{0}_3      &amp;       \mathbf{0}_3        \\
      \mathbf{0}_3                                   &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3                                &amp; -\boldsymbol{\beta}_f &amp;       \mathbf{0}_3        \\
      \mathbf{0}_3                                   &amp; \mathbf{0}_3                                &amp; \mathbf{0}_3                                &amp;    \mathbf{0}_3      &amp; -\boldsymbol{\beta}_\omega \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta \psi} \\
      \boldsymbol{\delta v}^{n} \\
      \boldsymbol{\delta p}_b \\
      \boldsymbol{\delta f}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \
  \end{bmatrix}
  +
  \begin{bmatrix}
       \mathbf{C}_b^n &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{C}_b^n &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
  \end{bmatrix}
  \cdot
  \mathbf{w}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Noise-RW"></a>
Random Walk</h2>
<p>The random noise on the accelerometer and gyro measurements can be estimated as a Random Walk in the angle and velocity errors.</p>
<p><a class="anchor" id="eq-LCKF_n-random-walk"></a>  </p><p class="formulaDsp">
\begin{equation}
  \dot{x} = 0 + W(t)
\end{equation}
</p>
<p>In general, the noise can have an arbitrary characteristic. In a Kalman filter, however, it must be normally distributed and is therefore limited to a Wiener Process. The terms in the noise input matrix \( \mathbf{G} \) are not scaled and therefore need to be compensated with a noise scale matrix \( \mathbf{W} \) depending on the amplitude of the noise process. The amplitude is defined by the standard deviation \(\sigma\). This parameter can be chosen by the user for the accel and gyro measurements:</p>
<p><a class="anchor" id="eq-LCKF_n-random-walk-S-noise"></a>   </p><p class="formulaDsp">
\begin{equation}
  S_{ra,j} = \sigma_{ra,j}, \qquad
  S_{rg,j} = \sigma_{rg,j}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{ra} \) is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li>\( \sigma_{rg} \) is the standard deviation of the noise on the gyro angular-rate measurements</li>
</ul>
<p>The bias states are also modeled as a random process. In case of random walk, their amplitudes are defined analogously to the above and \(\beta = 0\).</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Noise-GM1"></a>
Gauss-Markov 1. Order</h2>
<p>Another option to model the bias states is given by the Gauss-Markov 1. Order process:</p>
<p><a class="anchor" id="eq-LCKF_n-gauss-markov-1"></a>  </p><p class="formulaDsp">
\begin{equation}
  \dot{x} = -\beta x + W(t)
\end{equation}
</p>
<p>This introduces a deterministic part into the equation, namely the correlation coefficient \(\beta\). This parameter defines, how much a current state is correlated with past states. The elements of the \( \mathbf{F} \) matrix are then <a class="anchor" id="eq-LCKF_n-random-walk-beta"></a>       </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\beta}_f = \begin{pmatrix} \beta_{f} &amp;      0     &amp;      0     \\
                                                                    0       &amp; \beta_{f} &amp;      0     \\
                                                                    0       &amp;      0     &amp; \beta_{f} \end{pmatrix}, \qquad
  \boldsymbol{\beta}_\omega = \begin{pmatrix} \beta_{\omega} &amp;        0        &amp;        0        \\
                                                                           0        &amp; \beta_{\omega} &amp;        0        \\
                                                                           0        &amp;        0        &amp; \beta_{\omega} \end{pmatrix}
\end{equation}
</p>
<p> where</p><ul>
<li>\( \beta_{f} \) is the Gauss-Markov constant for the accelerometer ùõΩ = 1 / ùúè (ùúè correlation length)</li>
<li>\( \beta_{\omega} \) is the Gauss-Markov constant for the gyroscope ùõΩ = 1 / ùúè (ùúè correlation length)</li>
</ul>
<p>Like before, the scaling is done inside the noise scale matrix. Now, the bias noise's amplitude is given by <a class="anchor" id="eq-LCKF_n-random-walk-S-bias_Brown"></a>   </p><p class="formulaDsp">
\begin{equation}
  S_{bad,j} = \sqrt{\frac{2\sigma_{bad,j}^2}{\tau_{bad}}} , \qquad
  S_{bgd,j} = \sqrt{\frac{2\sigma_{bgd,j}^2}{\tau_{bgd}}}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> with a given standard deviation of \(\sigma_{bad}\) for the accelerometer's bias noise and \(\sigma_{bgd}\) for the gyro's bias noise. The correlation lengths \( \tau_{bad} \) and \( \tau_{bgd} \) define how much a current state is correlated to values in the past. This process is generally limited to normal distributions. A detailed example of this type of system can be found in Brown &amp; Hwang <a class="el" href="citelist.html#CITEREF_brown2011">[10]</a> (example 9.6).</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Noise-Scale-matrix"></a>
Noise scale matrix W</h2>
<p><a class="anchor" id="eq-LCKF_n-random-walk-noise-scale-matrix-W"></a>        </p><p class="formulaDsp">
\begin{equation}
  \mathbf{W} =
  \begin{bmatrix}
      \mathbf{S}_{rg} &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{S}_{ra} &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{S}_{bad} &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{S}_{bgd} \\
  \end{bmatrix}
\end{equation}
</p>
<p>\( \mathbf{S}_{rg}, \mathbf{S}_{ra}, \mathbf{S}_{bad}, \mathbf{S}_{bgd} \) are diagonal matrices where entries are filled with the PSDs from <a class="el" href="#eq-LCKF_n-random-walk-S-noise">eq-LCKF_n-random-walk-S-noise</a> and <a class="el" href="#eq-LCKF_n-random-walk-S-bias">eq-LCKF_n-random-walk-S-bias</a> or <a class="el" href="#eq-LCKF_n-random-walk-S-bias_Brown">eq-LCKF_n-random-walk-S-bias_Brown</a>.</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Groves-process-noise-definition"></a>
Groves' process noise definition</h2>
<p>In Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a>, process noise is defined without the need of integration. Instead, noise amplitudes are given directly integrated over one time step \(\tau_i\). Therefore, the <b>PSDs of the accelerometer and gyro noise</b> are: <a class="anchor" id="eq-LCKF_n-random-walk-S-noise-Groves"></a>   </p><p class="formulaDsp">
\begin{equation}
  S_{ra,j} = \sigma_{ra,j}^2 \tau_i, \qquad
  S_{rg,j} = \sigma_{rg,j}^2 \tau_i, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{ra} \) is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li>\( \sigma_{rg} \) is the standard deviation of the noise on the gyro angular-rate measurements</li>
<li>\( \tau_i \) is the interval between the input of successive accelerometer and gyro outputs to the inertial navigation equations</li>
</ul>
<p>The bias states are modeled by Groves with the noise PSD's: <a class="anchor" id="eq-LCKF_n-random-walk-S-bias"></a>   </p><p class="formulaDsp">
\begin{equation}
  S_{bad,j} = \frac{\sigma_{bad,j}^2}{\tau_{bad}} , \qquad
  S_{bgd,j} = \frac{\sigma_{bgd,j}^2}{\tau_{bgd}}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{bad} \) and \( \sigma_{bgd} \) are the standard deviations of the accelerometer and gyro dynamic biases</li>
<li>\( \tau_{bad} \) and \( \tau_{bgd} \) are the correlation times of the dynamic accelerometer and gyro biases</li>
</ul>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.6, eq. 14.84, p. 592</p>
<p>Although correlation lengths \(\tau_{bad} \) and \( \tau_{bgd} \) are considered, this process is rather a random walk than a Gauss-Markov 1. order process, because of the missing deterministic part in \(\mathbf{F}\).</p>
<p>In INSTINCT, Groves' method <a class="el" href="#eq-LCKF_n-random-walk-S-bias">eq-LCKF_n-random-walk-S-bias</a> is not altered from its reference <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> to avoid confusion.</p>
<h1><a class="anchor" id="LooselyCoupledKF_n-KF-Matrices"></a>
Kalman-Filter Matrices</h1>
<h2><a class="anchor" id="LooselyCoupledKF_n-KF-Phi-Q"></a>
State transition matrix ùöΩ &amp; Process noise covariance matrix Q</h2>
<h3><a class="anchor" id="LooselyCoupledKF_n-KF-Phi"></a>
State transition matrix ùöΩ</h3>
<h4><a class="anchor" id="autotoc_md28"></a>
Exponential Matrix</h4>
<p>The state transition matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_n-Phi-exp"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\Phi} = \exp{(\mathbf{F} \tau_s)}
\end{equation}
</p>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.2.3, eq. 3.33, p. 97</p>
<h4><a class="anchor" id="autotoc_md29"></a>
Taylor series</h4>
<p>The exponential matrix cannot be calculated directly and numerical methods are computationally intensive. Therefore the transition matrix can be computed as a power-series expansion</p>
<p><a class="anchor" id="eq-LCKF_n-Phi-Taylor"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\Phi} = \sum_{r=0}^{\infty} \frac{\mathbf{F}^r \tau_s^r}{r!} = \mathbf{I} + \mathbf{F} \tau_s + \frac{1}{2} \mathbf{F}^2 \tau^2 + \frac{1}{6} \mathbf{F}^3 \tau_s^3 + \dots
\end{equation}
</p>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.2.3, eq. 3.34, p. 98</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-KF-Q"></a>
Process noise covariance matrix Q</h3>
<p>The process noise covariance matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_n-Q-exact"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{Q}_{k-1} = \int_{t_k - \tau_s}^{t_k} \exp{(\mathbf{F}_{k-1} (t_k-t&#39;))} \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \exp{(\mathbf{F}_{k-1}^T (t_k-t&#39;))} dt&#39;
\end{equation}
</p>
<p>In Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a>, this matrix is approximated as (see ch. 3.2.3, eq. 3.43/3.45, p. 99):</p>
<p><a class="anchor" id="eq-LCKF_n-Q-approx"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{Q}_{k-1} \approx \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \tau_s
\end{equation}
</p>
<p>Taking the noise input and scale matrices from <a class="el" href="#eq-LCKF_n-dynamicModel-short">eq-LCKF_n-dynamicModel-short</a> and <a class="el" href="#eq-LCKF_n-random-walk-noise-scale-matrix-W">eq-LCKF_n-random-walk-noise-scale-matrix-W</a> and putting it into the exact form <a class="el" href="#eq-LCKF_n-Q-exact">eq-LCKF_n-Q-exact</a>, it becomes</p>
<p><a class="anchor" id="eq-LCKF_n-Q-GWGT"></a>                               </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{Q}_{k-1} &amp;= \int_{t_k - \tau_s}^{t_k}
                           \exp{(\mathbf{F}_{k-1} (t_k-t&#39;))}
                           \begin{bmatrix}
                                \mathbf{C}_b^n \cdot \mathbf{S}_{rg} &amp;             \mathbf{0}_3             &amp;             \mathbf{0}_3            &amp;             \mathbf{0}_3            \\
                                            \mathbf{0}_3             &amp; \mathbf{C}_b^n \cdot \mathbf{S}_{ra} &amp;             \mathbf{0}_3            &amp;             \mathbf{0}_3            \\
                                            \mathbf{0}_3             &amp;             \mathbf{0}_3             &amp;             \mathbf{0}_3            &amp;             \mathbf{0}_3            \\
                                            \mathbf{0}_3             &amp;             \mathbf{0}_3             &amp; \mathbf{I}_3 \cdot \mathbf{S}_{bad} &amp;             \mathbf{0}_3            \\
                                            \mathbf{0}_3             &amp;             \mathbf{0}_3             &amp;             \mathbf{0}_3            &amp; \mathbf{I}_3 \cdot \mathbf{S}_{bgd} \\
                           \end{bmatrix}
                           \begin{bmatrix}
                                \mathbf{C}_n^b &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
                                \mathbf{0}_3   &amp; \mathbf{C}_n^b &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
                                \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
                                \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
                           \end{bmatrix}
                           \exp{(\mathbf{F}_{k-1}^T (t_k-t&#39;))}
                      dt&#39; \\
                   &amp;= \int_{t_k - \tau_s}^{t_k}
                           \exp{(\mathbf{F}_{k-1} (t_k-t&#39;))}
                           \begin{bmatrix}
                               \mathbf{C}_b^n \mathbf{S}_{rg} \mathbf{C}_n^b &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                              \mathbf{0}_3                   &amp; \mathbf{C}_b^n \mathbf{S}_{ra} \mathbf{C}_n^b &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                              \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                              \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{S}_{bad} &amp; \mathbf{0}_3     \\
                                              \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{S}_{bgd} \\
                           \end{bmatrix}
                           \exp{(\mathbf{F}_{k-1}^T (t_k-t&#39;))}
                      dt&#39;
\end{aligned}
\end{equation}
</p>
<p>The exponential \( \mathbf{F} \) matrix shall be approximated by first order. This leads to:</p>
<p><a class="anchor" id="eq-LCKF_n-Q-GWGT-approx"></a>                          </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{Q}_{k-1} &amp;\approx \int_{t_k - \tau_s}^{t_k}
                                 \begin{bmatrix}
                                     \mathbf{I}_3 + \mathbf{F}_{\delta \dot{\psi},\delta \psi}^n \tau_s &amp;                \mathbf{F}_{\delta \dot{\psi},\delta v}^n \tau_s &amp;                \mathbf{F}_{\delta \dot{\psi},\delta r}^n \tau_s &amp; \mathbf{0}_3          &amp; \mathbf{C}_b^n \tau_s \\
                                                    \mathbf{F}_{\delta \dot{v},\delta \psi}^n    \tau_s &amp; \mathbf{I}_3 + \mathbf{F}_{\delta \dot{v},\delta v}^n    \tau_s &amp;                \mathbf{F}_{\delta \dot{v},\delta r}^n    \tau_s &amp; \mathbf{C}_b^n \tau_s &amp; \mathbf{0}_3          \\
                                                    \mathbf{0}_3                                          &amp;                \mathbf{F}_{\delta \dot{r},\delta v}^n    \tau_s &amp; \mathbf{I}_3 + \mathbf{F}_{\delta \dot{r},\delta r}^n    \tau_s &amp; \mathbf{0}_3          &amp; \mathbf{0}_3          \\
                                                    \mathbf{0}_3                                          &amp;                \mathbf{0}_3                                       &amp;                \mathbf{0}_3                                       &amp; \mathbf{I}_3          &amp; \mathbf{0}_3          \\
                                                    \mathbf{0}_3                                          &amp;                \mathbf{0}_3                                       &amp;                \mathbf{0}_3                                       &amp; \mathbf{0}_3          &amp; \mathbf{I}_3          \\
                                 \end{bmatrix}
                                 \begin{bmatrix}
                                     \mathbf{C}_b^n \mathbf{S}_{rg} \mathbf{C}_n^b &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                                    \mathbf{0}_3                   &amp; \mathbf{C}_b^n \mathbf{S}_{ra} \mathbf{C}_n^b &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                                    \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
                                                    \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{S}_{bad} &amp; \mathbf{0}_3     \\
                                                    \mathbf{0}_3                   &amp;                \mathbf{0}_3                   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3     &amp; \mathbf{S}_{bgd} \\
                                 \end{bmatrix}
                                 \begin{bmatrix}
                                     \mathbf{I}_3 + \mathbf{F}_{\delta \dot{\psi},\delta \psi}^n \tau_s &amp;                \mathbf{F}_{\delta \dot{v},\delta \psi}^n \tau_s &amp;                \mathbf{0}_3                                       &amp; \mathbf{0}_3          &amp;  \mathbf{0}_3          \\
                                                    \mathbf{F}_{\delta \dot{\psi},\delta v}^n    \tau_s &amp; \mathbf{I}_3 + \mathbf{F}_{\delta \dot{v},\delta v}^n    \tau_s &amp;                \mathbf{F}_{\delta \dot{r},\delta v}^n    \tau_s &amp; \mathbf{0}_3          &amp;  \mathbf{0}_3          \\
                                                    \mathbf{F}_{\delta \dot{\psi},\delta r}^n    \tau_s &amp;                \mathbf{F}_{\delta \dot{v},\delta r}^n    \tau_s &amp; \mathbf{I}_3 + \mathbf{F}_{\delta \dot{r},\delta r}^n    \tau_s &amp; \mathbf{0}_3          &amp;  \mathbf{0}_3          \\
                                                    \mathbf{0}_3                                          &amp;                \mathbf{C}_b^n \tau_s                              &amp;                \mathbf{0}_3                                       &amp; \mathbf{I}_3          &amp;  \mathbf{0}_3          \\
                                                    \mathbf{C}_b^n \tau_s                                 &amp;                \mathbf{0}_3                                       &amp;                \mathbf{0}_3                                       &amp; \mathbf{0}_3          &amp;  \mathbf{I}_3          \\
                                 \end{bmatrix}
                            dt&#39;
\end{aligned}
\end{equation}
</p>
<p>The final equation is</p>
<p><a class="anchor" id="eq-LCKF_n-Q-final"></a>     </p><p class="formulaDsp">
\begin{equation}
  \mathbf{Q} =
  \begin{bmatrix}
      (\mathbf{S}_{rg}\tau_s + \frac{1}{3} \mathbf{S}_{bgd} \tau_s^3) \mathbf{I} &amp; (\frac{1}{2} \mathbf{S}_{rg} \tau_s^2 + \frac{1}{4} \mathbf{S}_{bgd} \tau_s^4) \mathbf{F}_{\delta \dot{v},\delta \psi}^n &amp; \\
  \end{bmatrix}
\end{equation}
</p>
<p>where</p><ul>
<li>\( \tau_s \) is the propagation interval (as we trigger the prediction every time we get IMU measurements this corresponds to \( \tau_i \), the time between measurements)</li>
</ul>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.6, eq. 14.80/14.81, p. 591</p>
<p>This method resembles a Taylor expansion up to 1. order. Since Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> models the IMU measurements and their biases as random walk processes (see section <a class="el" href="#LooselyCoupledKF_n-Groves-process-noise-definition">Groves' process noise definition</a>), only the van-Loan-method can be configured to model biases as Gauss-Markov 1. order processes.</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-KF-Phi-Q-Van-Loan"></a>
Van Loan method</h3>
<p>The state transition matrix and the system/process noise covariance matrix can be calculated with the van Loan method <a class="el" href="citelist.html#CITEREF_loan1978">[48]</a> . In short</p>
<ol type="1">
<li>Form a \( 2n \times 2n \) matrix called \( \mathbf{A} \) ( \( n \) is the dimension of \( \mathbf{x} \) and \( \mathbf{W} \) is the power spectral density of the noise \( W(t) \)) <a class="anchor" id="eq-LCKF_n-Loan-A"></a>   <p class="formulaDsp">
\begin{equation}
  \mathbf{A} = \begin{bmatrix} -\mathbf{F} &amp; \mathbf{G} \mathbf{W} \mathbf{G}^T \\
                                \mathbf{0} &amp;            \mathbf{F}^T          \end{bmatrix} \Delta t
\end{equation}
</p>
</li>
<li>Calculate the exponential of \( \mathbf{A} \) <a class="anchor" id="eq-LCKF_n-Loan-B"></a>       <p class="formulaDsp">
\begin{equation}
  \mathbf{B} = \text{expm}(\mathbf{A}) = \left[ \begin{array}{c;{2pt/2pt}c}
                                            \dots          &amp; \mathbf{\Phi}^{-1} \mathbf{Q} \\[2mm]
                                            \hdashline[2pt/2pt] &amp;                                  \\[-2mm]
                                            \mathbf{0}          &amp; \mathbf{\Phi}^T                     \end{array} \right]
                                       = \begin{bmatrix} \mathbf{B}_{11} &amp; \mathbf{B}_{12} \\
                                                         \mathbf{B}_{21} &amp; \mathbf{B}_{22} \end{bmatrix}
\end{equation}
</p>
</li>
<li>Calculate the state transition matrix \( \mathbf{\Phi} \) as <a class="anchor" id="eq-LCKF_n-Loan-Phi"></a>  <p class="formulaDsp">
\begin{equation}
  \mathbf{\Phi} = \mathbf{B}_{22}^T
\end{equation}
</p>
</li>
<li>Calculate the process noise covariance matrix \( \mathbf{Q} \) as <a class="anchor" id="eq-LCKF_n-Loan-Q"></a>  <p class="formulaDsp">
\begin{equation}
  \mathbf{Q} = \mathbf{\Phi} \mathbf{B}_{12}
\end{equation}
</p>
</li>
</ol>
<h2><a class="anchor" id="LooselyCoupledKF_n-KF-P"></a>
Error covariance matrix P</h2>
<p>The error covariance matrix is initialized as a diagonal matrix with the variance of the initial state as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_n-P"></a>         </p><p class="formulaDsp">
\begin{equation}
  \mathbf{P}_0 =
  \begin{bmatrix}
      \boldsymbol{\sigma}_{\boldsymbol{\delta \psi}}^2 &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp;                        \mathbf{0}_3                       \\
                                                       &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta v^n}}^2 &amp;                                                 &amp;                                                 &amp;                                                           \\
                           \vdots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta p_b}}^2 &amp;                                                 &amp;                          \vdots                           \\
                                                       &amp;                                                 &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta f^b}}^2 &amp;                                                           \\
                        \mathbf{0}_3                   &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta \omega^b_{ib}}}^2 \\
  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-deltaz"></a>
Measurement innovation ùõøz</h2>
<p><a class="anchor" id="eq-LCKF_n-deltaz"></a>   </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{z}^n = \begin{pmatrix} \tilde{\mathbf{p}}_{b,G} - \hat{\mathbf{p}}_{b} - \mathbf{T}_{r(n)}^{p} \mathbf{C}_b^n \mathbf{l}_{ba}^b \\
                                      \tilde{\mathbf{v}}^n_{G} - \hat{\mathbf{v}}^n - \mathbf{C}_b^n (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) + \boldsymbol{\Omega}_{ie}^n \mathbf{C}_b^n \mathbf{l}_{ba}^b \end{pmatrix}
\end{equation}
</p>
<p>where</p><ul>
<li>\( G \) denotes GNSS indicated measurements</li>
<li>\( \mathbf{l}_{ba}^b \) is the lever arm from the INS to the GNSS antenna in [m]</li>
<li>\( \mathbf{T}_{r(n)}^{p} = \begin{pmatrix} \frac{1}{R_N + h} &amp;               0               &amp;  0 \\
                                                       0        &amp; \frac{1}{(R_E + h)\cos{\phi}} &amp;  0 \\
                                                       0        &amp;               0               &amp; -1 \end{pmatrix} \) is the Cartesian-to-curvilinear position change transformation matrix (<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.3.1, eq. 14.104, p. 598ff)</li>
</ul>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.3.1, eq. 14.103, p. 598</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_n-KF-H"></a>
Measurement sensitivity Matrix H</h2>
<p><a class="anchor" id="eq-LCKF_n-H-general"></a>   </p><p class="formulaDsp">
\begin{equation}
  \mathbf{H}_k = \left. \frac{\partial \mathbf{h} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
               = \left. \frac{\partial \mathbf{z} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
\end{equation}
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.4.1, eq. 3.90, p. 119</li>
</ul>
<p><a class="anchor" id="eq-LCKF_n-H"></a>      </p><p class="formulaDsp">
\begin{equation}
  \mathbf{H}^n =
  \begin{bmatrix}
      \mathbf{H}_{r,\delta \psi}^n &amp;  \mathbf{0}_3 &amp; -\mathbf{I}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3                          \\
      \mathbf{H}_{v,\delta \psi}^n &amp; -\mathbf{I}_3 &amp;  \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{H}_{\delta v,\omega_{ib}^b}^n \\
  \end{bmatrix}
\end{equation}
</p>
<p>where <a class="anchor" id="eq-LCKF_n-H-sub"></a>      </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{H}_{r,\delta \psi}^n    &amp;\approx \mathbf{T}_{r(n)}^{p} \left[ (\mathbf{C}_b^n \mathbf{l}_{ba}^b) \times \right] \\
  \mathbf{H}_{v,\delta \psi}^n    &amp;\approx \left[ \left\{ \mathbf{C}_b^n (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) - \boldsymbol{\Omega}_{ie}^n \mathbf{C}_b^n \mathbf{l}_{ba}^b \right\} \times \right] \\
  \mathbf{H}_{v,\omega_{ib}^b}^n &amp;\approx \mathbf{C}_b^n \left[ \mathbf{l}_{ba}^b \times \right] \\
\end{aligned}
\end{equation}
</p>
<p>See</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.3.1, eq. 14.113/14.114, p. 600</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_n-KF-R"></a>
Measurement noise covariance matrix R</h2>
<p>The measurement noise covariance matrix is a diagonal matrix with the variances of the measurements as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_n-R"></a>          </p><p class="formulaDsp">
\begin{equation}
  \mathbf{R} = E \left( (\mathbf{z} - \mathbf{H} \mathbf{x})(\mathbf{z} - \mathbf{H} \mathbf{x})^T \right) =
  \begin{bmatrix}
      \sigma^2_{z_\phi} &amp;          0           &amp;       0        &amp;         0          &amp;         0          &amp;         0          \\
              0         &amp; \sigma^2_{z_\lambda} &amp;       0        &amp;         0          &amp;         0          &amp;         0          \\
              0         &amp;          0           &amp; \sigma^2_{z_h} &amp;         0          &amp;         0          &amp;         0          \\
              0         &amp;          0           &amp;       0        &amp; \sigma^2_{z_{v_N}} &amp;         0          &amp;         0          \\
              0         &amp;          0           &amp;       0        &amp;         0          &amp; \sigma^2_{z_{v_E}} &amp;         0          \\
              0         &amp;          0           &amp;       0        &amp;         0          &amp;         0          &amp; \sigma^2_{z_{v_D}} \\
  \end{bmatrix}
\end{equation}
</p>
<p>This variances can be set static or ideally come from the GNSS receiver.</p>
<h1><a class="anchor" id="LooselyCoupledKF_n-Corrections"></a>
Corrections</h1>
<p>This section describes how the errors are applied to the total state.</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Corrections-State"></a>
Position, Velocity, Attitude</h2>
<p>The position and velocity errors get applied by simply subtracting them from the previous total state (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.1.1, eq. 14.8, 14.10, p. 564)</p>
<p><a class="anchor" id="eq-LCKF_n-correction-position-velocity"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{p}_b^{+} &amp;= \boldsymbol{p}_b^{-} - \boldsymbol{\delta p}_b \\
  \boldsymbol{v}^{n,+} &amp;= \boldsymbol{v}^{n,-} - \boldsymbol{\delta v}^{n}
\end{aligned}
\end{equation}
</p>
<p>The attitude correction can be derived from equation <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-errors">eq-LCKF_n-Derivation-Attitude-estimate-errors</a> (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.1.1, eq. 14.7, p. 564) <a class="anchor" id="eq-LCKF_n-correction-attitude"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{C}_b^{n,+} = (\mathbf{I}_3 - [\boldsymbol{\delta \psi} \times]) \mathbf{C}_b^{n,-}
\end{equation}
</p>
<p>After applying the errors to the total state, the errors have to be reset to zero (closed-loop).</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Corrections-Bias"></a>
Biases</h2>
<p>To correct the accelerometer and gyroscope measurements, we need to accumulate the error states. This has to be done, because contrary to the normal state, the expected value of the biases is not zero.</p>
<p><a class="anchor" id="eq-LCKF_n-correction-accel-gyro-accumulate"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\Delta f}^{b,+}           &amp;= \boldsymbol{\Delta f}^{b,-}           + \boldsymbol{\delta f}^b \\
  \boldsymbol{\Delta \omega}_{ib}^{b,+} &amp;= \boldsymbol{\Delta \omega}_{ib}^{b,-} + \boldsymbol{\delta \omega}_{ib}^b
\end{aligned}
\end{equation}
</p>
<p>Afterwards this accumulated value can be applied to the measurements by subtracting it</p>
<p><a class="anchor" id="eq-LCKF_n-correction-accel-gyro"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{f}^{p,+}           &amp;= \boldsymbol{f}^{p,-}           - \mathbf{C}_b^p \boldsymbol{\Delta f}^{b,+} \\
  \boldsymbol{\omega}_{ib}^{p,+} &amp;= \boldsymbol{\omega}_{ib}^{p,-} - \mathbf{C}_b^p \boldsymbol{\Delta \omega}_{ib}^{b,+}
\end{aligned}
\end{equation}
</p>
<p>Afterwards the bias in the error state gets reset to zero, as it is accounted for in the accumulated value.</p>
<h1><a class="anchor" id="LooselyCoupledKF_n-Units"></a>
Unit discussion</h1>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-F"></a>
System matrix F</h2>
<p>The units of the state vector \( \mathbf{x} \) and the \( \mathbf{F} \) matrix are as follows</p>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix-units"></a>                                                      </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \dot{R}              &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \delta \dot{P}              &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \delta \dot{Y}              &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \delta \dot{v}_{N}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]   \\
      \delta \dot{v}_{E}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]   \\
      \delta \dot{v}_{D}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]   \\
      \delta \dot{\phi}           &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \delta \dot{\lambda}        &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \delta \dot{h}              &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
      \delta \dot{f}_{x}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^3} \right]   \\
      \delta \dot{f}_{y}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^3} \right]   \\
      \delta \dot{f}_{z}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^3} \right]   \\
      \delta \dot{\omega}_{x}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}^2} \right] \\
      \delta \dot{\omega}_{y}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}^2} \right] \\
      \delta \dot{\omega}_{z}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}^2} \right] \\
  \end{bmatrix}
  =
  \begin{bmatrix}
               0                                                    &amp;  \omega_{in,3}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp; -\omega_{in,2}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;                             0                                                              &amp;                    -\frac{1}{R_E + h}                     \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                                    \omega_{ie}\sin{\phi}                                    \left[ \frac{\text{rad}}{\text{s}} \right] &amp;      0       &amp;                    \frac{v_E}{(R_E + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
      -\omega_{in,3}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;          0                                                    &amp;  \omega_{in,1}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;                    \frac{1}{R_N + h}                     \left[ \frac{1}{\text{m}} \right] &amp;                             0                                                               &amp;                       0                                                        &amp;                                             0                                                                                          &amp;      0       &amp;                   -\frac{v_N}{(R_N + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp; \mathbf{C}_b^n \left[ - \right] &amp; \\
       \omega_{in,2}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp; -\omega_{in,1}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;          0                                                    &amp;                             0                                                              &amp;                 \frac{\tan{\phi}}{R_E + h}                \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                  \omega_{ie}\cos{\phi} + \frac{v_E}{(R_E + h)\cos^2{\phi}}                  \left[ \frac{\text{rad}}{\text{s}} \right] &amp;      0       &amp;              -\frac{v_E \tan{\phi}}{(R_E + h)^2}             \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
               0                                                    &amp;         f_D        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;        -f_E        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;                    \frac{v_D}{R_N + h}                   \left[ \frac{1}{\text{s}} \right] &amp; -2\frac{v_E \tan{\phi}}{R_E + h} - 2\omega_{ie}\sin{\phi} \left[ \frac{1}{\text{s}} \right] &amp;              \frac{v_N}{R_N + h}             \left[ \frac{1}{\text{s}} \right] &amp;                -\frac{v_E^2}{(R_E+h)\cos^2{\phi}}-2v_E\omega_{ie}\cos{\phi}                 \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp; \frac{v_E^2\tan{\phi}}{(R_E+h)^2} - \frac{v_Nv_D}{(R_N+h)^2} \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
             -f_D        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;          0                                                    &amp;         f_N        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;  \frac{v_E \tan{\phi}}{R_E + h} + 2\omega_{ie}\sin{\phi} \left[ \frac{1}{\text{s}} \right] &amp;            \frac{v_N \tan{\phi} + v_D}{R_E + h}           \left[ \frac{1}{\text{s}} \right] &amp; \frac{v_E}{R_E + h} + 2\omega_{ie}\cos{\phi} \left[ \frac{1}{\text{s}} \right] &amp; \frac{v_N v_E}{(R_E+h)\cos^2{\phi}} + 2v_N\omega_{ie}\cos{\phi} - 2v_D\omega_{ie}\sin{\phi} \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp;        -\frac{v_Nv_E\tan{\phi} + v_Ev_D}{(R_E + h)^2}        \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp; \mathbf{C}_b^n \left[ - \right] &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
              f_E        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;        -f_N        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;          0                                                    &amp;                  -\frac{2v_N}{R_N + h}                   \left[ \frac{1}{\text{s}} \right] &amp;       -\frac{2v_E}{R_E + h} - 2\omega_{ie}\cos{\phi}      \left[ \frac{1}{\text{s}} \right] &amp;                       0                                                        &amp;                                  2v_E\omega_{ie}\sin{\phi}                                  \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp;     \frac{v_E^2}{(R_E + h)^2} + \frac{v_N^2}{(R_N + h)^2}    \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                      \frac{1}{R_N+h}                     \left[ \frac{1}{\text{m}} \right] &amp;                             0                                                               &amp;                       0                                                        &amp;                                             0                                                                                          &amp;      0       &amp;                   -\frac{v_N}{(R_N + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                             0                                                              &amp;                \frac{1}{(R_E+h)\cos{\phi}}                \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                           \frac{v_E\tan{\phi}}{(R_E+h)\cos{\phi}}                           \left[ \frac{1}{\text{s}} \right]          &amp;      0       &amp;              -\frac{v_E}{(R_E + h)^2\cos{\phi}}              \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                             0                                                              &amp;                             0                                                               &amp;                      -1                      \left[ - \right]                  &amp;                                             0                                                                                          &amp;      0       &amp;                               0                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                                                                                            &amp;                       \mathbf{0}_3                                                          &amp;                                                                                &amp;                                                                                                                                        &amp; \mathbf{0}_3 &amp;                                                                                                               &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                                                                                            &amp;                       \mathbf{0}_3                                                          &amp;                                                                                &amp;                                                                                                                                        &amp; \mathbf{0}_3 &amp;                                                                                                               &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \delta R              &amp; \left[ \text{rad} \right]                  \\
      \delta P              &amp; \left[ \text{rad} \right]                  \\
      \delta Y              &amp; \left[ \text{rad} \right]                  \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta \phi           &amp; \left[ \text{rad} \right]                  \\
      \delta \lambda        &amp; \left[ \text{rad} \right]                  \\
      \delta h              &amp; \left[ \text{m} \right]                    \\
      \delta f_{x}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta f_{y}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta f_{z}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta \omega_{x}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
      \delta \omega_{y}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
      \delta \omega_{z}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
  \end{bmatrix}
\end{equation}
</p>
<p>When scaling elements in \( \boldsymbol{\delta} \mathbf{x} \) the relevant parts of the \( \mathbf{F} \) matrix have to be scaled as well.</p>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix-units-scaled"></a>                                                       </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \dot{R}              &amp; \left[ {\frac{\text{deg}}{\text{s}}} \right]    \\
      \delta \dot{P}              &amp; \left[ {\frac{\text{deg}}{\text{s}}} \right]    \\
      \delta \dot{Y}              &amp; \left[ {\frac{\text{deg}}{\text{s}}} \right]    \\
      \delta \dot{v}_{N}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]                        \\
      \delta \dot{v}_{E}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]                        \\
      \delta \dot{v}_{D}          &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]                        \\
      \delta \dot{\phi}           &amp; \left[ {\frac{\text{m&#39;}}{\text{s}}} \right]     \\
      \delta \dot{\lambda}        &amp; \left[ {\frac{\text{m&#39;}}{\text{s}}} \right]     \\
      \delta \dot{h}              &amp; \left[ \frac{\text{m}}{\text{s}} \right]                          \\
      \delta \dot{f}_{x}^{b}      &amp; \left[ {\frac{\text{mg}}{\text{s}}} \right]     \\
      \delta \dot{f}_{y}^{b}      &amp; \left[ {\frac{\text{mg}}{\text{s}}} \right]     \\
      \delta \dot{f}_{z}^{b}      &amp; \left[ {\frac{\text{mg}}{\text{s}}} \right]     \\
      \delta \dot{\omega}_{x}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}^2}} \right] \\
      \delta \dot{\omega}_{y}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}^2}} \right] \\
      \delta \dot{\omega}_{z}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}^2}} \right] \\
  \end{bmatrix}
  =
  \quad
  \begin{bmatrix}
               0                                                    &amp;  \omega_{in,3}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp; -\omega_{in,2}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;                             0                                                              &amp;                    -\frac{1}{R_E + h}                     \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                                    \omega_{ie}\sin{\phi}                                    \left[ \frac{\text{rad}}{\text{s}} \right] &amp;      0       &amp;                    \frac{v_E}{(R_E + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
      -\omega_{in,3}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;          0                                                    &amp;  \omega_{in,1}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;                    \frac{1}{R_N + h}                     \left[ \frac{1}{\text{m}} \right] &amp;                             0                                                               &amp;                       0                                                        &amp;                                             0                                                                                          &amp;      0       &amp;                   -\frac{v_N}{(R_N + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp; \mathbf{C}_b^n \left[ - \right] &amp; \\
       \omega_{in,2}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp; -\omega_{in,1}^{n} \left[ \frac{\text{rad}}{\text{s}} \right] &amp;          0                                                    &amp;                             0                                                              &amp;                 \frac{\tan{\phi}}{R_E + h}                \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                  \omega_{ie}\cos{\phi} + \frac{v_E}{(R_E + h)\cos^2{\phi}}                  \left[ \frac{\text{rad}}{\text{s}} \right] &amp;      0       &amp;              -\frac{v_E \tan{\phi}}{(R_E + h)^2}             \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
               0                                                    &amp;         f_D        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;        -f_E        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;                    \frac{v_D}{R_N + h}                   \left[ \frac{1}{\text{s}} \right] &amp; -2\frac{v_E \tan{\phi}}{R_E + h} - 2\omega_{ie}\sin{\phi} \left[ \frac{1}{\text{s}} \right] &amp;              \frac{v_N}{R_N + h}             \left[ \frac{1}{\text{s}} \right] &amp;                -\frac{v_E^2}{(R_E+h)\cos^2{\phi}}-2v_E\omega_{ie}\cos{\phi}                 \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp; \frac{v_E^2\tan{\phi}}{(R_E+h)^2} - \frac{v_Nv_D}{(R_N+h)^2} \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
             -f_D        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;          0                                                    &amp;         f_N        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;  \frac{v_E \tan{\phi}}{R_E + h} + 2\omega_{ie}\sin{\phi} \left[ \frac{1}{\text{s}} \right] &amp;            \frac{v_N \tan{\phi} + v_D}{R_E + h}           \left[ \frac{1}{\text{s}} \right] &amp; \frac{v_E}{R_E + h} + 2\omega_{ie}\cos{\phi} \left[ \frac{1}{\text{s}} \right] &amp; \frac{v_N v_E}{(R_E+h)\cos^2{\phi}} + 2v_N\omega_{ie}\cos{\phi} - 2v_D\omega_{ie}\sin{\phi} \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp;        -\frac{v_Nv_E\tan{\phi} + v_Ev_D}{(R_E + h)^2}        \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp; \mathbf{C}_b^n \left[ - \right] &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
              f_E        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;        -f_N        \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;          0                                                    &amp;                  -\frac{2v_N}{R_N + h}                   \left[ \frac{1}{\text{s}} \right] &amp;       -\frac{2v_E}{R_E + h} - 2\omega_{ie}\cos{\phi}      \left[ \frac{1}{\text{s}} \right] &amp;                       0                                                        &amp;                                  2v_E\omega_{ie}\sin{\phi}                                  \left[ \frac{\text{m}}{\text{s}^2} \right] &amp;      0       &amp;     \frac{v_E^2}{(R_E + h)^2} + \frac{v_N^2}{(R_N + h)^2}    \left[ \frac{1}{\text{s}^2} \right]              &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                      \frac{1}{R_N+h}                     \left[ \frac{1}{\text{m}} \right] &amp;                             0                                                               &amp;                       0                                                        &amp;                                             0                                                                                          &amp;      0       &amp;                   -\frac{v_N}{(R_N + h)^2}                   \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                             0                                                              &amp;                \frac{1}{(R_E+h)\cos{\phi}}                \left[ \frac{1}{\text{m}} \right] &amp;                       0                                                        &amp;                           \frac{v_E\tan{\phi}}{(R_E+h)\cos{\phi}}                           \left[ \frac{1}{\text{s}} \right]          &amp;      0       &amp;              -\frac{v_E}{(R_E + h)^2\cos{\phi}}              \left[ \frac{1}{\text{m} \cdot \text{s}} \right] &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                             0                                                              &amp;                             0                                                               &amp;                      -1                      \left[ - \right]                  &amp;                                             0                                                                                          &amp;      0       &amp;                               0                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                                                                                            &amp;                       \mathbf{0}_3                                                          &amp;                                                                                &amp;                                                                                                                                        &amp; \mathbf{0}_3 &amp;                                                                                                               &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
                                                                    &amp;    \mathbf{0}_3                                               &amp;                                                               &amp;                                                                                            &amp;                       \mathbf{0}_3                                                          &amp;                                                                                &amp;                                                                                                                                        &amp; \mathbf{0}_3 &amp;                                                                                                               &amp;  &amp;  \mathbf{0}_3                   &amp;  &amp;  &amp;  \mathbf{0}_3                   &amp; \\
                                                                    &amp;                                                               &amp;                                                               &amp;                                                                                            &amp;                                                                                             &amp;                                                                                &amp;                                                                                                                                        &amp;              &amp;                                                                                                               &amp;  &amp;                                 &amp;  &amp;  &amp;                                 &amp; \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \delta R              &amp; \left[ {\text{deg}} \right]                   \\
      \delta P              &amp; \left[ {\text{deg}} \right]                   \\
      \delta Y              &amp; \left[ {\text{deg}} \right]                   \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta \phi           &amp; \left[ {\text{m&#39;}} \right]                    \\
      \delta \lambda        &amp; \left[ {\text{m&#39;}} \right]                    \\
      \delta h              &amp; \left[ \text{m} \right]                                         \\
      \delta f_{x}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta f_{y}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta f_{z}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta \omega_{x}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
      \delta \omega_{y}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
      \delta \omega_{z}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
  \end{bmatrix}
\end{equation}
</p>
<p>The unit \( m&#39; \) is [pseudometre] and is latitude or longitude converted from radian into metre by multiplying it with the Earth radius. However the radius is assumed as a constant for the conversion.</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-beta-G"></a>
Gauss-Markov constant ùõΩ &amp; Noise scale matrix G</h2>
<p>If a bias state is modeled by a Gauss-Markov first order process instead of random walk, the deterministic part of the equation is extended.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-noise"></a>                                  </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}}                                     &amp; \left[ \frac{\text{rad}}{\text{s}} \right]   \\
      \boldsymbol{\delta \dot{v}}^{n}                                    &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]   \\
      \boldsymbol{\delta \dot{p}}_b                                      &amp; \dots                                        \\
      \boldsymbol{\delta \dot{f}}^{\raise-0.45ex\hbox{$\scriptstyle b$}} &amp; \left[ \frac{\text{m}}{\text{s}^3} \right]   \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b                            &amp; \left[ \frac{\text{rad}}{\text{s}^2} \right] \\
  \end{bmatrix}
  =
  \begin{bmatrix}
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
      \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; -\boldsymbol{\beta}_f \left[ \frac{1}{\text{s}} \right] &amp;        \mathbf{0}_3                                          \\
      \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp;    \mathbf{0}_3                                        &amp;  -\boldsymbol{\beta}_\omega \left[ \frac{1}{\text{s}} \right] \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta \psi}          &amp; \left[ \text{rad} \right]                  \\
      \boldsymbol{\delta v}^{n}         &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \boldsymbol{\delta p}_b           &amp; \dots                                      \\
      \boldsymbol{\delta f}^b           &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \boldsymbol{\delta \omega}_{ib}^b &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
  \end{bmatrix}
  +
  \begin{bmatrix}
      \mathbf{C}_b^n &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{C}_b^n &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
  \end{bmatrix}
  \cdot
  \mathbf{w} \left[ \frac{1}{\sqrt{\text{s}}} \right]
\end{equation}
</p>
<p>When scaling the biases in \( \boldsymbol{\delta} \mathbf{x} \) the \( \mathbf{\beta} \) factors stay unscaled. However the \( \mathbf{G} \) matrix has to be adapted.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-noise-scaled"></a>                                   </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}}                                     &amp; \left[ {\text{deg}} \right]                     \\
      \boldsymbol{\delta \dot{v}}^{n}                                    &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]                        \\
      \boldsymbol{\delta \dot{p}}_b                                      &amp; \dots                                                             \\
      \boldsymbol{\delta \dot{f}}^{\raise-0.45ex\hbox{$\scriptstyle b$}} &amp; \left[ {\frac{\text{mg}}{\text{s}}} \right]     \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b                            &amp; \left[ {\frac{\text{mrad}}{\text{s}^2}} \right] \\
  \end{bmatrix}
  =
  \begin{bmatrix}
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
          \dots    &amp;     \dots    &amp;     \dots    &amp;        \dots                                           &amp;           \dots                                              \\
      \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; -\boldsymbol{\beta}_f \left[ \frac{1}{\text{s}} \right] &amp;        \mathbf{0}_3                                          \\
      \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 &amp;    \mathbf{0}_3                                        &amp;  -\boldsymbol{\beta}_\omega \left[ \frac{1}{\text{s}} \right] \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}}    &amp; \left[ {\frac{\text{deg}}{\text{s}}} \right]  \\
      \boldsymbol{\delta \dot{v}}^{n}   &amp; \left[ \frac{\text{m}}{\text{s}^2} \right]   \\
      \boldsymbol{\delta \dot{p}}_b     &amp; \dots                                        \\
      \boldsymbol{\delta f}^b           &amp; \left[ {\text{mg}} \right]                    \\
      \boldsymbol{\delta \omega}_{ib}^b &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
  \end{bmatrix}
  +
  \qquad
  \begin{bmatrix}
      \mathbf{C}_b^n &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{C}_b^n &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
  \end{bmatrix}
  \cdot
  \mathbf{w} \left[ \frac{1}{\sqrt{\text{s}}} \right]
\end{equation}
</p>
<p>If the noise input matrix \( \mathbf{G} \) is scaled, then the noise scale matrix \( \mathbf{W} \) does not have to be scaled.</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-Q"></a>
Process noise covariance matrix Q</h2>
<p>If the alternative process noise covariance matrix \( \mathbf{Q} \) is used, it also has to be scaled.</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-P"></a>
Error covariance matrix P</h2>
<p>The error covariance matrix is initialized as a diagonal matrix with the variance of the initial state as diagonal elements. Therefore the units are the squared units of the state vector.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-P"></a>                    </p><p class="formulaDsp">
\begin{equation}
  \mathbf{P}_0 =
  \begin{bmatrix}
      \sigma_{\delta R}^2 \left[ \text{rad}^2 \right] &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;           \dots                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                 0                                                               \\
                                                      &amp; \sigma_{\delta P}^2 \left[ \text{rad}^2 \right] &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp; \sigma_{\delta Y}^2 \left[ \text{rad}^2 \right] &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp; \sigma_{\delta v_N}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp; \sigma_{\delta v_E}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp; \sigma_{\delta v_D}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp; \sigma_{\delta \phi}^2 \left[ \text{rad}^2 \right] &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
             \vdots                                   &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp; \sigma_{\delta \lambda}^2 \left[ \text{rad}^2 \right] &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;              \vdots                                                             \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp; \sigma_{\delta h}^2 \left[ \text{m}^2 \right] &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp; \sigma_{\delta f_{x}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp; \sigma_{\delta f_{y}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp; \sigma_{\delta f_{z}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp; \sigma_{\delta \omega_{x}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp; \sigma_{\delta \omega_{y}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] &amp;                                                                                 \\
               0                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;           \dots                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp; \sigma_{\delta \omega_{z}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] \\

  \end{bmatrix}
\end{equation}
</p>
<p>When scaling elements in \( \boldsymbol{\delta} \mathbf{x} \) the relevant parts of the \( \mathbf{P} \) matrix have to be adapted. This means the scale factors have to be multiplied with the correct rows and columns. As \( \mathbf{P} \) is a diagonal matrix, this means only the diagonal terms have to be scaled.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-P-scaled"></a>                    </p><p class="formulaDsp">
\begin{equation}
  \mathbf{P}_0 =
  \begin{bmatrix}
      \sigma_{\delta R}^2 \left[ \text{rad}^2 \right] &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;           \dots                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                 0                                                               \\
                                                      &amp; \sigma_{\delta P}^2 \left[ \text{rad}^2 \right] &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp; \sigma_{\delta Y}^2 \left[ \text{rad}^2 \right] &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp; \sigma_{\delta v_N}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp; \sigma_{\delta v_E}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp; \sigma_{\delta v_D}^2 \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp; \sigma_{\delta \phi}^2 \left[ \text{rad}^2 \right] &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
             \vdots                                   &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp; \sigma_{\delta \lambda}^2 \left[ \text{rad}^2 \right] &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;              \vdots                                                             \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp; \sigma_{\delta h}^2 \left[ \text{m}^2 \right] &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp; \sigma_{\delta f_{x}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp; \sigma_{\delta f_{y}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp; \sigma_{\delta f_{z}^{b}}^2 \left[ \frac{\text{m}^2}{\text{s}^4} \right] &amp;                                                                                 &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp; \sigma_{\delta \omega_{x}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] &amp;                                                                                 &amp;                                                                                 \\
                                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;                                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp; \sigma_{\delta \omega_{y}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] &amp;                                                                                 \\
               0                                      &amp;                                                 &amp;                                                 &amp;                                                                    &amp;                                                                    &amp;                                                                    &amp;                                                    &amp;           \dots                                       &amp;                                               &amp;                                                                          &amp;                                                                          &amp;                                                                          &amp;                                                                                 &amp;                                                                                 &amp; \sigma_{\delta \omega_{z}^{b}}^2 \left[ \frac{\text{rad}^2}{\text{s}^2} \right] \\

  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-deltaz"></a>
Measurement innovation ùõøz</h2>
<p><a class="anchor" id="eq-LCKF_n-Units-deltaz"></a>                           </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{z} =
  \begin{bmatrix}
      \delta \phi           &amp; \left[ \text{rad} \right]                  \\
      \delta \lambda        &amp; \left[ \text{rad} \right]                  \\
      \delta h              &amp; \left[ \text{m} \right]                    \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
  \end{bmatrix}
  =
  \begin{bmatrix}
       \tilde{\phi}_G    - \hat{\phi}    &amp; \left[ \text{rad} \right]                \\
       \tilde{\lambda}_G - \hat{\lambda} &amp; \left[ \text{rad} \right]                \\
       \tilde{h}_G       - \hat{h}       &amp; \left[ \text{m} \right]                  \\
       \tilde{v}_{N,G}   - \hat{v}_{N}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
       \tilde{v}_{E,G}   - \hat{v}_{E}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
       \tilde{v}_{D,G}   - \hat{v}_{D}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
  \end{bmatrix}
  +
  \begin{bmatrix}
        - \begin{pmatrix} \frac{1}{R_N + h} \left[ \frac{1}{\text{m}} \right] &amp;               0                                                 &amp;  0                  \\[1.2em]
                                   0                                          &amp; \frac{1}{(R_E + h)\cos{\phi}} \left[ \frac{1}{\text{m}} \right] &amp;  0                  \\[1.2em]
                                   0                                          &amp;               0                                                 &amp; -1 \left[ - \right] \end{pmatrix}
          \mathbf{C}_b^n \left[ - \right] \mathbf{l}_{ba}^b \left[ \text{m} \right] \\
        - \mathbf{C}_b^n \left[ - \right] (\boldsymbol{\omega}_{ib}^b  \left[ \frac{\text{rad}}{\text{s}} \right] \times \mathbf{l}_{ba}^b  \left[ \text{m} \right]) + \boldsymbol{\Omega}_{ie}^n \left[ \frac{\text{rad}}{\text{s}} \right] \mathbf{C}_b^n  \left[ - \right] \mathbf{l}_{ba}^b  \left[ \text{m} \right] \\
  \end{bmatrix}
\end{equation}
</p>
<p>When scaling elements in \( \boldsymbol{\delta} \mathbf{x} \) the relevant parts of the measurement innovation \( \boldsymbol{\delta} \mathbf{z} \) have to be adapted</p>
<p><a class="anchor" id="eq-LCKF_n-Units-deltaz-scaled"></a>                              </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{z} =
  \begin{bmatrix}
      \delta \phi           &amp; \left[ {\text{m&#39;}} \right] \\
      \delta \lambda        &amp; \left[ {\text{m&#39;}} \right] \\
      \delta h              &amp; \left[ \text{m} \right]                      \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
  \end{bmatrix}
  =
  \quad
  \begin{bmatrix}
       \tilde{\phi}_G    - \hat{\phi}    &amp; \left[ \text{rad} \right]                \\
       \tilde{\lambda}_G - \hat{\lambda} &amp; \left[ \text{rad} \right]                \\
       \tilde{h}_G       - \hat{h}       &amp; \left[ \text{m} \right]                  \\
       \tilde{v}_{N,G}   - \hat{v}_{N}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
       \tilde{v}_{E,G}   - \hat{v}_{E}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
       \tilde{v}_{D,G}   - \hat{v}_{D}   &amp; \left[ \frac{\text{m}}{\text{s}} \right] \\
  \end{bmatrix}
  +
  \quad
  \begin{bmatrix}
        - \begin{pmatrix} \frac{1}{R_N + h} \left[ \frac{1}{\text{m}} \right] &amp;               0                                                 &amp;  0                  \\[1.2em]
                                   0                                          &amp; \frac{1}{(R_E + h)\cos{\phi}} \left[ \frac{1}{\text{m}} \right] &amp;  0                  \\[1.2em]
                                   0                                          &amp;               0                                                 &amp; -1 \left[ - \right] \end{pmatrix}
          \mathbf{C}_b^n \left[ - \right] \mathbf{l}_{ba}^b \left[ \text{m} \right] \\
        - \mathbf{C}_b^n \left[ - \right] (\boldsymbol{\omega}_{ib}^b  \left[ \frac{\text{rad}}{\text{s}} \right] \times \mathbf{l}_{ba}^b  \left[ \text{m} \right]) + \boldsymbol{\Omega}_{ie}^n \left[ \frac{\text{rad}}{\text{s}} \right] \mathbf{C}_b^n  \left[ - \right] \mathbf{l}_{ba}^b  \left[ \text{m} \right] \\

  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-H"></a>
Measurement sensitivity Matrix H</h2>
<p><a class="anchor" id="eq-LCKF_n-Units-H"></a>                                       </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \phi           &amp; \left[ \text{rad} \right]                  \\
      \delta \lambda        &amp; \left[ \text{rad} \right]                  \\
      \delta h              &amp; \left[ \text{m} \right]                    \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\

  \end{bmatrix}
  =
  \begin{bmatrix}
      &amp;                                                                       &amp; &amp;                     &amp;                     &amp;                     &amp; -1 \left[ - \right] &amp;  0                  &amp;  0                  &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp; \mathbf{H}_{r,\delta \psi}^n \left[ \text{rad} \right]                &amp; &amp;                     &amp;     \mathbf{0}_3    &amp;                     &amp;  0                  &amp; -1 \left[ - \right] &amp;  0                  &amp; &amp; \mathbf{0}_3 &amp; &amp; &amp;          \mathbf{0}_3                                         &amp;  \\
      &amp;                                                                       &amp; &amp;                     &amp;                     &amp;                     &amp;  0                  &amp;  0                  &amp; -1 \left[ - \right] &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp;                                                                       &amp; &amp; -1 \left[ - \right] &amp;  0                  &amp;  0                  &amp;                     &amp;                     &amp;                     &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp; \mathbf{H}_{v,\delta \psi}^n \left[ \frac{\text{m}}{\text{s}} \right] &amp; &amp;  0                  &amp; -1 \left[ - \right] &amp;  0                  &amp;                     &amp;     \mathbf{0}_3    &amp;                     &amp; &amp; \mathbf{0}_3 &amp; &amp; &amp; \mathbf{H}_{\delta v,\omega_{ib}^b}^n \left[ \text{m} \right] &amp;  \\
      &amp;                                                                       &amp; &amp;  0                  &amp;  0                  &amp; -1 \left[ - \right] &amp;                     &amp;                     &amp;                     &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\

  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \delta R              &amp; \left[ \text{rad} \right]                  \\
      \delta P              &amp; \left[ \text{rad} \right]                  \\
      \delta Y              &amp; \left[ \text{rad} \right]                  \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]   \\
      \delta \phi           &amp; \left[ \text{rad} \right]                  \\
      \delta \lambda        &amp; \left[ \text{rad} \right]                  \\
      \delta h              &amp; \left[ \text{m} \right]                    \\
      \delta f_{x}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta f_{y}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta f_{z}^{b}      &amp; \left[ \frac{\text{m}}{\text{s}^2} \right] \\
      \delta \omega_{x}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
      \delta \omega_{y}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\
      \delta \omega_{z}^{b} &amp; \left[ \frac{\text{rad}}{\text{s}} \right] \\

  \end{bmatrix}
\end{equation}
</p>
<p>When scaling elements in \( \boldsymbol{\delta} \mathbf{x} \) the relevant parts of the measurement innovation \( \boldsymbol{\delta} \mathbf{z} \) have to be adapted. The \( \mathbf{H} \) matrix stays unscaled.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-H-scaled"></a>                                     </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \phi           &amp; \left[ {\text{m&#39;}} \right] \\
      \delta \lambda        &amp; \left[ {\text{m&#39;}} \right] \\
      \delta h              &amp; \left[ \text{m} \right]                      \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]     \\

  \end{bmatrix}
  =
  \begin{bmatrix}
      &amp;                                                                       &amp; &amp;                     &amp;                     &amp;                     &amp; -1 \left[ - \right] &amp;  0                  &amp;  0                  &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp; \mathbf{H}_{r,\delta \psi}^n \left[ \text{rad} \right]                &amp; &amp;                     &amp;     \mathbf{0}_3    &amp;                     &amp;  0                  &amp; -1 \left[ - \right] &amp;  0                  &amp; &amp; \mathbf{0}_3 &amp; &amp; &amp;          \mathbf{0}_3                                         &amp;  \\
      &amp;                                                                       &amp; &amp;                     &amp;                     &amp;                     &amp;  0                  &amp;  0                  &amp; -1 \left[ - \right] &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp;                                                                       &amp; &amp; -1 \left[ - \right] &amp;  0                  &amp;  0                  &amp;                     &amp;                     &amp;                     &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
      &amp; \mathbf{H}_{v,\delta \psi}^n \left[ \frac{\text{m}}{\text{s}} \right] &amp; &amp;  0                  &amp; -1 \left[ - \right] &amp;  0                  &amp;                     &amp;     \mathbf{0}_3    &amp;                     &amp; &amp; \mathbf{0}_3 &amp; &amp; &amp; \mathbf{H}_{\delta v,\omega_{ib}^b}^n \left[ \text{m} \right] &amp;  \\
      &amp;                                                                       &amp; &amp;  0                  &amp;  0                  &amp; -1 \left[ - \right] &amp;                     &amp;                     &amp;                     &amp; &amp;              &amp; &amp; &amp;                                                               &amp;  \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \delta R              &amp; \left[ {\text{deg}} \right]                   \\
      \delta P              &amp; \left[ {\text{deg}} \right]                   \\
      \delta Y              &amp; \left[ {\text{deg}} \right]                   \\
      \delta v_{N}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta v_{E}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta v_{D}          &amp; \left[ \frac{\text{m}}{\text{s}} \right]                        \\
      \delta \phi           &amp; \left[ {\text{m&#39;}} \right]                    \\
      \delta \lambda        &amp; \left[ {\text{m&#39;}} \right]                    \\
      \delta h              &amp; \left[ \text{m} \right]                                         \\
      \delta f_{x}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta f_{y}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta f_{z}^{b}      &amp; \left[ {\text{mg}} \right]                    \\
      \delta \omega_{x}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
      \delta \omega_{y}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
      \delta \omega_{z}^{b} &amp; \left[ {\frac{\text{mrad}}{\text{s}}} \right] \\
  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Units-R"></a>
Measurement noise covariance matrix R</h2>
<p><a class="anchor" id="eq-LCKF_n-Units-R"></a>           </p><p class="formulaDsp">
\begin{equation}
  \mathbf{R} = E \left( (\mathbf{z} - \mathbf{H} \mathbf{x})(\mathbf{z} - \mathbf{H} \mathbf{x})^T \right) =
  \begin{bmatrix}
      \sigma^2_{z_\phi} \left[ \text{rad}^2 \right] &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp; \sigma^2_{z_\lambda} \left[ \text{rad}^2 \right] &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp; \sigma^2_{z_h} \left[ \text{m}^2 \right] &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp; \sigma^2_{z_{v_N}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp; \sigma^2_{z_{v_E}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp; \sigma^2_{z_{v_D}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] \\

  \end{bmatrix}
\end{equation}
</p>
<p>When scaling elements in \( \boldsymbol{\delta} \mathbf{x} \) the measurement innovation \( \boldsymbol{\delta} \mathbf{z} \) is scaled and therefore the relevant parts of the \( \mathbf{R} \) matrix have to be adapted.</p>
<p><a class="anchor" id="eq-LCKF_n-Units-R-scaled"></a>          </p><p class="formulaDsp">
\begin{equation}
  \mathbf{R} = E \left( (\mathbf{z} - \mathbf{H} \mathbf{x})(\mathbf{z} - \mathbf{H} \mathbf{x})^T \right) =
  \begin{bmatrix}
      \sigma^2_{z_\phi} \left[ \text{rad}^2 \right] &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp; \sigma^2_{z_\lambda} \left[ \text{rad}^2 \right] &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp; \sigma^2_{z_h} \left[ \text{m}^2 \right] &amp;         0                                                       &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp; \sigma^2_{z_{v_N}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;         0                                                       &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp; \sigma^2_{z_{v_E}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] &amp;         0                                                       \\
              0                                     &amp;          0                                       &amp;       0                                  &amp;         0                                                       &amp;         0                                                       &amp; \sigma^2_{z_{v_D}} \left[ \frac{\text{m}^2}{\text{s}^2} \right] \\
  \end{bmatrix}
\end{equation}
</p>
<h1><a class="anchor" id="LooselyCoupledKF_n-Appendix"></a>
Appendix</h1>
<h2><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-Derivation"></a>
Derivation</h2>
<h3><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-Derivation-Position"></a>
Position Equations</h3>
<p>The time derivative of curvilinear position as a function of the Earth-referenced velocity in local navigation frame axes (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.4.2, eq. 2.111, p. 61 or <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.7, eq. 3.81,3.85,3.86, p. 48ff):</p>
<p><a class="anchor" id="eq-LCKF_n-Derivation-Position-timeDerivative"></a>      </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \dot{\phi}    &amp;= \frac{v_N}{R_N + h}             \\
  \dot{\lambda} &amp;= \frac{v_E}{(R_E + h)\cos{\phi}} \\
  \dot{h}       &amp;= -v_D                            \\
\end{aligned}
\end{equation}
</p>
<p>Differential of left and right side neglecting errors in \(R_N \) and \(R_E \) ( \( \frac{\partial R_N}{\partial p_i} = 0 \) and \( \quad \frac{\partial R_E}{\partial p_i} = 0\))</p>
<p><a class="anchor" id="eq-LCKF_n-Derivation-Position-differential"></a>      </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \delta\dot{\phi}    &amp;= \frac{\partial \dot{\phi}}{\partial v_N} \delta v_N + \frac{\partial \dot{\phi}}{\partial h} \delta h = {\dfrac{1}{R_N + h}} \delta v_N {- \dfrac{v_N}{(R_N + h)^2}} \delta h \\
  \delta\dot{\lambda} &amp;= \frac{\partial \dot{\lambda}}{\partial v_E} \delta v_E + \frac{\partial \dot{\lambda}}{\partial h} \delta h + \frac{\partial \dot{\lambda}}{\partial \phi} \delta \phi = {\dfrac{1}{(R_E + h)\cos{\phi}}} \delta v_E {- \dfrac{v_E}{(R_E + h)^2\cos{\phi}}} \delta h + {\dfrac{v_E \tan{\phi}}{(R_E + h)\cos{\phi}}} \delta \phi \\
  \delta\dot{h}       &amp;= \frac{\partial \dot{h}}{\partial v_D} \delta v_D = {-1} \cdot \delta v_D \\
\end{aligned}
\end{equation}
</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-Derivation-Attitude"></a>
Attitude Equations</h3>
<p>The equations here mainly follow <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.1, p. 342f</p>
<p>The estimated attitude \( \mathbf{\hat{C}}_b^n \) can be written in terms of true direction cosine matrix \( \mathbf{C}_b^n \) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-estimate-true"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\hat{C}}_b^n = \mathbf{B} \mathbf{C}_b^n
\end{equation}
</p>
<p> where \( \mathbf{B} \) is the transformation from true reference axes to estimated reference axes and it can be approximated for small angle misalignments as <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-transformation"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{B} = [\mathbf{I} - \mathbf{\Psi}], \quad \text{with}~ \mathbf{\Psi} = \begin{pmatrix} \delta\alpha \\ \delta\beta \\ \delta\gamma \end{pmatrix} \times
\end{equation}
</p>
<p> with \( \mathbf{\Psi} \) being a skew symmetric matrix and \( \delta\alpha, \delta\beta, \delta\gamma \) being the attitude errors (e.g. roll, pitch, yaw for small euler angles).</p>
<p>Substituting <a class="el" href="#eq-LCKF_n-Derivation-Attitude-transformation">eq-LCKF_n-Derivation-Attitude-transformation</a> into <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-true">eq-LCKF_n-Derivation-Attitude-estimate-true</a> gives <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-estimate-errors"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\hat{C}}_b^n \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n
\end{equation}
</p>
<p>and solving for \( \mathbf{\Psi} \) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-skew-mat"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\Psi} = \mathbf{I} - \mathbf{\hat{C}}_b^n {\mathbf{C}_b^n}^T
\end{equation}
</p>
<p>Differentiating this equation yields: <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-skew-mat-dot"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\Psi}} = -\mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle n$}} {\mathbf{C}_b^n}^T - \mathbf{\hat{C}}_b^n {\mathbf{\dot{C}}_b^n}\raise1.25ex\hbox{$\scriptstyle T$}
\end{equation}
</p>
<p>Using the following equations</p><ul>
<li>Time derivative DCM local-navigation-frame \( \mathbf{\dot{C}}_b^n = \mathbf{C}_b^n \mathbf{\Omega}_{nb}^b \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.4.1, eq. 5.39, p. 176 or <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.5.3, eq. 3.28, p. 32<ul>
<li>Time derivative DCM \( \mathbf{\dot{C}}_\beta^\alpha(t) = \lim_{\delta t \to 0}\left(\dfrac{\mathbf{C}_\beta^\alpha(t+\delta t) - \mathbf{C}_\beta^\alpha(t)}{\delta t}\right) \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.3.1, eq. 2.52, p. 45</li>
<li>DCM with small angle approximation \( C_\alpha^\beta \approx \begin{pmatrix} 1 &amp; -\psi_{\beta\alpha} &amp; \theta_{\beta\alpha} \\ \psi_{\beta\alpha} &amp; 1 &amp; -\phi_{\beta\alpha} \\ -\theta_{\beta\alpha} &amp; \phi_{\beta\alpha} &amp; 1 \end{pmatrix} = \mathbf{I}_3 + [\boldsymbol{\psi}_{\beta\alpha} \times ] = \mathbf{I}_3 + \mathbf{\Omega}_{\beta\alpha} \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.2.2, eq. 2.26, p. 39</li>
</ul>
</li>
<li>Angular rate splitting \( \boldsymbol{\omega}_{\beta\alpha}^\gamma = \boldsymbol{\omega}_{\beta\delta}^\gamma + \boldsymbol{\omega}_{\delta\alpha}^\gamma \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.3.1, eq. 2.48, p. 45</li>
<li>Skew-symmetric matrix transformation \( \mathbf{\Omega}_{\beta\alpha}^\delta = \mathbf{C}_\gamma^\delta \mathbf{\Omega}_{\beta\alpha}^\gamma \mathbf{C}_\delta^\gamma \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.3.1, eq. 2.51, p. 45</li>
</ul>
<p>leads to the time derivative of the coordinate transformation matrix (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.4.1, eq. 5.40, p. 177 or <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.1, eq. 12.12, p. 342) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-DCM-dot"></a>       </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{C}}_b^n &amp;= \mathbf{C}_b^n \mathbf{\Omega}_{nb}^b \\
                       &amp;= \mathbf{C}_b^n (\mathbf{\Omega}_{ib}^b - \mathbf{\Omega}_{in}^b) \\
                       &amp;= \mathbf{C}_b^n (\mathbf{\Omega}_{ib}^b - \mathbf{C}_n^b \mathbf{\Omega}_{in}^n \mathbf{C}_b^n) \\
                       &amp;= \mathbf{C}_b^n \mathbf{\Omega}_{ib}^b - \mathbf{\Omega}_{in}^n \mathbf{C}_b^n
\end{aligned}
\end{equation}
</p>
<p>where</p><ul>
<li>\( \mathbf{\Omega}_{ib}^b \) is the skew-symmetric matrix of the absolute body rate,</li>
<li>\( \mathbf{\Omega}_{in}^b \) is the skew-symmetric matrix of the navigation frame rate,</li>
<li>\( \mathbf{\Omega}_{ie}^n \) is the skew-symmetric matrix of the earth rotation in navigation frame coordinates (<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.4.1, eq. 5.41, p. 177), and</li>
<li>\( \mathbf{\Omega}_{en}^n \) is the skew-symmetric matrix of the transport rate (rotation of the local-navigation-frame with respect to the Earth) (<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.4.1, eq. 5.44, p. 177)</li>
</ul>
<p>Similarly, the time time differential of the estimated matrix \( \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle n$}} \) can be calculated: <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-DCM-dot-estimated"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle n$}} = \mathbf{\hat{C}}_b^n \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{in}^n \mathbf{\hat{C}}_b^n
\end{equation}
</p>
<p>where</p><ul>
<li>\( \mathbf{\hat{\Omega}}_{in}^b \) is the skew-symmetric matrix of the measured body rate,</li>
<li>\( \mathbf{\Omega}_{in}^b \) is the skew-symmetric matrix of the estimated turn rate of the navigation reference frame,</li>
</ul>
<p>Substituting <a class="el" href="#eq-LCKF_n-Derivation-Attitude-DCM-dot">eq-LCKF_n-Derivation-Attitude-DCM-dot</a> and <a class="el" href="#eq-LCKF_n-Derivation-Attitude-DCM-dot-estimated">eq-LCKF_n-Derivation-Attitude-DCM-dot-estimated</a> into <a class="el" href="#eq-LCKF_n-Derivation-Attitude-skew-mat-dot">eq-LCKF_n-Derivation-Attitude-skew-mat-dot</a> <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-skew-mat-dot-calc1"></a>            </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= -(\mathbf{\hat{C}}_b^n \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{in}^n \mathbf{\hat{C}}_b^n) {\mathbf{C}_b^n}^T
                         - \mathbf{\hat{C}}_b^n (\mathbf{C}_b^n \mathbf{\Omega}_{ib}^b - \mathbf{\Omega}_{in}^n \mathbf{C}_b^n)^T \\
                      &amp;= - \mathbf{\hat{C}}_b^n \mathbf{\hat{\Omega}}_{ib}^b {\mathbf{C}_b^n}^T
                         + \mathbf{\hat{\Omega}}_{in}^n \mathbf{\hat{C}}_b^n {\mathbf{C}_b^n}^T
                         + \mathbf{\hat{C}}_b^n \mathbf{\Omega}_{ib}^b {\mathbf{C}_b^n}^T
                         - \mathbf{\hat{C}}_b^n {\mathbf{C}_b^n}^T \mathbf{\Omega}_{in}^n \\
                      &amp;= - \mathbf{\hat{C}}_b^n \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^n}^T
                         + \mathbf{\hat{\Omega}}_{in}^n \mathbf{\hat{C}}_b^n {\mathbf{C}_b^n}^T
                         - \mathbf{\hat{C}}_b^n {\mathbf{C}_b^n}^T \mathbf{\Omega}_{in}^n
\end{aligned}
\end{equation}
</p>
<p>Substituting <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-errors">eq-LCKF_n-Derivation-Attitude-estimate-errors</a> into <a class="el" href="#eq-LCKF_n-Derivation-Attitude-skew-mat-dot-calc1">eq-LCKF_n-Derivation-Attitude-skew-mat-dot-calc1</a> gives: <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-skew-mat-dot-calc2"></a>            </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^n}^T
                         + \mathbf{\hat{\Omega}}_{in}^n [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n {\mathbf{C}_b^n}^T
                         - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n {\mathbf{C}_b^n}^T \mathbf{\Omega}_{in}^n \\
                      &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^n}^T
                         + \mathbf{\hat{\Omega}}_{in}^n - \mathbf{\hat{\Omega}}_{in}^n \mathbf{\Psi}
                         - \mathbf{\Omega}_{in}^n + \mathbf{\Psi} \mathbf{\Omega}_{in}^n \\
                         &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^n}^T
                            + \left[ \mathbf{\hat{\Omega}}_{in}^n - \mathbf{\Omega}_{in}^n \right]
                            - \mathbf{\hat{\Omega}}_{in}^n \mathbf{\Psi} + \mathbf{\Psi} \mathbf{\Omega}_{in}^n
\end{aligned}
\end{equation}
</p>
<p>Now we make the following substitutions</p><ul>
<li>\( \boldsymbol{\delta}\mathbf{\Omega}_{in}^n = \mathbf{\hat{\Omega}}_{in}^n - \mathbf{\Omega}_{in}^n \)</li>
<li>\( \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b = \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \)</li>
</ul>
<p>and neglect error product terms. This leads to (same as <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.1, eq. 12.17, p. 343) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-skew-mat-dot-final"></a>    </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\Psi}} \approx \mathbf{\Psi} \mathbf{\Omega}_{in}^n - \mathbf{\hat{\Omega}}_{in}^n \mathbf{\Psi}
                              + \boldsymbol{\delta}\mathbf{\Omega}_{in}^n
                              - \mathbf{C}_b^n \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b {\mathbf{C}_b^n}^T
\end{equation}
</p>
<p>Finally by performing an element by element comparison with <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-element-comp"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta \psi} \times = \mathbf{\Psi} \qquad\quad
  \boldsymbol{\omega}_{in}^n \times = \mathbf{\Omega}_{in}^n \qquad\quad
  \boldsymbol{\delta \omega}_{in}^n \times = \boldsymbol{\delta}\mathbf{\Omega}_{in}^n \qquad\quad
  \boldsymbol{\delta \omega}_{ib}^b \times = \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b
\end{equation}
</p>
<p>the equation can be expressed in vector form as: <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-differential"></a>         </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta \dot{\psi}} &amp;\approx {-\boldsymbol{\omega}_{in}^n \times} \boldsymbol{\delta \psi}
                                                + \boldsymbol{\delta \omega}_{in}^n
                                                {- \mathbf{C}_b^n} \boldsymbol{\delta \omega}_{ib}^b \\
                                       &amp;= {-\boldsymbol{\omega}_{in}^n \times} \boldsymbol{\delta \psi}
                                          + \boldsymbol{\delta}(\boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n)
                                          {- \mathbf{C}_b^n} \boldsymbol{\delta \omega}_{ib}^b
\end{aligned}
\end{equation}
</p>
<p>The transport rate \( \boldsymbol{\omega}_{en}^n \) is defined as (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.4.1, eq. 5.44, p. 177 or <a class="el" href="citelist.html#CITEREF_gleason2009">[14]</a> Gleason, ch. 6.2.3.2, eq. 6.15, p. 155) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-transport-rate"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\omega}_{en}^n = \begin{bmatrix} \dfrac{v_E}{R_E + h} &amp; -\dfrac{v_N}{R_N + h} &amp; -\dfrac{v_E \tan{\phi}}{R_E + h} \end{bmatrix}^T
\end{equation}
</p>
<p>The differential of left and right side neglecting errors in \(R_N \) and \(R_E \) ( \( \frac{\partial R_N}{\partial p_i} = 0 \) and \( \quad \frac{\partial R_E}{\partial p_i} = 0\)) <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-transport-rate-differential"></a>                 </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \delta \omega_{en,1}^n &amp;= \frac{\partial \omega_{en,1}^n}{\partial v_E} \delta v_E
                              + \frac{\partial\omega_{en,1}^n}{\partial h} \delta h
                            = \frac{1}{R_E + h} \delta v_E
                              - \frac{v_E}{(R_E + h)^2} \delta h \\
  \delta \omega_{en,2}^n &amp;= \frac{\partial \omega_{en,2}^n}{\partial v_N} \delta v_N
                              + \frac{\partial \omega_{en,2}^n}{\partial h} \delta h
                            = -\frac{1}{R_N + h} \delta v_N
                              + \frac{v_N}{(R_N + h)^2} \delta h \\
  \delta \omega_{en,3}^n &amp;= \frac{\partial \omega_{en,3}^n}{\partial v_E} \delta v_E
                              + \frac{\partial \omega_{en,3}^n}{\partial h} \delta h
                              + \frac{\partial \omega_{en,3}^n}{\partial \phi} \delta \phi
                            = -\frac{\tan{\phi}}{R_E + h} \delta v_E
                              + \frac{v_E \tan{\phi}}{(R_E + h)^2} \delta h
                              - \frac{v_E}{(R_E + h)\cos^2{\phi}} \delta \phi
\end{aligned}
\end{equation}
</p>
<p>The Earth rotation in local-navigation-frame coordinates \( \boldsymbol{\omega}_{ie}^n \) is given <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-earth-rotation-n"></a>       </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\omega}_{ie}^n = \mathbf{C}_e^n \boldsymbol{\omega}_{ie}^e
                             = \begin{pmatrix} -\sin{\phi}\cos{\lambda} &amp; -\sin{\phi}\sin{\lambda} &amp; \cos{\phi} \\
                                                    -\sin{\lambda}      &amp;      \cos{\lambda}       &amp;      0     \\
                                               -\cos{\phi}\cos{\lambda} &amp; -\cos{\phi}\sin{\lambda} &amp; -\sin{\phi} \end{pmatrix}
                               \cdot \begin{pmatrix} 0 \\ 0 \\ \omega_{ie} \end{pmatrix}
                             = \omega_{ie} \cdot \begin{pmatrix} \cos{\phi} \\ 0 \\ -\sin{\phi} \end{pmatrix}
\end{equation}
</p>
<p>The differential of left and right side is <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-earth-rotation-n-differential"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta \omega}_{ie}^n = \frac{\partial \boldsymbol{\omega}_{ie}^n}{\partial \phi} \delta \phi
                                    = \begin{pmatrix} -\omega_{ie}\sin{\phi} \\ 0 \\ -\omega_{ie}\cos{\phi} \end{pmatrix} \delta \phi
\end{aligned}
\end{equation}
</p>
<p>Substituting <a class="el" href="#eq-LCKF_n-Derivation-Attitude-transport-rate-differential">eq-LCKF_n-Derivation-Attitude-transport-rate-differential</a> and <a class="el" href="#eq-LCKF_n-Derivation-Attitude-earth-rotation-n-differential">eq-LCKF_n-Derivation-Attitude-earth-rotation-n-differential</a> into <a class="el" href="#eq-LCKF_n-Derivation-Attitude-differential">eq-LCKF_n-Derivation-Attitude-differential</a> gives: <a class="anchor" id="eq-LCKF_n-Derivation-Attitude-differential-final"></a>                     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta \dot{\psi}} \approx {-\boldsymbol{\omega}_{in}^n \times} \boldsymbol{\delta \psi}
                                         + \begin{bmatrix}
                                               -\omega_{ie}\sin{\phi} \\
                                                          0           \\
                                               -\omega_{ie}\cos{\phi} \\
                                           \end{bmatrix}
                                           \delta \phi
                                         + \begin{bmatrix}
                                                        0         &amp;      \frac{1}{R_E + h}      &amp; 0 \\
                                               -\frac{1}{R_N + h} &amp;              0              &amp; 0 \\
                                                        0         &amp; -\frac{\tan{\phi}}{R_E + h} &amp; 0 \\
                                           \end{bmatrix}
                                           \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_D \end{pmatrix}
                                         + \begin{bmatrix}
                                                                0                  &amp; 0 &amp;       -\frac{v_E}{(R_E + h)^2}      \\
                                                                0                  &amp; 0 &amp;        \frac{v_N}{(R_N + h)^2}      \\
                                               - \frac{v_E}{(R_E + h)\cos^2{\phi}} &amp; 0 &amp;  \frac{v_E \tan{\phi}}{(R_E + h)^2} \\
                                           \end{bmatrix}
                                           \begin{pmatrix} \delta \phi \\ \delta \lambda \\ \delta h \end{pmatrix}
                                         {- \mathbf{C}_b^n} \boldsymbol{\delta \omega}_{ib}^b
\end{equation}
</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-ErrorStateEquations-LocalLevelFrame-Derivation-Velocity"></a>
Velocity Equations</h3>
<p>The equations here mainly follow <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.2, p. 343f</p>
<p>The time derivative of the velocity in local-navigation-frame coordinates is (see <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.7.1, eq. 3.69, p. 47 or <a class="el" href="citelist.html#CITEREF_jekeli2001">[24]</a> Jekeli, ch. 4.3.4, eq. 4.88, p. 127) <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{v}}^n
      = \overbrace{\boldsymbol{f}^n}^{\text{measured}}
        -\ \underbrace{(2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n}_{\text{coriolis acceleration}}
        +\ \overbrace{\mathbf{g}^n}^{\text{gravity}}
\end{equation}
</p>
<p> where</p><ul>
<li>\( \boldsymbol{v}^n = \begin{pmatrix} v_N &amp; v_E &amp; v_D \end{pmatrix}^T \) is the velocity with respect to the Earth in local-navigation frame coordinates,</li>
<li>\( \boldsymbol{f}^n = \begin{pmatrix} f_N &amp; f_E &amp; f_D \end{pmatrix}^T \) is the specific force vector as measured by a triad of accelerometers and resolved into local-navigation frame coordinates</li>
<li>\( \boldsymbol{\omega}_{ie}^n \) is the turn rate of the Earth expressed in local-navigation frame coordinates</li>
<li>\( \boldsymbol{\omega}_{en}^n \) is the turn rate of the local frame with respect to the Earth-fixed frame, called the transport rate, expressed in local-navigation frame coordinates</li>
<li>\( \mathbf{g}^n \) is the local gravity vector which is a combination of (see <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.7.1, eq. 3.75, p. 48)<ul>
<li>\( \boldsymbol{\gamma}_{ib}^n \) the local gravitation vector (caused by effects of mass attraction)</li>
<li>\( -\boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{r}^e ] \) the centrifugal acceleration caused by the Earth's rotation</li>
</ul>
</li>
</ul>
<p>The estimated velocity follows the same propagation <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-estimate"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle n$}}
      = \boldsymbol{\hat{f}}^n
      - (2 \boldsymbol{\hat{\omega}}_{ie}^n + \boldsymbol{\hat{\omega}}_{en}^n) \times \boldsymbol{\hat{v}}_e^n
      + \mathbf{\hat{g}}^n
\end{equation}
</p>
<p>Differencing equation <a class="el" href="#eq-LCKF_n-Derivation-Velocity-timeDerivative">eq-LCKF_n-Derivation-Velocity-timeDerivative</a> and <a class="el" href="#eq-LCKF_n-Derivation-Velocity-timeDerivative-estimate">eq-LCKF_n-Derivation-Velocity-timeDerivative-estimate</a> we get <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-differential"></a>          </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta \dot{v}}^n &amp;= \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle n$}} - \boldsymbol{\dot{v}}^n \\
                                &amp;= \mathbf{\hat{C}}_b^n \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^n \boldsymbol{f}^b
                                   - (2 \boldsymbol{\hat{\omega}}_{ie}^n + \boldsymbol{\hat{\omega}}_{en}^n) \times \boldsymbol{\hat{v}}^n
                                       + (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n
                                   + \mathbf{\hat{g}}^n
                                       - \mathbf{g}^n
\end{aligned}
\end{equation}
</p>
<ul>
<li>Substituting equation <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-errors">eq-LCKF_n-Derivation-Attitude-estimate-errors</a> : \( \mathbf{\hat{C}}_b^n \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n \)</li>
<li>and writing<ul>
<li>\( \boldsymbol{\delta f}^b = \boldsymbol{\hat{f}}^b - \boldsymbol{f}^b \)</li>
<li>\( \boldsymbol{\delta v}^n = \boldsymbol{\hat{v}}^n - \boldsymbol{v}^n \)</li>
<li>\( \boldsymbol{\delta \omega}_{ie}^n = \boldsymbol{\hat{\omega}}_{ie}^n - \boldsymbol{\omega}_{ie}^n \)</li>
<li>\( \boldsymbol{\delta \omega}_{en}^n = \boldsymbol{\hat{\omega}}_{en}^n - \boldsymbol{\omega}_{en}^n \)</li>
<li>\( \boldsymbol{\delta} \mathbf{g}^n = \mathbf{\hat{g}}^n - \mathbf{g}^n \)</li>
</ul>
</li>
</ul>
<p>we get <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-differential-transformation"></a>                        </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta \dot{v}}^n &amp;= [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^n \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^n \boldsymbol{f}^b
                                   - (2 \boldsymbol{\delta \omega}_{ie}^n + 2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{\hat{v}}^n
                                       + (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
                                &amp;= \mathbf{C}_b^n \boldsymbol{\hat{f}}^b - \mathbf{\Psi} \mathbf{C}_b^n \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^n \boldsymbol{f}^b
                                   - (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{\hat{v}}^n
                                   - (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times \boldsymbol{\hat{v}}^n
                                       + (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{v}^n
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
                                &amp;= - \boldsymbol{\delta \psi} \times \mathbf{C}_b^n \boldsymbol{\hat{f}}^b
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   - (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{\delta v}^n
                                   - (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times \boldsymbol{\hat{v}}^n
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
                                &amp;= (\mathbf{C}_b^n \boldsymbol{\delta f}^b + \mathbf{C}_b^n \boldsymbol{f}^b) \times \boldsymbol{\delta \psi}
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   - (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{\delta v}^n
                                   - (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times (\boldsymbol{\delta v}^n + \boldsymbol{v}^n)
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
\end{aligned}
\end{equation}
</p>
<p> Now neglecting error product terms \( \boldsymbol{\delta f}^b \times \boldsymbol{\delta \psi} \approx 0 \) and \( (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times \boldsymbol{\delta v}^n \approx 0\) <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-differential-transformation-neglect"></a>      </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta \dot{v}}^n \approx {\boldsymbol{f}^n \times} \boldsymbol{\delta \psi}
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   - (2 \boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \boldsymbol{\delta v}^n
                                   - (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times \boldsymbol{v}^n
                                   + \boldsymbol{\delta} \mathbf{g}^n
\end{equation}
</p>
<p> This is equal to <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.2, eq. 12.21, p. 344, except the sign of the gravity error term.</p>
<p>Substituting equations <a class="el" href="#eq-LCKF_n-Derivation-Attitude-transport-rate">eq-LCKF_n-Derivation-Attitude-transport-rate</a>, <a class="el" href="#eq-LCKF_n-Derivation-Attitude-transport-rate-differential">eq-LCKF_n-Derivation-Attitude-transport-rate-differential</a>, <a class="el" href="#eq-LCKF_n-Derivation-Attitude-earth-rotation-n">eq-LCKF_n-Derivation-Attitude-earth-rotation-n</a> and <a class="el" href="#eq-LCKF_n-Derivation-Attitude-earth-rotation-n-differential">eq-LCKF_n-Derivation-Attitude-earth-rotation-n-differential</a> leads to <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-final-pre"></a>                                                  </p><p class="formulaDsp">
\begin{equation}
\renewcommand*{\arraystretch}{1.9}
\begin{aligned}
  \boldsymbol{\delta \dot{v}}^n &amp;\approx {\boldsymbol{f}^n \times} \boldsymbol{\delta \psi}
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   - \left[\begin{pmatrix} 2 \omega_{ie} \cos{\phi} \\ 0 \\ - 2 \omega_{ie} \sin{\phi} \end{pmatrix}
                                      + \begin{pmatrix} \frac{v_E}{R_E + h} \\ -\frac{v_N}{R_N + h} \\ -\frac{v_E \tan{\phi}}{R_E + h} \end{pmatrix} \right]
                                          \times \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_D \end{pmatrix}
                                   - \left[\begin{pmatrix} -2\omega_{ie}\sin{\phi}\ \delta \phi \\ 0 \\ -2\omega_{ie}\cos{\phi}\ \delta \phi \end{pmatrix}
                                      + \begin{pmatrix}
                                          \frac{1}{R_E + h} \delta v_E - \frac{v_E}{(R_E + h)^2} \delta h \\
                                          -\frac{1}{R_N + h} \delta v_N + \frac{v_N}{(R_N + h)^2} \delta h \\
                                          -\frac{\tan{\phi}}{R_E + h} \delta v_E + \frac{v_E \tan{\phi}}{(R_E + h)^2} \delta h - \frac{v_E}{(R_E + h)\cos^2{\phi}} \delta \phi \\
                                        \end{pmatrix} \right]
                                          \times \begin{pmatrix} v_N \\ v_E \\ v_D \end{pmatrix}
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
                                &amp;= {\boldsymbol{f}^n \times} \boldsymbol{\delta \psi}
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   + \begin{pmatrix} - 2 \omega_{ie} \cos{\phi} - \frac{v_E}{R_E + h} \\
                                                      \frac{v_N}{R_N + h} \\
                                                      2 \omega_{ie} \sin{\phi} + \frac{v_E \tan{\phi}}{R_E + h}
                                     \end{pmatrix}
                                     \times \begin{pmatrix} \delta v_N \\
                                                            \delta v_E \\
                                                            \delta v_D \\
                                            \end{pmatrix}
                                   + \begin{pmatrix} 2\omega_{ie}\sin{\phi}\ \delta \phi - \frac{1}{R_E + h} \delta v_E + \frac{v_E}{(R_E + h)^2} \delta h \\
                                                     \frac{1}{R_N + h} \delta v_N - \frac{v_N}{(R_N + h)^2} \delta h \\
                                                     2\omega_{ie}\cos{\phi}\ \delta \phi + \frac{\tan{\phi}}{R_E + h} \delta v_E - \frac{v_E \tan{\phi}}{(R_E + h)^2} \delta h + \frac{v_E}{(R_E + h)\cos^2{\phi}} \delta \phi
                                     \end{pmatrix}
                                     \times \begin{pmatrix} v_N \\
                                                            v_E \\
                                                            v_D \\
                                            \end{pmatrix}
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
                                &amp;= {\boldsymbol{f}^n \times} \boldsymbol{\delta \psi}
                                   + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
                                   + \begin{pmatrix} \left(\frac{v_N}{R_N + h} \right) \cdot \delta v_D
                                                            - \left(2 \omega_{ie} \sin{\phi} + \frac{v_E \tan{\phi}}{R_E + h} \right) \cdot \delta v_E \\
                                                     \left(2 \omega_{ie} \sin{\phi} + \frac{v_E \tan{\phi}}{R_E + h} \right) \cdot \delta v_N
                                                            - \left(- 2 \omega_{ie} \cos{\phi} - \frac{v_E}{R_E + h} \right) \cdot \delta v_D \\
                                                     \left(- 2 \omega_{ie} \cos{\phi} - \frac{v_E}{R_E + h} \right) \cdot \delta v_E
                                                            - \left(\frac{v_N}{R_N + h} \right) \cdot \delta v_N \\
                                     \end{pmatrix}
                                   + \begin{pmatrix} \left( \frac{1}{R_N + h} \delta v_N - \frac{v_N}{(R_N + h)^2} \delta h \right) \cdot v_D - \left( 2\omega_{ie}\cos{\phi}\ \delta \phi + \frac{\tan{\phi}}{R_E + h} \delta v_E - \frac{v_E \tan{\phi}}{(R_E + h)^2} \delta h + \frac{v_E}{(R_E + h)\cos^2{\phi}} \delta \phi \right) \cdot v_E \\
                                                     \left( 2\omega_{ie}\cos{\phi}\ \delta \phi + \frac{\tan{\phi}}{R_E + h} \delta v_E - \frac{v_E \tan{\phi}}{(R_E + h)^2} \delta h + \frac{v_E}{(R_E + h)\cos^2{\phi}} \delta \phi \right) \cdot v_N - \left( 2\omega_{ie}\sin{\phi}\ \delta \phi - \frac{1}{R_E + h} \delta v_E + \frac{v_E}{(R_E + h)^2} \delta h \right) \cdot v_D \\
                                                     \left( 2\omega_{ie}\sin{\phi}\ \delta \phi - \frac{1}{R_E + h} \delta v_E + \frac{v_E}{(R_E + h)^2} \delta h \right) \cdot v_E - \left( \frac{1}{R_N + h} \delta v_N - \frac{v_N}{(R_N + h)^2} \delta h \right) \cdot v_N \\
                                     \end{pmatrix}
                                   + \boldsymbol{\delta} \mathbf{g}^n \\
\end{aligned}
\end{equation}
</p>
<p>The gravity error can be expressed as (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.4, eq. 14.59, p. 586) <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-gravityError"></a>    </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta} \mathbf{g}^e \approx - \frac{2 g_0}{r_{eS}^e} \delta h \mathbf{u}_D^e
\end{aligned}
\end{equation}
</p>
<p> where</p><ul>
<li>\( \mathbf{u}_D^e \) is the local navigation frame down unit vector</li>
<li>\( h &lt;&lt; r_{eS}^e \) is assumed</li>
<li>centrifugal term and latitude-error dependence have been neglected</li>
</ul>
<p>Reordering the terms leads to the final form <a class="anchor" id="eq-LCKF_n-Derivation-Velocity-timeDerivative-final"></a>                     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta \dot{v}}^n \approx {\boldsymbol{f}^n \times} \boldsymbol{\delta \psi}
                                        + \begin{bmatrix}
                                                        \frac{v_D}{R_N + h} &amp; - \frac{v_E \tan{\phi}}{R_E + h} - 2 \omega_{ie} \sin{\phi} - \frac{v_E \tan{\phi}}{R_E + h} &amp; \frac{v_N}{R_N + h} \\
                                                        \frac{v_E \tan{\phi}}{R_E + h} + 2 \omega_{ie} \sin{\phi} &amp; \frac{v_N \tan{\phi}}{R_E + h} + \frac{v_D}{R_E + h} &amp; \frac{v_E}{R_E + h} + 2 \omega_{ie} \cos{\phi} \\
                                                        - \frac{v_N}{R_N + h} - \frac{v_N}{R_N + h} &amp; - 2 \omega_{ie} \cos{\phi} - \frac{v_E}{R_E + h} - \frac{v_E}{R_E + h} &amp; 0 \\
                                          \end{bmatrix}
                                          \begin{pmatrix} \delta v_N \\
                                                          \delta v_E \\
                                                          \delta v_D \\
                                          \end{pmatrix}
                                        + \begin{bmatrix}
                                                        - \frac{v_E^2}{(R_E + h)\cos^2{\phi}} - 2 v_E \omega_{ie}\cos{\phi} &amp; 0 &amp; \frac{v_E^2 \tan{\phi}}{(R_E + h)^2} - \frac{v_N v_D}{(R_N + h)^2} \\
                                                        \frac{v_N v_E}{(R_E + h)\cos^2{\phi}} + 2 v_N \omega_{ie}\cos{\phi} - 2 v_D \omega_{ie}\sin{\phi} &amp; 0 &amp; - \frac{v_N v_E \tan{\phi}}{(R_E + h)^2} - \frac{v_E v_D}{(R_E + h)^2} \\
                                                        2 v_E \omega_{ie}\sin{\phi} &amp; 0 &amp; \frac{v_E^2}{(R_E + h)^2} + \frac{v_N^2}{(R_N + h)^2} - \frac{2 g_0}{r_{eS}^e} \\
                                          \end{bmatrix}
                                          \begin{pmatrix} \delta \phi \\
                                                          \delta \lambda \\
                                                          \delta h \\
                                          \end{pmatrix}
                                        + {\mathbf{C}_b^n \boldsymbol{\delta f}^b}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_n-Appendix-ErrorStateEquations-LocalLevelFrame-Comparison"></a>
Error Equations comparison</h2>
<h3><a class="anchor" id="LooselyCoupledKF_n-Appendix-ErrorStateEquations-LocalLevelFrame-Comparison-Titterton"></a>
Titterton</h3>
<p><a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 12.3.1.3, eq. 12.28, p. 345 has different <em>sign</em> in equations \( {\mathbf{F}_{\delta \dot{\psi},\delta v}^n} \), \( {\mathbf{F}_{\delta \dot{\psi},\delta r}^n} \), \( {\mathbf{F}_{\delta \dot{\psi},\delta \omega}^n} \), \( {\mathbf{F}_{\delta \dot{v},\delta \psi}^n} \)</p>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix-Titterton"></a>                                   </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \dot{R}              \\ \delta \dot{P}              \\ \delta \dot{Y}              \\
      \delta \dot{v}_{N}          \\ \delta \dot{v}_{E}          \\ \delta \dot{v}_{D}          \\
      \delta \dot{\phi}           \\ \delta \dot{\lambda}        \\ \delta \dot{h}              \\
      \delta \dot{f}_{x}^{b}      \\ \delta \dot{f}_{y}^{b}      \\ \delta \dot{f}_{z}^{b}      \\
      \delta \dot{\omega}_{x}^{b} \\ \delta \dot{\omega}_{y}^{b} \\ \delta \dot{\omega}_{z}^{b} \\
  \end{bmatrix}
  =
  \begin{bmatrix}
                  0            &amp;     \omega_{in,3}^{n}    &amp;    -\omega_{in,2}^{n}    &amp;                             0                            &amp;         {+}\frac{1}{R_E + h}            &amp;                       0                      &amp;                             {-}\omega_{ie}\sin{\phi}                             &amp;      0       &amp;                {-}\frac{v_E}{(R_E + h)^2}                  &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
         -\omega_{in,3}^{n}    &amp;             0            &amp;     \omega_{in,1}^{n}    &amp;        {-}\frac{1}{R_N + h}            &amp;                             0                             &amp;                       0                      &amp;                                                0                                                   &amp;      0       &amp;                {+}\frac{v_N}{(R_N + h)^2}                  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp; {-}\mathbf{C}_b^n &amp; \\
          \omega_{in,2}^{n}    &amp;    -\omega_{in,1}^{n}    &amp;             0            &amp;                             0                            &amp;       {-}\frac{\tan{\phi}}{R_E + h}     &amp;                       0                      &amp; {-}\omega_{ie}\cos{\phi} {-} \frac{v_E}{(R_E + h)\cos^2{\phi}} &amp;      0       &amp;            {+}\frac{v_E \tan{\phi}}{(R_E + h)^2}           &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                  0            &amp; {-}f_D &amp; {+}f_E &amp;                    \frac{v_D}{R_N + h}                   &amp; -2\frac{v_E \tan{\phi}}{R_E + h} - 2\omega_{ie}\sin{\phi} &amp;              \frac{v_N}{R_N + h}             &amp;                   -\frac{v_E^2}{(R_E+h)\cos^2{\phi}}-2v_E\omega_{ie}\cos{\phi}                     &amp;      0       &amp;         \frac{v_E^2\tan{\phi}}{(R_E+h)^2} - \frac{v_Nv_D}{(R_N+h)^2}         &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
      {+}f_D &amp;             0            &amp; {-}f_N &amp;  \frac{v_E \tan{\phi}}{R_E + h} + 2\omega_{ie}\sin{\phi} &amp;            \frac{v_N \tan{\phi} + v_D}{R_E + h}           &amp; \frac{v_E}{R_E + h} + 2\omega_{ie}\cos{\phi} &amp;    \frac{v_N v_E}{(R_E+h)\cos^2{\phi}} + 2v_N\omega_{ie}\cos{\phi} - 2v_D\omega_{ie}\sin{\phi}     &amp;      0       &amp;                -\frac{v_Nv_E\tan{\phi} + v_Ev_D}{(R_E + h)^2}                &amp;  &amp; \mathbf{C}_b^n &amp;  &amp;  &amp;             \mathbf{0}_3            &amp; \\
      {-}f_E &amp; {+}f_N &amp;             0            &amp;                  -\frac{2v_N}{R_N + h}                   &amp;       -\frac{2v_E}{R_E + h} - 2\omega_{ie}\cos{\phi}      &amp;                       0                      &amp;                                     2v_E\omega_{ie}\sin{\phi}                                      &amp;      0       &amp; \frac{v_E^2}{(R_E + h)^2} + \frac{v_N^2}{(R_N + h)^2} -\frac{2g_0}{r_{eS}^e} &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;                          &amp;                          &amp;                      \frac{1}{R_N+h}                     &amp;                             0                             &amp;                       0                      &amp;                                                0                                                   &amp;      0       &amp;                           -\frac{v_N}{(R_N + h)^2}                           &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;       \mathbf{0}_3       &amp;                          &amp;                             0                            &amp;                \frac{1}{(R_E+h)\cos{\phi}}                &amp;                       0                      &amp;                              \frac{v_E\tan{\phi}}{(R_E+h)\cos{\phi}}                               &amp;      0       &amp;                      -\frac{v_E}{(R_E + h)^2\cos{\phi}}                      &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;             \mathbf{0}_3            &amp; \\
                               &amp;                          &amp;                          &amp;                             0                            &amp;                             0                             &amp;                      -1                      &amp;                                                0                                                   &amp;      0       &amp;                                       0                                      &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;                          &amp;                          &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                                    &amp;              &amp;                                                                              &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;       \mathbf{0}_3       &amp;                          &amp;                                                          &amp;                       \mathbf{0}_3                        &amp;                                              &amp;                                                                                                    &amp; \mathbf{0}_3 &amp;                                                                              &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;             \mathbf{0}_3            &amp; \\
                               &amp;                          &amp;                          &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                                    &amp;              &amp;                                                                              &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;                          &amp;                          &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                                    &amp;              &amp;                                                                              &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\
                               &amp;       \mathbf{0}_3       &amp;                          &amp;                                                          &amp;                       \mathbf{0}_3                        &amp;                                              &amp;                                                                                                    &amp; \mathbf{0}_3 &amp;                                                                              &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;             \mathbf{0}_3            &amp; \\
                               &amp;                          &amp;                          &amp;                                                          &amp;                                                           &amp;                                              &amp;                                                                                                    &amp;              &amp;                                                                              &amp;  &amp;                &amp;  &amp;  &amp;                                     &amp; \\

  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \delta R              \\ \delta P              \\ \delta Y              \\
      \delta v_{N}          \\ \delta v_{E}          \\ \delta v_{D}          \\
      \delta \phi           \\ \delta \lambda        \\ \delta h              \\
      \delta f_{x}^{b}      \\ \delta f_{y}^{b}      \\ \delta f_{z}^{b}      \\
      \delta \omega_{x}^{b} \\ \delta \omega_{y}^{b} \\ \delta \omega_{z}^{b} \\
  \end{bmatrix}
\end{equation}
</p>
<p>As all signs related to the attitude error have a different sign, it can be explained by the attitude error being defined in the opposite direction. To check this, we can look at the definition of the correction of the state with the attitude errors (<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.1.1, eq. 14.7, p. 564) <a class="anchor" id="eq-LCKF_n-stateMatrix-Groves-attitude-correction"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{C}_b^n \approx (\mathbf{I}_3 - [\boldsymbol{\delta \psi}_{nb}^n \times]) \mathbf{\hat{C}}_b^n
\end{equation}
</p>
<p> while Titterton rearranges equation <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-errors">eq-LCKF_n-Derivation-Attitude-estimate-errors</a> and defines the correction as (<a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 13.6.2.3, eq. 13.15, p. 407) <a class="anchor" id="eq-LCKF_n-stateMatrix-Groves-attitude-correction-Titterton"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{C}_b^n = (\mathbf{I}_3 + [\boldsymbol{\delta \psi} \times]) \mathbf{\hat{C}}_b^n
\end{equation}
</p>
<p> Therefore the attitude error is defined differently in Groves and Titterton, which explains the sign change in the error equations.</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-Appendix-ErrorStateEquations-LocalLevelFrame-Comparison-Gleason"></a>
Gleason</h3>
<p><a class="el" href="citelist.html#CITEREF_gleason2009">[14]</a> Gleason, ch. 6.2.5, eq. 6.21-6.23, p. 157 define the same error equations as Titterton, but has a bracket mistake inside the velocity equation (bracket should include the '2') <a class="anchor" id="eq-LCKF_n-stateMatrix-Gleason-position-error"></a>          </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta} \mathbf{\dot{p}}  &amp;= T&#39; \boldsymbol{\delta} \mathbf{p}^n + T \boldsymbol{\delta v}^n \\
  \boldsymbol{\delta \dot{v}}^n         &amp;= {\left[ (\mathbf{C}_b^n \boldsymbol{f}^b) \times \right]} \boldsymbol{\delta \psi}_{nb}^n
                                            {+ \mathbf{C}_b^n} \boldsymbol{\delta f}^b
                                           - \left[ { 2 ( }\boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \right] \boldsymbol{\delta v}^n
                                           - \left[ (2 \boldsymbol{\delta \omega}_{ie}^n + \boldsymbol{\delta \omega}_{en}^n) \times \right] \boldsymbol{v}^n
                                           + \boldsymbol{\delta} \mathbf{g}^n \\
  \boldsymbol{\delta \dot{\psi}}_{nb}^n &amp;= {- \left[ \boldsymbol{\omega}_{in}^n \times \right]} \boldsymbol{\delta \psi}_{nb}^n + \boldsymbol{\delta \omega}_{in}^n {-\mathbf{C}_b^n} \boldsymbol{\delta \omega}_{ib}^b
\end{aligned}
\end{equation}
</p>
<h3><a class="anchor" id="LooselyCoupledKF_n-Appendix-ErrorStateEquations-LocalLevelFrame-Comparison-Noureldin"></a>
Noureldin</h3>
<p>Extracting the equations from <a class="el" href="citelist.html#CITEREF_noureldin2013">[35]</a> Noureldin, ch. 6.1.5, eq. 6.76, p. 219 gives</p>
<p><a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Position"></a>         </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{\phi} \\ \delta \dot{\lambda} \\ \delta \dot{h} \end{pmatrix}
  =
  \begin{pmatrix}
                 0              &amp; \frac{1}{R_N+h} &amp; 0 \\
    \frac{1}{(R_E+h)\cos{\phi}} &amp;        0        &amp; 0 \\
                 0              &amp;        0        &amp; 1 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_E \\ \delta v_N \\ \delta v_U \end{pmatrix}
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Velocity"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{v}_{E} \\ \delta \dot{v}_{N} \\ \delta \dot{v}_{U} \end{pmatrix}
  =
  \begin{pmatrix}
      0  &amp;  f_U &amp; -f_N \\
    -f_U &amp;   0  &amp;  f_E \\
     f_N &amp; -f_E &amp;   0  \\
  \end{pmatrix}
  \begin{pmatrix} \delta P \\ \delta R \\ \delta Y \end{pmatrix}
  + \mathbf{C}_b^{enu} \boldsymbol{\delta f}^b
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Attitude"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{P} \\ \delta \dot{R} \\ \delta \dot{Y} \end{pmatrix}
  =
  \begin{pmatrix}
                 0              &amp; \frac{1}{R_N + h} &amp; 0 \\
         -\frac{1}{R_E + h}     &amp;         0         &amp; 0 \\
    -\frac{\tan{\phi}}{R_E + h} &amp;         0         &amp; 0 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_E \\ \delta v_N \\ \delta v_U \end{pmatrix}
  + \mathbf{C}_b^{enu} \boldsymbol{\delta \omega}_{ib}^b
\end{equation}
</p>
<p>Reordering roll/pitch and east/north gives <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Position-reordered"></a>         </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{\phi} \\ \delta \dot{\lambda} \\ \delta \dot{h} \end{pmatrix}
  =
  \begin{pmatrix}
    \frac{1}{R_N+h} &amp;              0              &amp; 0 \\
           0        &amp; \frac{1}{(R_E+h)\cos{\phi}} &amp; 0 \\
           0        &amp;              0              &amp; 1 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_U \end{pmatrix}
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Velocity-reordered"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{v}_{N} \\ \delta \dot{v}_{E} \\ \delta \dot{v}_{U} \end{pmatrix}
  =
  \begin{pmatrix}
      0  &amp; -f_U &amp;  f_E \\
     f_U &amp;   0  &amp; -f_N \\
    -f_E &amp;  f_N &amp;   0  \\
  \end{pmatrix}
  \begin{pmatrix} \delta R \\ \delta P \\ \delta Y \end{pmatrix}
  + \mathbf{C}_b^{neu} \boldsymbol{\delta f}^b
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Attitude-reordered"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{R} \\ \delta \dot{P} \\ \delta \dot{Y} \end{pmatrix}
  =
  \begin{pmatrix}
            0         &amp;      -\frac{1}{R_E + h}     &amp; 0 \\
    \frac{1}{R_N + h} &amp;              0              &amp; 0 \\
            0         &amp; -\frac{\tan{\phi}}{R_E + h} &amp; 0 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_U \end{pmatrix}
  + \mathbf{C}_b^{neu} \boldsymbol{\delta \omega}_{ib}^b
\end{equation}
</p>
<p> In <a class="el" href="citelist.html#CITEREF_noureldin2013">[35]</a> ch. 2.2.6.1, p. 32 Noureldin defines the yaw angle as measured counterclockwise from north which is the opposite measurement direction of the NED convention. Therefore all yaw terms have to flip the sign. <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Position-yaw-sign"></a>         </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{\phi} \\ \delta \dot{\lambda} \\ \delta \dot{h} \end{pmatrix}
  =
  \begin{pmatrix}
    \frac{1}{R_N+h} &amp;              0              &amp; 0 \\
           0        &amp; \frac{1}{(R_E+h)\cos{\phi}} &amp; 0 \\
           0        &amp;              0              &amp; 1 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_U \end{pmatrix}
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Velocity-yaw-sign"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{v}_{N} \\ \delta \dot{v}_{E} \\ \delta \dot{v}_{U} \end{pmatrix}
  =
  \begin{pmatrix}
      0  &amp; -f_U &amp; -f_E \\
     f_U &amp;   0  &amp;  f_N \\
    -f_E &amp;  f_N &amp;   0  \\
  \end{pmatrix}
  \begin{pmatrix} \delta R \\ \delta P \\ \delta Y \end{pmatrix}
  + \mathbf{C}_b^{neu} \boldsymbol{\delta f}^b
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Attitude-yaw-sign"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{R} \\ \delta \dot{P} \\ \delta \dot{Y} \end{pmatrix}
  =
  \begin{pmatrix}
            0         &amp;     -\frac{1}{R_E + h}     &amp; 0 \\
    \frac{1}{R_N + h} &amp;             0              &amp; 0 \\
            0         &amp; \frac{\tan{\phi}}{R_E + h} &amp; 0 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_U \end{pmatrix}
  + \mathbf{C}_b^{neu} \boldsymbol{\delta \omega}_{ib}^b
\end{equation}
</p>
<p>Next we replace the up component with a down component <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Position-up-down"></a>         </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{\phi} \\ \delta \dot{\lambda} \\ \delta \dot{h} \end{pmatrix}
  =
  \begin{pmatrix}
    \frac{1}{R_N+h} &amp;              0              &amp;  0 \\
           0        &amp; \frac{1}{(R_E+h)\cos{\phi}} &amp;  0 \\
           0        &amp;              0              &amp; -1 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_D \end{pmatrix}
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Velocity-up-down"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{v}_{N} \\ \delta \dot{v}_{E} \\ \delta \dot{v}_{D} \end{pmatrix}
  =
  \begin{pmatrix}
                0            &amp; {+}f_D &amp; {-}f_E \\
    {-}f_D &amp;             0            &amp; {+}f_N \\
    {+}f_E &amp; {-}f_N &amp;             0            \\
  \end{pmatrix}
  \begin{pmatrix} \delta R \\ \delta P \\ \delta Y \end{pmatrix}
  {+} \mathbf{C}_b^n \boldsymbol{\delta f}^b
\end{equation}
</p>
<p> <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Attitude-up-down"></a>          </p><p class="formulaDsp">
\begin{equation}
  \begin{pmatrix} \delta \dot{R} \\ \delta \dot{P} \\ \delta \dot{Y} \end{pmatrix}
  =
  \begin{pmatrix}
                      0                    &amp;     {-}\frac{1}{R_E + h}      &amp; 0 \\
    {+}\frac{1}{R_N + h} &amp;                       0                         &amp; 0 \\
                      0                    &amp; {+}\frac{\tan{\phi}}{R_E + h} &amp; 0 \\
  \end{pmatrix}
  \begin{pmatrix} \delta v_N \\ \delta v_E \\ \delta v_D \end{pmatrix}
  + \mathbf{C}_b^n \boldsymbol{\delta \omega}_{ib}^b
\end{equation}
</p>
<p> As in <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, all signs concerning the attitude errors are now switched comparing to <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton. This leads to the same assumption, that the attitude errors are defined differently. And this can easily be shown by looking at <a class="el" href="citelist.html#CITEREF_noureldin2013">[35]</a> Noureldin, ch. 6.1.3, eq. 6.44, p. 212 <a class="anchor" id="eq-LCKF_n-stateMatrix-Noureldin-Attitude-error-definition"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\hat{C}}_b^n = (\mathbf{I} + \mathbf{\Psi}) \mathbf{C}_b^n
\end{equation}
</p>
<p> Comparing this with equation <a class="el" href="#eq-LCKF_n-Derivation-Attitude-estimate-errors">eq-LCKF_n-Derivation-Attitude-estimate-errors</a> we can see that the attitude error is defined in the opposite direction. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="algorithms_landing_page.html">Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
