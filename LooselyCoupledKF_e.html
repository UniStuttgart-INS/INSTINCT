<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INSTINCT: INS/GNSS Loosely-coupled Kalman Filter (Earth-fixed frame)</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/color','[tex]/colortbl']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','color','colortbl']
  }
};
window.MathJax = {
    tex: {
        tags: 'ams'
    }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <!--Doxygen Awesome Theme related settings:-->
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeTabs.init()
  </script>
  <!--End of Doxygen Awesome settings-->
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="INSTINCT_Logo_Text.png"  /></td>
              <td id="projectalign">
                <div id="projectname"><span
                    id="projectnumber">&#160;0.3.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('LooselyCoupledKF_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">INS/GNSS Loosely-coupled Kalman Filter (Earth-fixed frame)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations"></a>
Earth Frame Error State Equations</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-ShortForm"></a>
Short form</h2>
<p><a class="anchor" id="eq-LCKF_e-stateMatrix-short"></a>                        </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}}_{eb}^e \\
      \boldsymbol{\delta \dot{v}}_{eb}^e \\
      \boldsymbol{\delta \dot{r}}_{eb}^e \\
      \boldsymbol{\delta \dot{f}}_{ib}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
  \end{bmatrix}
  =
  \begin{bmatrix}
      \mathbf{F}_{\dot{\psi},\psi}^e     &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{C}_b^e \\
      \mathbf{F}_{\delta \dot{v},\psi}^e &amp; \mathbf{F}_{\delta \dot{v},\delta v}^e &amp; \mathbf{F}_{\delta \dot{v},\delta r}^e &amp; \mathbf{C}_b^e &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{I}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3   &amp; \mathbf{0}_3   \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta\psi}_{eb}^e \\
      \boldsymbol{\delta v}_{eb}^e \\
      \boldsymbol{\delta r}_{eb}^e \\
      \boldsymbol{\delta f}_{ib}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \\
  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-DetailedForm"></a>
Detailed form</h2>
<p><a class="anchor" id="eq-LCKF_e-stateMatrix"></a>                                  </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \delta \dot{\psi}_{eb,1}^e  \\ \delta \dot{\psi}_{eb,2}^e  \\ \delta \dot{\psi}_{eb,3}^e  \\ \hdashline
      \delta \dot{v}_{eb,x}^e     \\ \delta \dot{v}_{eb,y}^e     \\ \delta \dot{v}_{eb,z}^e     \\ \hdashline
      \delta \dot{r}_{eb,x}^e     \\ \delta \dot{r}_{eb,y}^e     \\ \delta \dot{r}_{eb,z}^e     \\ \hdashline
      \delta \dot{f}_{x}^{b}      \\ \delta \dot{f}_{y}^{b}      \\ \delta \dot{f}_{z}^{b}      \\ \hdashline
      \delta \dot{\omega}_{x}^{b} \\ \delta \dot{\omega}_{y}^{b} \\ \delta \dot{\omega}_{z}^{b} \\
  \end{bmatrix}
  =
  \left[ \begin{array}{ccc:ccc:ccc:ccc:ccc}
           0       &amp;  \omega_{ie} &amp;       0     &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
      -\omega_{ie} &amp;       0      &amp;       0     &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp; \mathbf{C}_b^e &amp; \\
           0       &amp;       0      &amp;       0     &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
           0       &amp;  f_{ib,z}^e  &amp; -f_{ib,y}^e &amp;       0        &amp; 2 \omega_{ie} &amp;  0  &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
     -f_{ib,z}^e   &amp;       0      &amp;  f_{ib,x}^e &amp; -2 \omega_{ie} &amp;       0       &amp;  0  &amp;  &amp; - \left( \dfrac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \dfrac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|} + \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \right) &amp;  &amp;  &amp; \mathbf{C}_b^e &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
      f_{ib,y}^e   &amp; -f_{ib,x}^e  &amp;       0     &amp;       0        &amp;       0       &amp;  0  &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{I}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\ \hdashline
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
                   &amp; \mathbf{0}_3 &amp;             &amp;                &amp; \mathbf{0}_3  &amp;     &amp;  &amp;                                                                                       \mathbf{0}_3                                                                                      &amp;  &amp;  &amp;  \mathbf{0}_3  &amp;  &amp;  &amp;  \mathbf{0}_3  &amp; \\
                   &amp;              &amp;             &amp;                &amp;               &amp;     &amp;  &amp;                                                                                                                                                                                         &amp;  &amp;  &amp;                &amp;  &amp;  &amp;                &amp; \\
  \end{array} \right]
  \cdot
  \begin{bmatrix}
      \delta \psi_{eb,1}^e  \\ \delta \psi_{eb,2}^e  \\ \delta \psi_{eb,3}^e  \\ \hdashline
      \delta v_{eb,x}^e     \\ \delta v_{eb,y}^e     \\ \delta v_{eb,z}^e     \\ \hdashline
      \delta r_{eb,x}^e     \\ \delta r_{eb,y}^e     \\ \delta r_{eb,z}^e     \\ \hdashline
      \delta f_{x}^{b}      \\ \delta f_{y}^{b}      \\ \delta f_{z}^{b}      \\ \hdashline
      \delta \omega_{x}^{b} \\ \delta \omega_{y}^{b} \\ \delta \omega_{z}^{b} \\
  \end{bmatrix}
\end{equation}
</p>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.3, eq. 14.48, p. 583</li>
</ul>
<h1><a class="anchor" id="LooselyCoupledKF_e-Noise"></a>
Augmented State with Noise</h1>
<p>The continuous linear dynamic system can be expressed as <a class="anchor" id="eq-LCKF_e-dynamicModel"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{\dot{x}} = \mathbf{F} \cdot \boldsymbol{\delta} \mathbf{x} + \mathbf{G} \cdot \mathbf{w}
\end{equation}
</p>
<p>Process noise is introduced into the \( \mathbf{F} \) and \( \mathbf{G} \) matrices in the accelerometer and gyroscope bias terms. Therefore the error equations can be extended as follows</p>
<p><a class="anchor" id="eq-LCKF_e-dynamicModel-short"></a>                                  </p><p class="formulaDsp">
\begin{equation}
  \begin{bmatrix}
      \boldsymbol{\delta \dot{\psi}}_{eb}^e \\
      \boldsymbol{\delta \dot{v}}_{eb}^e \\
      \boldsymbol{\delta \dot{r}}_{eb}^e \\
      \boldsymbol{\delta \dot{f}}_{ib}^{\raise-0.45ex\hbox{$\scriptstyle b$}} \\
      \boldsymbol{\delta \dot{\omega}}_{ib}^b \\
  \end{bmatrix}
  =
  \begin{bmatrix}
      \mathbf{F}_{\dot{\psi},\psi}^e     &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;       \mathbf{C}_b^e       \\
      \mathbf{F}_{\delta \dot{v},\psi}^e &amp; \mathbf{F}_{\delta \dot{v},\delta v}^e &amp; \mathbf{F}_{\delta \dot{v},\delta r}^e &amp;    \mathbf{C}_b^e    &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{I}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp; -\boldsymbol{\beta}_f &amp;       \mathbf{0}_3         \\
      \mathbf{0}_3                         &amp; \mathbf{0}_3                             &amp; \mathbf{0}_3                             &amp;    \mathbf{0}_3      &amp;  -\boldsymbol{\beta}_\omega \\
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
      \boldsymbol{\delta \psi}_{eb}^e \\
      \boldsymbol{\delta v}_{eb}^e \\
      \boldsymbol{\delta r}_{eb}^e \\
      \boldsymbol{\delta f}_{ib}^b \\
      \boldsymbol{\delta \omega}_{ib}^b \\
  \end{bmatrix}
  +
  \begin{bmatrix}
       \mathbf{C}_b^e &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{C}_b^e &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{I}_3 &amp; \mathbf{0}_3 \\
       \mathbf{0}_3   &amp; \mathbf{0}_3   &amp; \mathbf{0}_3 &amp; \mathbf{I}_3 \\
  \end{bmatrix}
  \cdot
  \mathbf{w}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-RW"></a>
Random Walk</h2>
<p>The random noise on the accelerometer and gyro measurements can be estimated as a Random Walk in the angle and velocity errors.</p>
<p><a class="anchor" id="eq-LCKF_e-random-walk"></a>  </p><p class="formulaDsp">
\begin{equation}
  \dot{x} = 0 + W(t)
\end{equation}
</p>
<p>In general, the noise can have an arbitrary characteristic. In a Kalman filter, however, it must be normally distributed and is therefore limited to a Wiener Process. The terms in the noise input matrix \( \mathbf{G} \) are not scaled and therefore need to be compensated with a noise scale matrix \( \mathbf{W} \) depending on the amplitude of the noise process. The amplitude is defined by the standard deviation \(\sigma\). This parameter can be chosen by the user for the accel and gyro measurements:</p>
<p><a class="anchor" id="eq-LCKF_e-random-walk-S-noise"></a>   </p><p class="formulaDsp">
\begin{equation}
  {S_{ra,j}} = \sigma_{ra,j}, \qquad
  {S_{rg,j}} = \sigma_{rg,j}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{ra} \) is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li>\( \sigma_{rg} \) is the standard deviation of the noise on the gyro angular-rate measurements</li>
</ul>
<p>The bias states are also modeled as a random process. In case of random walk, their amplitudes are defined analogously to the above and \(\beta = 0\).</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-GM1"></a>
Gauss-Markov 1. Order</h2>
<p>Another option to model the bias states is given by the Gauss-Markov 1. Order process:</p>
<p><a class="anchor" id="eq-LCKF_e-gauss-markov-1"></a>  </p><p class="formulaDsp">
\begin{equation}
  \dot{x} = -\beta x + W(t)
\end{equation}
</p>
<p>This introduces a deterministic part into the equation, namely the correlation coefficient \(\beta\). This parameter defines, how much a current state is correlated with past states. The elements of the \( \mathbf{F} \) matrix are then <a class="anchor" id="eq-LCKF_e-random-walk-beta"></a>       </p><p class="formulaDsp">
\begin{equation}
  {\boldsymbol{\beta}_f} = \begin{pmatrix} \beta_{f} &amp;      0     &amp;      0     \\
                                                                    0       &amp; \beta_{f} &amp;      0     \\
                                                                    0       &amp;      0     &amp; \beta_{f} \end{pmatrix}, \qquad
  {\boldsymbol{\beta}_\omega} = \begin{pmatrix} \beta_{\omega} &amp;        0        &amp;        0        \\
                                                                           0        &amp; \beta_{\omega} &amp;        0        \\
                                                                           0        &amp;        0        &amp; \beta_{\omega} \end{pmatrix}
\end{equation}
</p>
<p> where</p><ul>
<li>\( \beta_{f} \) is the Gauss-Markov constant for the accelerometer ùõΩ = 1 / ùúè (ùúè correlation length)</li>
<li>\( \beta_{\omega} \) is the Gauss-Markov constant for the gyroscope ùõΩ = 1 / ùúè (ùúè correlation length)</li>
</ul>
<p>Like before, the scaling is done inside the noise scale matrix. Now, the bias noise's amplitude is given by <a class="anchor" id="eq-LCKF_e-random-walk-S-bias_Brown"></a>   </p><p class="formulaDsp">
\begin{equation}
  {S_{bad,j}} = \sqrt{\frac{2\sigma_{bad,j}^2}{\tau_{bad}}} , \qquad
  {S_{bgd,j}} = \sqrt{\frac{2\sigma_{bgd,j}^2}{\tau_{bgd}}}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> with a given standard deviation of \(\sigma_{bad}\) for the accelerometer's bias noise and \(\sigma_{bgd}\) for the gyro's bias noise. The correlation lengths \( \tau_{bad} \) and \( \tau_{bgd} \) define how much a current state is correlated to values in the past. This process is generally limited to normal distributions. A detailed example of this type of system can be found in Brown &amp; Hwang <a class="el" href="citelist.html#CITEREF_brown2011">[10]</a> (example 9.6).</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Noise-Scale-matrix"></a>
Noise scale matrix W</h2>
<p><a class="anchor" id="eq-LCKF_e-random-walk-noise-scale-matrix-W"></a>        </p><p class="formulaDsp">
\begin{equation}
  \mathbf{W} =
  \begin{bmatrix}
      \mathbf{S}_{rg} &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{S}_{ra} &amp; \mathbf{0}_3     &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{S}_{bad} &amp; \mathbf{0}_3     \\
      \mathbf{0}_3    &amp; \mathbf{0}_3    &amp; \mathbf{0}_3     &amp; \mathbf{S}_{bgd} \\
  \end{bmatrix}
\end{equation}
</p>
<p>\( \mathbf{S}_{rg}, \mathbf{S}_{ra}, \mathbf{S}_{bad}, \mathbf{S}_{bgd} \) are diagonal matrices where entries are filled with the PSDs from <a class="el" href="#eq-LCKF_e-random-walk-S-noise">eq-LCKF_e-random-walk-S-noise</a> and <a class="el" href="#eq-LCKF_e-random-walk-S-bias">eq-LCKF_e-random-walk-S-bias</a> or <a class="el" href="#eq-LCKF_e-random-walk-S-bias_Brown">eq-LCKF_e-random-walk-S-bias_Brown</a>.</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Groves-process-noise-definition"></a>
Groves' process noise definition</h2>
<p>In Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a>, process noise is defined without the need of integration. Instead, noise amplitudes are given directly integrated over one time step \(\tau_i\). Therefore, the <b>PSDs of the accelerometer and gyro noise</b> are: <a class="anchor" id="eq-LCKF_e-random-walk-S-noise-Groves"></a>   </p><p class="formulaDsp">
\begin{equation}
  {S_{ra,j}} = \sigma_{ra,j}^2 \tau_i, \qquad
  {S_{rg,j}} = \sigma_{rg,j}^2 \tau_i, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{ra} \) is the standard deviation of the noise on the accelerometer specific-force measurements</li>
<li>\( \sigma_{rg} \) is the standard deviation of the noise on the gyro angular-rate measurements</li>
<li>\( \tau_i \) is the interval between the input of successive accelerometer and gyro outputs to the inertial navigation equations</li>
</ul>
<p>The bias states are modeled by Groves with the noise PSD's: <a class="anchor" id="eq-LCKF_e-random-walk-S-bias"></a>   </p><p class="formulaDsp">
\begin{equation}
  {S_{bad,j}} = \frac{\sigma_{bad,j}^2}{\tau_{bad}} , \qquad
  {S_{bgd,j}} = \frac{\sigma_{bgd,j}^2}{\tau_{bgd}}, \qquad\qquad j \in x,y,z
\end{equation}
</p>
<p> where</p><ul>
<li>\( \sigma_{bad} \) and \( \sigma_{bgd} \) are the standard deviations of the accelerometer and gyro dynamic biases</li>
<li>\( \tau_{bad} \) and \( \tau_{bgd} \) are the correlation times of the dynamic accelerometer and gyro biases</li>
</ul>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.6, eq. 14.84, p. 592</p>
<p>Although correlation lengths \(\tau_{bad} \) and \( \tau_{bgd} \) are considered, this process is rather a random walk than a Gauss-Markov 1. order process, because of the missing deterministic part in \(\mathbf{F}\).</p>
<p>In INSTINCT, Groves' method <a class="el" href="#eq-LCKF_e-random-walk-S-bias">eq-LCKF_e-random-walk-S-bias</a> is not altered from its reference <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> to avoid confusion.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-KF-Matrices"></a>
Kalman-Filter Matrices</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-Phi-Q"></a>
State transition matrix ùöΩ &amp; Process noise covariance matrix Q</h2>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Phi"></a>
State transition matrix ùöΩ</h3>
<h4><a class="anchor" id="autotoc_md26"></a>
Exponential Matrix</h4>
<p>The state transition matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_e-Phi-exp"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\Phi} = \exp{(\mathbf{F} \tau_s)}
\end{equation}
</p>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.2.3, eq. 3.33, p. 97</p>
<h4><a class="anchor" id="autotoc_md27"></a>
Taylor series</h4>
<p>The exponential matrix cannot be calculated directly and numerical methods are computationally intensive. Therefore the transition matrix can be computed as a power-series expansion</p>
<p><a class="anchor" id="eq-LCKF_e-Phi-Taylor"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\Phi} = \sum_{r=0}^{\infty} \frac{\mathbf{F}^r \tau_s^r}{r!} = \mathbf{I} + \mathbf{F} \tau_s + \frac{1}{2} \mathbf{F}^2 \tau^2 + \frac{1}{6} \mathbf{F}^3 \tau_s^3 + \dots
\end{equation}
</p>
<p>see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.2.3, eq. 3.34, p. 98</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Q"></a>
Process noise covariance matrix Q</h3>
<p>The process noise covariance matrix is defined as</p>
<p><a class="anchor" id="eq-LCKF_e-Q-exact"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{Q}_{k-1} = \int_{t_k - \tau_s}^{t_k} \exp{(\mathbf{F}_{k-1} (t_k-t&#39;))} \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \exp{(\mathbf{F}_{k-1}^T (t_k-t&#39;))} dt&#39;
\end{equation}
</p>
<p>In Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a>, this matrix is approximated as (see ch. 3.2.3, eq. 3.43/3.45, p. 99):</p>
<p><a class="anchor" id="eq-LCKF_e-Q-approx"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{Q}_{k-1} \approx \mathbf{G}_{k-1} \mathbf{W}_{k-1} \mathbf{G}_{k-1}^T \tau_s
\end{equation}
</p>
<p>This method resembles a Taylor expansion up to 1. order. Since Groves <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> models the IMU measurements and their biases as random walk processes (see section <a class="el" href="#LooselyCoupledKF_e-Groves-process-noise-definition">Groves' process noise definition</a>), only the van-Loan-method can be configured to model biases as Gauss-Markov 1. order processes.</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-KF-Phi-Q-Van-Loan"></a>
Van Loan method</h3>
<p>The state transition matrix and the system/process noise covariance matrix can be calculated with the van Loan method <a class="el" href="citelist.html#CITEREF_loan1978">[48]</a> . In short</p>
<ol type="1">
<li>Form a \( 2n \times 2n \) matrix called \( \mathbf{A} \) ( \( n \) is the dimension of \( \mathbf{x} \) and \( \mathbf{W} \) is the power spectral density of the noise \( W(t) \)) <a class="anchor" id="eq-LCKF_e-Loan-A"></a>   <p class="formulaDsp">
\begin{equation}
  \mathbf{A} = \begin{bmatrix} -\mathbf{F} &amp; \mathbf{G} \mathbf{W} \mathbf{G}^T \\
                                \mathbf{0} &amp;            \mathbf{F}^T          \end{bmatrix} \Delta t
\end{equation}
</p>
</li>
<li>Calculate the exponential of \( \mathbf{A} \) <a class="anchor" id="eq-LCKF_e-Loan-B"></a>       <p class="formulaDsp">
\begin{equation}
  \mathbf{B} = \text{expm}(\mathbf{A}) = \left[ \begin{array}{c;{2pt/2pt}c}
                                            \dots          &amp; \mathbf{\Phi}^{-1} \mathbf{Q} \\[2mm]
                                            \hdashline[2pt/2pt] &amp;                                  \\[-2mm]
                                            \mathbf{0}          &amp; \mathbf{\Phi}^T                     \end{array} \right]
                                       = \begin{bmatrix} \mathbf{B}_{11} &amp; \mathbf{B}_{12} \\
                                                         \mathbf{B}_{21} &amp; \mathbf{B}_{22} \end{bmatrix}
\end{equation}
</p>
</li>
<li>Calculate the state transition matrix \( \mathbf{\Phi} \) as <a class="anchor" id="eq-LCKF_e-Loan-Phi"></a>  <p class="formulaDsp">
\begin{equation}
  \mathbf{\Phi} = \mathbf{B}_{22}^T
\end{equation}
</p>
</li>
<li>Calculate the process noise covariance matrix \( \mathbf{Q} \) as <a class="anchor" id="eq-LCKF_e-Loan-Q"></a>  <p class="formulaDsp">
\begin{equation}
  \mathbf{Q} = \mathbf{\Phi} \mathbf{B}_{12}
\end{equation}
</p>
</li>
</ol>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-P"></a>
Error covariance matrix P</h2>
<p>The error covariance matrix is initialized as a diagonal matrix with the variance of the initial state as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_e-P"></a>         </p><p class="formulaDsp">
\begin{equation}
  \mathbf{P}_0 =
  \begin{bmatrix}
      \boldsymbol{\sigma}_{\boldsymbol{\delta \psi}}^2 &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp;                        \mathbf{0}_3                       \\
                                                       &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta v^e}}^2 &amp;                                                 &amp;                                                 &amp;                                                           \\
                           \vdots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta r^e}}^2 &amp;                                                 &amp;                          \vdots                           \\
                                                       &amp;                                                 &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta f^b}}^2 &amp;                                                           \\
                        \mathbf{0}_3                   &amp;                                                 &amp;                      \dots                      &amp;                                                 &amp; \boldsymbol{\sigma}_{\boldsymbol{\delta \omega^b_{ib}}}^2 \\
  \end{bmatrix}
\end{equation}
</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-deltaz"></a>
Measurement innovation ùõøz</h2>
<p><a class="anchor" id="eq-LCKF_e-deltaz"></a>   </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta} \mathbf{z}^e = \begin{pmatrix} \tilde{\mathbf{r}}_{b,G}^e - \hat{\mathbf{r}}_{b}^e - \mathbf{C}_b^e \mathbf{l}_{ba}^b \\
                                      \tilde{\mathbf{v}}^e_{G} - \hat{\mathbf{v}}^e - \mathbf{C}_b^e (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) + \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e \mathbf{l}_{ba}^b \end{pmatrix}
\end{equation}
</p>
<p>where</p><ul>
<li>\( G \) denotes GNSS indicated measurements</li>
<li>\( \mathbf{l}_{ba}^b \) is the lever arm from the INS to the GNSS antenna in [m]</li>
</ul>
<p>This form corresponds to</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.3.1, eq. 14.102, p. 598</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-H"></a>
Measurement sensitivity Matrix H</h2>
<p><a class="anchor" id="eq-LCKF_e-H-general"></a>   </p><p class="formulaDsp">
\begin{equation}
  \mathbf{H}_k = \left. \frac{\partial \mathbf{h} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
               = \left. \frac{\partial \mathbf{z} (\mathbf{x}, t_k)}{\partial \mathbf{x}} \right|_{x = \hat{x}_k^{-}}
\end{equation}
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 3.4.1, eq. 3.90, p. 119</li>
</ul>
<p><a class="anchor" id="eq-LCKF_e-H"></a>      </p><p class="formulaDsp">
\begin{equation}
  \mathbf{H}^e =
  \begin{bmatrix}
      \mathbf{H}_{r,\delta \psi}^e &amp;  \mathbf{0}_3 &amp; -\mathbf{I}_3 &amp; \mathbf{0}_3 &amp; \mathbf{0}_3                          \\
      \mathbf{H}_{v,\delta \psi}^e &amp; -\mathbf{I}_3 &amp;  \mathbf{0}_3 &amp; \mathbf{0}_3 &amp; \mathbf{H}_{v,\omega_{ib}^b}^e \\
  \end{bmatrix}
\end{equation}
</p>
<p>where <a class="anchor" id="eq-LCKF_e-H-sub"></a>      </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  {\mathbf{H}_{r,\delta \psi}^e}    &amp;\approx \left[ (\mathbf{C}_b^e \mathbf{l}_{ba}^b) \times \right] \\
  {\mathbf{H}_{v,\delta \psi}^e}    &amp;\approx \left[ \left\{ \mathbf{C}_b^e (\boldsymbol{\omega}_{ib}^b \times \mathbf{l}_{ba}^b) - \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e \mathbf{l}_{ba}^b \right\} \times \right] \\
  {\mathbf{H}_{v,\omega_{ib}^b}^e} &amp;\approx \mathbf{C}_b^e \left[ \mathbf{l}_{ba}^b \times \right] \\
\end{aligned}
\end{equation}
</p>
<p>See</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.3.1, eq. 14.111/14.112, p. 600</li>
</ul>
<h2><a class="anchor" id="LooselyCoupledKF_e-KF-R"></a>
Measurement noise covariance matrix R</h2>
<p>The measurement noise covariance matrix is a diagonal matrix with the variances of the measurements as diagonal elements.</p>
<p><a class="anchor" id="eq-LCKF_e-R"></a>      </p><p class="formulaDsp">
\begin{equation}
  \mathbf{R} = E \left( (\mathbf{z} - \mathbf{H} \mathbf{x})(\mathbf{z} - \mathbf{H} \mathbf{x})^T \right) =
  \begin{bmatrix}
      \boldsymbol{\sigma}^2_{\mathbf{z}_{\boldsymbol{\delta r}^e}} &amp;                         \mathbf{0}_3                         \\
                              \mathbf{0}_3                         &amp; \boldsymbol{\sigma}^2_{\mathbf{z}_{\boldsymbol{\delta v}^e}} \\
  \end{bmatrix}
\end{equation}
</p>
<p>This variances can be set static or ideally come from the GNSS receiver.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-Corrections"></a>
Corrections</h1>
<p>This section describes how the errors are applied to the total state.</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Corrections-State"></a>
Position, Velocity, Attitude</h2>
<p>The position and velocity errors get applied by simply subtracting them from the previous total state (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.1.1, eq. 14.8, 14.9, p. 564)</p>
<p><a class="anchor" id="eq-LCKF_e-correction-position-velocity"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{r}^{e,+} &amp;= \boldsymbol{r}^{e,-} - \boldsymbol{\delta r}^{e} \\
  \boldsymbol{v}^{e,+} &amp;= \boldsymbol{v}^{e,-} - \boldsymbol{\delta v}^{e}
\end{aligned}
\end{equation}
</p>
<p>The attitude correction can be derived from equation <a class="el" href="#eq-LCKF_e-Derivation-Attitude-estimate-errors">eq-LCKF_e-Derivation-Attitude-estimate-errors</a> (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.1.1, eq. 14.7, p. 564) <a class="anchor" id="eq-LCKF_e-correction-attitude"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{C}_b^{e,+} = (\mathbf{I}_3 - [\boldsymbol{\delta \psi} \times]) \mathbf{C}_b^{e,-}
\end{equation}
</p>
<p>After applying the errors to the total state, the errors have to be reset to zero (closed-loop).</p>
<h2><a class="anchor" id="LooselyCoupledKF_e-Corrections-Bias"></a>
Biases</h2>
<p>To correct the accelerometer and gyroscope measurements, we need to accumulate the error states. This has to be done, because contrary to the normal state, the expected value of the biases is not zero.</p>
<p><a class="anchor" id="eq-LCKF_e-correction-accel-gyro-accumulate"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\Delta f}^{b,+}           &amp;= \boldsymbol{\Delta f}^{b,-}           + \boldsymbol{\delta f}^b \\
  \boldsymbol{\Delta \omega}_{ib}^{b,+} &amp;= \boldsymbol{\Delta \omega}_{ib}^{b,-} + \boldsymbol{\delta \omega}_{ib}^b
\end{aligned}
\end{equation}
</p>
<p>Afterwards this accumulated value can be applied to the measurements by subtracting it</p>
<p><a class="anchor" id="eq-LCKF_e-correction-accel-gyro"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{f}^{p,+}           &amp;= \boldsymbol{f}^{p,-}           - \mathbf{C}_b^p \boldsymbol{\Delta f}^{b,+} \\
  \boldsymbol{\omega}_{ib}^{p,+} &amp;= \boldsymbol{\omega}_{ib}^{p,-} - \mathbf{C}_b^p \boldsymbol{\Delta \omega}_{ib}^{b,+}
\end{aligned}
\end{equation}
</p>
<p>Afterwards the bias in the error state gets reset to zero, as it is accounted for in the accumulated value.</p>
<h1><a class="anchor" id="LooselyCoupledKF_e-Appendix"></a>
Appendix</h1>
<h2><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation"></a>
Derivation</h2>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Position"></a>
Position Equations</h3>
<p>The time derivative of the position is simply a function of the Earth-referenced velocity in Earth frame axes</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Position-timeDerivative"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{r}}_{eb}^e = \mathbf{v}_{eb}^e
\end{equation}
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.3.4, eq. 5.37, p. 175</li>
<li><a class="el" href="citelist.html#CITEREF_jekeli2001">[24]</a> Jekeli, ch. 4.3.3, eq. 4.84, p. 126</li>
</ul>
<p>The time derivative of the position error thus is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Position-differential"></a>  </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\delta}\mathbf{\dot{r}}_{eb}^e = {\mathbf{I}_3} \cdot \mathbf{v}_{eb}^e
\end{equation}
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.3, eq. 14.47, p. 583</li>
</ul>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Attitude"></a>
Attitude Equations</h3>
<p>The estimated attitude \( \mathbf{\hat{C}}_b^e \) can be written in terms of true direction cosine matrix \( \mathbf{C}_b^e \) <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-estimate-true"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\hat{C}}_b^e = \mathbf{B} \mathbf{C}_b^e
\end{equation}
</p>
<p> where \( \mathbf{B} \) is the transformation from true reference axes to estimated reference axes and it can be approximated for small angle misalignments as <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-transformation"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{B} = [\mathbf{I} - \mathbf{\Psi}], \quad \text{with}~ \mathbf{\Psi} = \begin{pmatrix} \delta\alpha \\ \delta\beta \\ \delta\gamma \end{pmatrix} \times
\end{equation}
</p>
<p> with \( \mathbf{\Psi} \) being a skew symmetric matrix and \( \delta\alpha, \delta\beta, \delta\gamma \) being the attitude errors.</p>
<p>Substituting <a class="el" href="#eq-LCKF_e-Derivation-Attitude-transformation">eq-LCKF_e-Derivation-Attitude-transformation</a> into <a class="el" href="#eq-LCKF_e-Derivation-Attitude-estimate-true">eq-LCKF_e-Derivation-Attitude-estimate-true</a> gives <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-estimate-errors"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\hat{C}}_b^e \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e
\end{equation}
</p>
<p>and solving for \( \mathbf{\Psi} \) <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\Psi} = \mathbf{I} - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
\end{equation}
</p>
<p>Differentiating this equation yields: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\Psi}} = -\mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} {\mathbf{C}_b^e}^T - \mathbf{\hat{C}}_b^e {\mathbf{\dot{C}}_b^e}\raise1.25ex\hbox{$\scriptstyle T$}
\end{equation}
</p>
<p>Using the following equations for the transformation</p><ul>
<li>Angular rate splitting \( \boldsymbol{\omega}_{\beta\alpha}^\gamma = \boldsymbol{\omega}_{\beta\delta}^\gamma + \boldsymbol{\omega}_{\delta\alpha}^\gamma \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.3.1, eq. 2.48, p. 45</li>
<li>Skew-symmetric matrix transformation \( \mathbf{\Omega}_{\beta\alpha}^\delta = \mathbf{C}_\gamma^\delta \mathbf{\Omega}_{\beta\alpha}^\gamma \mathbf{C}_\delta^\gamma \) &emsp;<a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 2.3.1, eq. 2.51, p. 45</li>
</ul>
<p>the time derivative of the DCM matrix is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Attitude-DCM-dot"></a>     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{C}}_b^e &amp;= \mathbf{C}_b^e \boldsymbol{\Omega}_{eb}^b \\
                       &amp;= \mathbf{C}_b^e \boldsymbol{\Omega}_{ib}^b - \boldsymbol{\Omega}_{ie}^e \mathbf{C}_b^e
\end{aligned}
\end{equation}
</p>
<p>see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.3.1, eq. 5.24, p. 173</li>
<li><a class="el" href="citelist.html#CITEREF_jekeli2001">[24]</a> Jekeli, ch. 4.3.3, eq. 4.83, p. 126</li>
<li><a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.5.2, eq. 3.22, p. 29</li>
</ul>
<p>where</p><ul>
<li>\( \mathbf{\Omega}_{ib}^b \) is the skew-symmetric matrix of the absolute body rate,</li>
<li>\( \mathbf{\Omega}_{ie}^e \) is the skew-symmetric matrix of the Earth rotation in Earth frame coordinates</li>
</ul>
<p>Similarly, the time time differential of the estimated matrix \( \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} \) can be calculated: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated"></a>  </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\hat{C}}}_b^{\raise-1.25ex\hbox{$\scriptstyle e$}} = \mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e
\end{equation}
</p>
<p>Substituting <a class="el" href="#eq-LCKF_e-Derivation-Attitude-DCM-dot">eq-LCKF_e-Derivation-Attitude-DCM-dot</a> and <a class="el" href="#eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated">eq-LCKF_e-Derivation-Attitude-DCM-dot-estimated</a> into <a class="el" href="#eq-LCKF_e-Derivation-Attitude-skew-mat-dot">eq-LCKF_e-Derivation-Attitude-skew-mat-dot</a> <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1"></a>            </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= -(\mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e) {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e (\mathbf{C}_b^e \mathbf{\Omega}_{ib}^b - \mathbf{\Omega}_{ie}^e \mathbf{C}_b^e)^T \\
                      &amp;= - \mathbf{\hat{C}}_b^e \mathbf{\hat{\Omega}}_{ib}^b {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{C}}_b^e \mathbf{\Omega}_{ib}^b {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e \\
                      &amp;= - \mathbf{\hat{C}}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T
                         - \mathbf{\hat{C}}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e
\end{aligned}
\end{equation}
</p>
<p>Substituting <a class="el" href="#eq-LCKF_e-Derivation-Attitude-estimate-errors">eq-LCKF_e-Derivation-Attitude-estimate-errors</a> into <a class="el" href="#eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1">eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc1</a> gives: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-calc2"></a>            </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \mathbf{\dot{\Psi}} &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e {\mathbf{C}_b^e}^T
                         - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e {\mathbf{C}_b^e}^T \mathbf{\Omega}_{ie}^e \\
                      &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                         + \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi}
                         - \mathbf{\Omega}_{ie}^e + \mathbf{\Psi} \mathbf{\Omega}_{ie}^e \\
                         &amp;= - [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \left[ \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \right] {\mathbf{C}_b^e}^T
                            + \left[ \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\Omega}_{ie}^e \right]
                            - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi} + \mathbf{\Psi} \mathbf{\Omega}_{ie}^e
\end{aligned}
\end{equation}
</p>
<p>Now we make the following substitutions</p><ul>
<li>\( \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e = \mathbf{\hat{\Omega}}_{ie}^e - \mathbf{\Omega}_{ie}^e \)</li>
<li>\( \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b = \mathbf{\hat{\Omega}}_{ib}^b - \mathbf{\Omega}_{ib}^b \)</li>
</ul>
<p>and neglect error product terms. This leads to <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-skew-mat-dot-final"></a>    </p><p class="formulaDsp">
\begin{equation}
  \mathbf{\dot{\Psi}} \approx \mathbf{\Psi} \mathbf{\Omega}_{ie}^e - \mathbf{\hat{\Omega}}_{ie}^e \mathbf{\Psi}
                              + \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e
                              - \mathbf{C}_b^e \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b {\mathbf{C}_b^e}^T
\end{equation}
</p>
<p>Finally by performing an element by element comparison with <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-element-comp"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\psi} \times = \mathbf{\Psi} \qquad\quad
  \boldsymbol{\omega}_{ie}^e \times = \mathbf{\Omega}_{ie}^e \qquad\quad
  \boldsymbol{\delta \omega}_{ie}^e \times = \boldsymbol{\delta}\mathbf{\Omega}_{ie}^e \qquad\quad
  \boldsymbol{\delta \omega}_{ib}^b \times = \boldsymbol{\delta}\mathbf{\Omega}_{ib}^b
\end{equation}
</p>
<p>the equation can be expressed in vector form as: <a class="anchor" id="eq-LCKF_e-Derivation-Attitude-differential"></a>        </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\dot{\psi}} &amp;\approx {-\boldsymbol{\omega}_{ie}^e \times} \boldsymbol{\psi}
                                   + \overbrace{\boldsymbol{\delta \omega}_{ie}^e}^{= 0}
                                   {- \mathbf{C}_b^e} \boldsymbol{\delta \omega}_{ib}^b \\
                          &amp;= {\begin{pmatrix} 0 &amp; \omega_{ie} &amp; 0 \\ -\omega_{ie} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{pmatrix}} \cdot \boldsymbol{\psi}
                             {- \mathbf{C}_b^e} \boldsymbol{\delta \omega}_{ib}^b \\
\end{aligned}
\end{equation}
</p>
<h3><a class="anchor" id="LooselyCoupledKF_e-ErrorStateEquations-Derivation-Velocity"></a>
Velocity Equations</h3>
<p>The time derivative of the velocity in Earth frame coordinates is</p>
<p><a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{v}}^e
      = \overbrace{\boldsymbol{f}^e}^{\text{measured}}
        -\ \underbrace{2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e}_{\text{coriolis acceleration}}
        +\ \overbrace{\mathbf{g}^e}^{\text{gravity}}
\end{equation}
</p>
<p> see</p><ul>
<li><a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 5.3.3, eq. 5.35, p. 175</li>
<li><a class="el" href="citelist.html#CITEREF_jekeli2001">[24]</a> Jekeli, ch. 4.3.3, eq. 4.82, p. 126</li>
<li><a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.5.2, eq. 3.21, p. 29</li>
</ul>
<p>where</p><ul>
<li>\( \boldsymbol{v}^e \) is the velocity with respect to the Earth in Earth frame coordinates,</li>
<li>\( \boldsymbol{f}^e \) is the specific force vector as measured by a triad of accelerometers and resolved into Earth frame coordinates</li>
<li>\( \boldsymbol{\omega}_{ie}^e \) is the turn rate of the Earth expressed in Earth frame coordinates</li>
<li>\( \mathbf{g}^e \) is the local gravity vector which is a combination of (see <a class="el" href="citelist.html#CITEREF_titterton2004">[47]</a> Titterton, ch. 3.5.1, eq. 3.14, p. 27)<ul>
<li>\( \boldsymbol{\gamma}_{ib}^e \) the gravitation vector (caused by effects of mass attraction)</li>
<li>\( -\boldsymbol{\omega}_{ie}^e \times [ \boldsymbol{\omega}_{ie}^e \times \mathbf{r}^e ] \) the centrifugal acceleration caused by the Earth's rotation</li>
</ul>
</li>
</ul>
<p>The estimated velocity follows the same propagation <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate"></a>     </p><p class="formulaDsp">
\begin{equation}
  \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle e$}}
      = \boldsymbol{\hat{f}}^e
      - 2 \boldsymbol{\hat{\omega}}_{ie}^e \times \boldsymbol{\hat{v}}_e^e
      + \mathbf{\hat{g}}^e
\end{equation}
</p>
<p>Differencing equation <a class="el" href="#eq-LCKF_e-Derivation-Velocity-timeDerivative">eq-LCKF_e-Derivation-Velocity-timeDerivative</a> and <a class="el" href="#eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate">eq-LCKF_e-Derivation-Velocity-timeDerivative-estimate</a> we get <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential"></a>          </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta} \boldsymbol{\dot{v}}^e &amp;= \boldsymbol{\dot{\hat{v}}}^{\raise-0.45ex\hbox{$\scriptstyle e$}} - \boldsymbol{\dot{v}}^e \\
                                &amp;= \mathbf{\hat{C}}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\hat{\omega}}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                       + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \mathbf{\hat{g}}^e
                                       - \mathbf{g}^e
\end{aligned}
\end{equation}
</p>
<ul>
<li>Substituting equation <a class="el" href="#eq-LCKF_e-Derivation-Attitude-estimate-errors">eq-LCKF_e-Derivation-Attitude-estimate-errors</a> : \( \mathbf{\hat{C}}_b^e \approx [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \)</li>
<li>and writing<ul>
<li>\( \boldsymbol{\delta} \boldsymbol{f}^b = \boldsymbol{\hat{f}}^b - \boldsymbol{f}^b \)</li>
<li>\( \boldsymbol{\delta} \boldsymbol{v}^e = \boldsymbol{\hat{v}}^e - \boldsymbol{v}^e \)</li>
<li>\( \boldsymbol{\delta} \boldsymbol{\omega}_{ie}^e = \boldsymbol{\hat{\omega}}_{ie}^e - \boldsymbol{\omega}_{ie}^e = 0 \)</li>
<li>\( \boldsymbol{\delta} \mathbf{g}^e = \mathbf{\hat{g}}^e - \mathbf{g}^e \)</li>
</ul>
</li>
</ul>
<p>we get <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation"></a>                     </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta \dot{v}}^e &amp;= [\mathbf{I} - \mathbf{\Psi}] \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                       + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= \mathbf{C}_b^e \boldsymbol{\hat{f}}^b - \mathbf{\Psi} \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                       - \mathbf{C}_b^e \boldsymbol{f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\hat{v}}^e
                                   + 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= - \boldsymbol{\psi} \times \mathbf{C}_b^e \boldsymbol{\hat{f}}^b
                                   + {\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
                                &amp;= (\mathbf{C}_b^e \boldsymbol{\delta f}^b + \mathbf{C}_b^e \boldsymbol{f}^b) \times \boldsymbol{\psi}
                                   + {\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   - 2 \boldsymbol{\omega}_{ie}^e \times \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e \\
\end{aligned}
\end{equation}
</p>
<p> Now neglecting error product terms ( \( \boldsymbol{\delta f}^b \times \boldsymbol{\psi} \approx 0 \)) <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-differential-transformation-neglect"></a>      </p><p class="formulaDsp">
\begin{equation}
\renewcommand*{\arraystretch}{1.9}
  \boldsymbol{\delta \dot{v}}^e \approx {\boldsymbol{f}^e \times} \boldsymbol{\psi}
                                   + {\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   {- 2 \boldsymbol{\omega}_{ie}^e \times} \boldsymbol{\delta v}^e
                                   + \boldsymbol{\delta} \mathbf{g}^e
\end{equation}
</p>
<p>The gravity error can be expressed as (see <a class="el" href="citelist.html#CITEREF_groves2013">[17]</a> Groves, ch. 14.2.3, eq. 14.45, p. 583) <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-gravityError"></a>       </p><p class="formulaDsp">
\begin{equation}
\begin{aligned}
  \boldsymbol{\delta} \mathbf{g}^e = \overbrace{\boldsymbol{\hat{\gamma}}_{ib}^e - \boldsymbol{\gamma}_{ib}^e}^{\text{gravitation error}}
                                      - \underbrace{\boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \boldsymbol{\delta} \mathbf{r}_{eb}^e}_{\text{centrifugal acceleration error}}
                                   \approx - \frac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \frac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|} \boldsymbol{\delta} \mathbf{r}_{eb}^e
                                           - \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \boldsymbol{\delta} \mathbf{r}_{eb}^e
\end{aligned}
\end{equation}
</p>
<p> where</p><ul>
<li>the assumption \( h &lt;&lt; r_{eS}^e \) is made</li>
</ul>
<p>This leads to the final form <a class="anchor" id="eq-LCKF_e-Derivation-Velocity-timeDerivative-final"></a>       </p><p class="formulaDsp">
\begin{equation}
\renewcommand*{\arraystretch}{1.9}
  \boldsymbol{\delta \dot{v}}^e \approx {\boldsymbol{f}^e \times} \boldsymbol{\psi}
                                   + {\mathbf{C}_b^e} \boldsymbol{\delta f}^b
                                   + {\begin{pmatrix} 0 &amp; 2 \omega_{ie} &amp; \\ -2 \omega_{ie} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{pmatrix}} \boldsymbol{\delta v}^e
                                   {- \left(  \dfrac{2 \boldsymbol{\gamma}_{ib}^e}{r_{eS}^e} \dfrac{{\mathbf{r}_{eb}^e}^T}{\left| \mathbf{r}_{eb}^e \right|}
                                                                 + \boldsymbol{\Omega}_{ie}^e \boldsymbol{\Omega}_{ie}^e \right)} \boldsymbol{\delta} \mathbf{r}_{eb}^e
\end{equation}
</p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="algorithms_landing_page.html">Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
